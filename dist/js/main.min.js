function AppViewModel(){this.self=this;var a=setTimeout(function(){showLocationsLoadError()},15e3),b="https://dazzling-torch-4012.firebaseio.com/locationData.json?";console.log("get location data"),$.ajax({url:b,dataType:"jsonp",success:function(a){function b(){console.log("Google maps api loaded"),console.log("generate map markers"),self.generateMarkers(a)}if(console.log("get location data successful"),self.parseLocationData(a),"object"==typeof google&&"object"==typeof google.maps)b();else var c=setInterval(function(){console.log("Error: Google maps api NOT loaded"),console.log("Load Google maps api again"),"object"==typeof google&&"object"==typeof google.maps&&(b(),clearInterval(c))},1e3)}}),self.locationArray=[],self.locationGrid=ko.observableArray(""),self.searchKeywords=[],self.parseLocationData=function(b){b.forEach(function(a){self.locationArray.push(a),self.locationGrid.push(a),self.searchKeywords.push(a.breakName),searchKeywords.indexOf(a.location)<0&&self.searchKeywords.push(a.location)}),console.log("primary locations array (locationArray) loaded"),console.log("locations list (locationGrid) rendered"),console.log("autosearch keywords loaded"),locationsLoaded=!0,imagesLoaded&&addRolloverEffect(),clearTimeout(a)},self.showLocationsLoadError=function(){console.log("get location data unsuccessful"),$(".search-container").toggle(),$(".search-section").toggle(),$(".map-section").toggle(),$(".surf-info-section").toggle(),$(".list-section").toggle();var a='<section class="error-section"><div class="row"><div class="col-xs-12 data-load-error-container"><img src="img/no_connection.svg" class="no-connection"><p>Dude! Really?! =(</p></div></div></section>',b='<button type="button" class="btn reload-button">Reload</button>';$("header").after(a),$(".data-load-error-container").append(b),$(".reload-button").on("click",function(a){location=location})},self.adjustMapSize=function(){var a=$(".location-grid").outerHeight(),b=$("#myNavbar").outerHeight(),c=$(window).height(),d=$(".map-container"),e=$(".search-container");if(e.is(":visible"))var f=e.outerHeight(),g=c-(a+f+b);else var g=c-(a+b);d.css("height",g),0!==markers.length&&$("#map").is(":visible")&&(google.maps.event.trigger(map,"resize"),setMapBounds())},self.enableHorizontalScrolling=function(){var a=$(".location-grid");a.off(),a.mousewheel(function(a,b){this.scrollLeft-=1*b,a.preventDefault()})},self.toggleLayout=function(){var a=$(".location-grid"),b=$(".location-frame"),d=$("#container"),g=$(".map-container"),h=$("#map"),i=$(".favorite"),j=$(".break-name"),k=$(".location-name"),l=$(".search-form"),m=$(".clear"),n=$(".clear-favorites-button");c||e||f?(console.log("update mobile/grid/guide view layout"),f&&$("#map").is(":visible")?(g.removeClass("map-container-map-view-style").addClass("map-container-default-style"),$(".map-container-default-style").css("display","block")):g.removeClass("map-container-map-view-style").addClass("map-container-default-style"),l.removeClass("search-form-map-view-style").addClass("search-form-default-style"),m.removeClass("clear-map-view-style").addClass("clear-default-style"),n.removeClass("clear-favorites-button-map-view-style").addClass("clear-favorites-button-default-style"),a.removeClass("location-grid-map-view-style"),b.removeClass("location-frame-map-view-style").addClass("location-frame-default-style"),g.css("height","245px"),d.removeClass("container-fluid").addClass("container"),a.removeClass("row-fluid").addClass("row"),b.addClass("col-xs-12 col-sm-6 col-md-4"),j.removeClass("break-name-map-view-style").addClass("break-name-default-style"),k.removeClass("location-name-map-view-style").addClass("location-name-default-style"),i.attr("class","favorite favorite-default-style"),a.off(),0!==markers.length&&h.is(":visible")&&!f?(console.log("map is visible"),setMapBounds()):f&&h.is(":visible")&&(google.maps.event.trigger(map,"resize"),centerOnGuideMarker())):(console.log("update map view layout"),g.removeClass("map-container-default-style").addClass("map-container-map-view-style"),l.addClass("search-form-map-view-style").removeClass("search-form-default-style"),m.addClass("clear-map-view-style").removeClass("clear-default-style"),n.removeClass("clear-favorites-button-default-style").addClass("clear-favorites-button-map-view-style"),a.addClass("location-grid-map-view-style"),d.removeClass("container").addClass("container-fluid"),a.removeClass("row").addClass("row-fluid"),self.resetLocationFrames(),self.adjustMapSize(),self.enableHorizontalScrolling())},self.toggleRolloverClasses=function(){var a=$(".skill-level-rollover"),b=$(".break-type-rollover"),c=$(".wave-direction-rollover");$bestSeasonIcon=$(".best-season-rollover"),$miscInfoOneIcon=$(".misc-info-one-rollover"),$miscInfoTwoIcon=$(".misc-info-two-rollover"),$distanceInfo=$(".distance-rollover"),$waterTempInfo=$(".water-temp-rollover"),$waveSizeInfo=$(".wave-size-rollover"),$costInfo=$(".cost-rollover"),p?(console.log("adjust hover icons and info to map view style"),a.addClass("skill-level-hover-map-view-style").removeClass("skill-level-hover-default-style"),b.addClass("break-type-hover-map-view-style").removeClass("break-type-hover-default-style"),c.addClass("wave-direction-hover-map-view-style").removeClass("wave-direction-hover-default-style"),$bestSeasonIcon.addClass("best-season-hover-map-view-style").removeClass("best-season-hover-default-style"),$miscInfoOneIcon.addClass("misc-info-one-hover-map-view-style").removeClass("misc-info-one-hover-default-style"),$miscInfoTwoIcon.addClass("misc-info-two-hover-map-view-style").removeClass("misc-info-two-hover-default-style"),$distanceInfo.addClass("distance-hover-map-view-style").removeClass("distance-hover-default-style"),$waterTempInfo.addClass("water-temp-hover-map-view-style").removeClass("water-temp-hover-default-style"),$waveSizeInfo.addClass("wave-size-hover-map-view-style").removeClass("wave-size-hover-default-style"),$costInfo.addClass("cost-hover-map-view-style").removeClass("cost-hover-default-style")):(console.log("revert hover icons and info back to default style"),a.addClass("skill-level-hover-default-style").removeClass("skill-level-hover-map-view-style"),b.addClass("break-type-hover-default-style").removeClass("break-type-hover-map-view-style"),c.addClass("wave-direction-hover-default-style").removeClass("wave-direction-hover-map-view-style"),$bestSeasonIcon.addClass("best-season-hover-default-style").removeClass("best-season-hover-map-view-style"),$miscInfoOneIcon.addClass("misc-info-one-hover-default-style").removeClass("misc-info-one-hover-map-view-style"),$miscInfoTwoIcon.addClass("misc-info-two-hover-default-style").removeClass("misc-info-two-hover-map-view-style"),$distanceInfo.addClass("distance-hover-default-style").removeClass("distance-hover-map-view-style"),$waterTempInfo.addClass("water-temp-hover-default-style").removeClass("water-temp-hover-map-view-style"),$waveSizeInfo.addClass("wave-size-hover-default-style").removeClass("wave-size-hover-map-view-style"),$costInfo.addClass("cost-hover-default-style").removeClass("cost-hover-map-view-style"))},self.resetLocationFrames=function(){var a=$(".location-frame"),b=$(".location-name"),c=$(".break-name"),d=$(".favorite");a.addClass("location-frame-map-view-style").removeClass("location-frame-default-style"),a.css("display","inline-block"),a.removeClass("col-xs-12 col-sm-6 col-md-4"),c.removeClass("break-name-default-style").addClass("break-name-map-view-style"),b.removeClass("location-name-default-style").addClass("location-name-map-view-style"),d.attr("class","favorite favorite-map-view-style")};var c,d,e,f;self.checkView=function(){var a=window.outerWidth;$(".surf-guide-container").is(":visible")&&768>a?(d=!1,e=!1,c=!0,f=!0,console.log("view is surf guide/mobile")):$(".surf-guide-container").is(":visible")&&a>=768?(d=!1,e=!1,c=!1,f=!0,console.log("view is surf guide")):768>a?(d=!1,e=!1,f=!1,c=!0,console.log("view is mobile")):(c=!1,f=!1,$(".map-selected").length?(e=!1,d=!0,console.log("view is map")):(d=!1,e=!0,console.log("view is grid"))),toggleLayout()},self.checkView(),$(window).resize(function(){self.checkView()}),self.stickyNavBar=function(){var a=$("#navbar-main"),b=a.offset().top,c=$(window),d=$("body");c.scroll(function(){c.scrollTop()>b?(a.addClass("navbar-fixed-top"),d.css("padding-top","50px")):(a.removeClass("navbar-fixed-top"),d.css("padding-top","0px"))})},self.stickyNavBar(),self.makeSVGInline=function(a){var b=a,c=b.attr("class"),d=b.attr("src");jQuery.get(d,function(a){var d=jQuery(a).find("svg");"undefined"!=typeof c&&(d=d.attr("class",c)),d=d.removeAttr("xmlns:a"),b.replaceWith(d)},"xml")};var g=new Firebase("https://dazzling-torch-4012.firebaseio.com"),h=new Firebase("https://dazzling-torch-4012.firebaseio.com/users"),i=function(a){a?console.log("data could not be saved."+a):console.log("data saved successfully.")},j=function(a){console.log("the read failed: "+a.code)};self.makeSVGInline($(".favorite")),self.renderFavoriteOnLocationFrame=function(){console.log("display 'favorite' icons on relevant location frames"),$(".location-frame").each(function(){var a=($(this),$(this).find(".favorite-wrapper")),b=$(this).find(".break-name")[0].innerText;userFavorites.indexOf(b)>-1?(a.removeClass("not-a-favorite"),a.addClass("is-a-favorite")):a.hasClass("is-a-favorite")&&(a.addClass("not-a-favorite"),a.removeClass("is-a-favorite"))})},userFavorites=[],self.getFavorites=function(a){null===a?console.log("cannot find favorites because there are no logged in users"):h.child(a.uid).child("favorites").on("value",function(a){var b=a.val();if(userFavorites=[],null===b){console.log("user has no favorites");var b=[];updateFavMarkers(b)}else updateFavMarkers(b),b.forEach(function(a){userFavorites.push(a)}),console.log("the user's favorite(s) is/are: "+userFavorites.join(", ")),self.renderFavoriteOnLocationFrame();console.log("favorites updated"),favoritesUpdated=!0},j)};var k;self.checkAuthentication=function(a){a?(console.log("user "+a.uid+" is logged in with "+a.provider),k=!1,self.getFavorites(a)):(console.log("user is logged out"),k=!0)},g.onAuth(self.checkAuthentication),k&&g.authAnonymously(function(a,b){a?console.log("login Failed!",a):g.child("users").child(b.uid).set({favorites:[],name:prompt("Please enter your name")})}),self.showUser=function(){var a=g.getAuth();h.child(a.uid).child("name").on("value",function(a){var b=a.val();console.log(b+" is currently logged in")},j)},setInterval(self.showUser,6e4),self.addFavorite=function(a){userFavorites.push(a),h.child(g.getAuth().uid).update({favorites:userFavorites},i)},self.removeFavorite=function(a){var b=[];userFavorites.forEach(function(c){a!==c&&b.push(c)}),h.child(g.getAuth().uid).update({favorites:b},i)},self.removeAllFavorites=function(){userFavorites=[],h.child(g.getAuth().uid).update({favorites:userFavorites},i)},self.Query=ko.observable(""),self.makeSVGInline($(".search-symbol-desktop")),self.makeSVGInline($(".search-symbol-mobile")),self.makeSVGInline($(".favorite-filter-symbol-desktop")),self.makeSVGInline($(".favorite-filter-symbol-mobile")),self.makeSVGInline($(".map-symbol-desktop")),self.makeSVGInline($(".map-symbol-mobile"));var l=$(".clear"),m=$(".search-form"),n=$(".search-symbol"),o=$(".search-container");self.toggleSearch=function(){o.slideToggle(500),setTimeout(function(){console.log("toggle search"),$(".favorite-filter-selected").length||self.resetPage(),l.is(":visible")&&l.toggle(),o.is(":visible")&&!$(".search-selected").length?(m.focus(),n.removeClass("search-default"),n.addClass("search-selected")):(n.removeClass("search-selected"),n.addClass("search-default"))},600)},n.on("click",function(){if($(".favorite-filter-selected").length){var a=$(".favorite-filter-symbol"),b=$(".filters-container");b.slideUp(500),console.log("hide filters container and favorites"),a.removeClass("favorite-filter-selected"),a.addClass("favorite-filter-default")}var c=$(window);c.scrollTop()<56||c.scrollTop()>=56&&o.is(":hidden")?(document.body.scrollTop=document.documentElement.scrollTop=0,self.toggleSearch()):m.focus()}),m.on("click",function(){self.resetPage()}).on("focus",function(){$(m).val()||l.toggle()}).on("blur",function(){$(m).val()||l.toggle()}),l.on("click",function(){l.toggle(),self.resetPage(),m.focus()}),m.autocomplete({source:searchKeywords,autoFocus:!0,minLength:2,delay:250,select:function(a,b){self.Query(b.item.value),self.searchLocations()},close:function(){$(this).blur()}}),self.searchLocations=function(){var a=self.Query().toLowerCase().replace(/ /g,"").replace(/'/g,"").replace(/,/g,"");self.locationGrid.removeAll(),self.locationArray.forEach(function(b){b.breakName.toLowerCase().replace(/ /g,"").replace(/'/g,"").replace(/,/g,"").indexOf(a)>-1?self.locationGrid.push(b):b.location.toLowerCase().replace(/ /g,"").replace(/'/g,"").replace(/,/g,"").indexOf(a)>-1&&self.locationGrid.push(b)}),markers.forEach(function(b){b.title.toLowerCase().replace(/ /g,"").replace(/'/g,"").replace(/,/g,"").indexOf(a)>-1?b.setVisible(!0):b.setVisible(!1)}),$("#map").is(":hidden")||setMapBounds(),$(".map-container").is(":visible")&&self.toggleLayout(),self.addRolloverEffect(),self.renderFavoriteOnLocationFrame()},self.filterFavorites=function(){$(".favorite-filter-symbol");self.locationGrid.removeAll(),locationArray.forEach(function(a){var b=a.breakName;userFavorites.indexOf(b)>-1&&self.locationGrid.push(a)}),infoWindow.close(),makeMarkerSmall(),markers.forEach(function(a){var b=a.title.replace(/ *\([^)]*\) */g,"");userFavorites.indexOf(b)>-1?a.setVisible(!0):a.setVisible(!1)}),console.log("update map with favorites"),$("#map").is(":visible")&&setMapBounds()},$(".favorite-filter-symbol").on("click",function(){var a=$(".favorite-filter-symbol"),b=$(".filters-container");if($(".favorite-filter-selected").length)console.log("show all locations"),$(".map-container-map-view-style").length?b.fadeOut(500):b.slideUp(500),a.removeClass("favorite-filter-selected").addClass("favorite-filter-default"),self.resetPage();else{if($(".favorite-filter-selected").length||!(userFavorites.length>0))return void console.log("user has no favorites");console.log("show favorites only"),$(".search-container").is(":visible")&&self.toggleSearch(),$(".surf-guide-container").length&&self.closeSurfGuide(),a.removeClass("favorite-filter-default").addClass("favorite-filter-selected"),$(".map-container-map-view-style").length&&$(".search-container").is(":visible")?setTimeout(function(){self.filterFavorites(),self.toggleLayout(),self.addRolloverEffect(),self.renderFavoriteOnLocationFrame()},600):(self.filterFavorites(),self.toggleLayout(),self.addRolloverEffect(),self.renderFavoriteOnLocationFrame()),$(".map-container-map-view-style").length?b.fadeIn(500):b.slideDown(500)}$(".map-container-map-view-style").length||(document.body.scrollTop=document.documentElement.scrollTop=0)}),$(".clear-favorites-button").on("click",function(){var a=$(".filters-container"),b=$(".favorite-filter-symbol");$(".map-container-map-view-style").length?a.fadeOut(500):a.slideUp(500),b.removeClass("favorite-filter-selected"),b.addClass("favorite-filter-default"),self.removeAllFavorites(),self.resetPage()}),self.resetPage=function(){console.log("reset locations & map, clear search, and close surf guide"),$(".surf-guide-container").length&&self.closeSurfGuide(),m.val(""),self.Query(""),infoWindow.close(),makeMarkerSmall(),locationGrid.removeAll(),locationArray.forEach(function(a){locationGrid.push(a)}),$(".location-grid").is(":hidden")&&$(".location-grid").show(),self.checkView(),markers.forEach(function(a){a.setVisible(!0)}),$("#map").is(":hidden")||setMapBounds(),self.addRolloverEffect(),userFavorites.length>0&&self.renderFavoriteOnLocationFrame()};var p;self.addRolloverEffect=function(){console.log("enable hover effect"),$(".location-frame").each(function(){var a=$(this),b=$(this).find(".break-name"),d=$(this).find(".location-name"),f=$(this).find("img.location-image"),g=$(this).find(".favorite-wrapper"),h=$(".map-container");a.on("mouseenter",function(i){function j(c){f.css("-webkit-filter","blur(4px) brightness(80%)"),d.hide(),b.hide(),g.hide();var e=displaySkillIcon(c.skillLevel);a.append(e);var h=displayBreakIcon(c.breakDetails);a.append(h);var i=displayDirectionIcon(c.waveDirection);a.append(i);var j=displayBestSeasonIcon(c.optimalTime);a.append(j);var k=displayBigWaveIcon(c);a.append(k);var l=displayWellKnownIcon(c);a.append(l);var m=displayCost(c.cost);if(a.append(m),"undefined"!=typeof currentLat){var n=displayDistance(c.lat,c.lng);a.append(n)}var o=displayCurrentWaterTemp(c.avgWaterTemp);a.append(o);var p=displayWaveSize(c.avgSize);a.append(p)}p=!0;var k=i.currentTarget.children[1].innerText;console.log("hover over "+k),h.is(":visible")&&activateMarker(k),self.locationArray.forEach(function(a){k===a.breakName&&j(a)}),c||e||self.toggleRolloverClasses()}),a.on("mouseleave",function(){p=!1,c||e||self.toggleRolloverClasses(),f.css("-webkit-filter","blur(0px) brightness(100%)"),d.show(),b.show(),g.show(),$(".surf-guide-container").length||e||(makeMarkerSmall(),infoWindow.close()),$(".rollover-info").remove()})})},self.clickLocationFrame=function(a){p=!1,$(".map-container").is(":visible")&&self.goToMarker(a.breakName),self.renderSurfGuide(a),self.checkView()},self.goToMarker=function(a){makeMarkerSmall(),markers.forEach(function(b){var c=b.title.replace(/ *\([^)]*\) */g,"");c===a&&(makeMarkerBig(b,c),getInfoWindow(b,a),animateMarker(b))})},self.activateMarker=function(a){markers.forEach(function(b){var c=b.title.replace(/ *\([^)]*\) */g,"");c===a&&makeMarkerBig(b,c)})};self.renderSurfGuide=function(a){$(".favorite-filter-selected").length&&$(".filters-container").toggle(),document.body.scrollTop=document.documentElement.scrollTop=0,$(".surf-guide-container").is(":visible")||$(".location-grid").toggle(),$(".surf-guide-container").remove(),$(".surf-info-container").append('<div class="row surf-guide-container"></div>'),$surfGuideContainer=$(".surf-guide-container");var b=displayTitle(a.breakName,a.location);$surfGuideContainer.append(b);var c=displayFavoriteIcon(a.breakName);$(".title").prepend(c),self.makeSVGInline($(".favorite-guide")),addFavoriteListener(a.breakName),$surfGuideContainer.append('<div class="col-xs-12 icon-frame"></div>');var d=$(".icon-frame");d.append('<div class="xs-icon-container sm-icon-container icon-container"></div>');var e=$(".icon-container");displayBigWaveIcon(a,e),displayWellKnownIcon(a,e);var f=displaySkillIcon(a.skillLevel);e.append(f);var g=displayDirectionIcon(a.waveDirection);e.append(g);var h=displayBreakIcon(a.breakDetails);e.append(h);var i=displayWaveSize(a.avgSize);e.append(i);var j=100,k=100;displayCompassIcon(a.optimalSwell,a.optimalWind,e,j,k);var l=displayTideIcon(a.optimalTide);e.append(l);var m=displayBestSeasonIcon(a.optimalTime);e.append(m),displaySuggestedAttireIcons(a.avgWaterTemp,j,k,e);var n=displayClimateIcon(a.climate);e.append(n);var o=displayCost(a.cost,e);if(e.append(o),"undefined"!=typeof currentLat){var p=displayDistance(a.lat,a.lng);e.append('<div class=" distance card">'+p+"</div>")}displayHazardIcons(a.hazards,e),$(".card").addClass("col-xs-4 col-sm-3"),addGuideButtons(a)},self.addGuideButtons=function(a){$surfGuideContainer.prepend('<button type="button" class="btn guide-close-button">✖</button>'),$(".guide-header").append('<button type="button" class="btn conditions-button">Current Conditions</button>'),$(".conditions-button").on("click",function(b){if($(".live-surf-conditions").is(":hidden"))$(".icon-frame").addClass("col-sm-6 sm-icon-frame"),$(".icon-container").addClass("md-icon-container"),$(".live-surf-conditions").toggle(),$(".conditions-button").toggle(),$(".conditions-close-button").toggle();else{$(".conditions-button").toggle(),$("#progressBarContainer").length||$(".guide-header").append('<div id="progressBarContainer"></div>');var c=loadProgressBar();getMagicSeaweed(a.spotID,a.breakName,c)}}),$(".guide-close-button").on("click",function(a){$(".favorite-filter-selected").length&&($(".filters-container").toggle(),self.filterFavorites(),self.addRolloverEffect(),self.renderFavoriteOnLocationFrame()),self.closeSurfGuide()})},self.closeSurfGuide=function(){makeMarkerSmall(),$(".surf-guide-container").remove(),self.checkView(),$(".location-frame").show(),$(".location-grid").toggle(),infoWindow.close(),document.body.scrollTop=document.documentElement.scrollTop=0},self.addFavoriteListener=function(a){$(".favorite-wrapper-guide").on("click",function(){var b=$(this);$(".is-a-favorite-guide").length?(b.removeClass("is-a-favorite-guide").addClass("not-a-favorite-guide"),console.log("unfavorite "+a),b.attr("title","Add to favorites"),removeFavorite(a),b.blur()):(b.removeClass("not-a-favorite-guide").addClass("is-a-favorite-guide"),console.log("favorite "+a),b.attr("title","Remove from favorites"),addFavorite(a))})},self.displayTitle=function(a,b){var c='<div class="col-xs-12 guide-header"><p class="title"><span id="guide-break-name">'+a+"</span>, "+b+"</p></div>";return c},self.displayFavoriteIcon=function(a){if(userFavorites.indexOf(a)>-1)var b=!0;if(b)var c='<span class="favorite-wrapper-guide is-a-favorite-guide" title="Remove from favorites"><img class="favorite-guide"  src="img/heart.svg"></span>';else var c='<span class="favorite-wrapper-guide not-a-favorite-guide" title="Add to favorites"><img class="favorite-guide" src="img/heart.svg"></span>';return c},self.displayBigWaveIcon=function(a,b){if(p)if(a.bigWave)var c=images.roIconMiscOneBigWave;else var c=displaySuggestedAttireIcons(a.avgWaterTemp);else{if(!a.bigWave)return;var c='<div class=" big-wave card"><img src="img/big_wave.svg" class="big-wave-guide" title="Big Wave Surfing"></div>';b.append(c)}return c},self.displayWellKnownIcon=function(a,b){if(p)if(a.wellKnown)var c=images.roIconMiscTwoWellknown;else var c=displayHazardIcons(a.hazards,b);else{if(!a.wellKnown)return;var c='<div class=" well-known card"><img src="img/well_known.svg" class="well-known-guide" title="Well Known Wave"></div>';b.append(c)}return c},self.displaySkillIcon=function(a){for(var b=0,c=0,d=0,e=a.length,f=e;f--;)switch(a[f]){case"beginner":b++;break;case"intermediate":c++;break;case"advanced":d++}if(b===c&&b===d)if(p)var g=images.roIconSkillAll;else var g='<div class=" skill-level card"><img src="img/skill_level_all.svg" class="skill-level-guide" title="Difficulty: All levels"></div>';else if(b>=c&&b>d)if(b===c)if(p)var g=images.roIconSkillBegInt;else var g='<div class="skill-level card"><img src="img/skill_level_beginner_intermediate.svg" class=" skill-level-guide" title="Difficulty: Beginner to Intermediate"></div>';else if(p)var g=images.roIconSkillBeg;else var g='<div class="skill-level card"><img src="img/skill_level_beginner.svg" class=" skill-level-guide" title="Difficulty: Beginner"></div>';else if(c>b&&c>=d)if(c===d)if(p)var g=images.roIconSkillIntAdv;else var g='<div class=" skill-level card"><img src="img/skill_level_intermediate_advanced.svg" class=" skill-level-guide" title="Difficulty: Intermediate to Advanced"></div>';else if(p)var g=images.roIconSkillInt;else var g='<div class=" skill-level card"><img src="img/skill_level_intermediate.svg" class=" skill-level-guide" title="Difficulty: Intermediate"></div>';else if(p)var g=images.roIconSkillAdv;else var g='<div class=" skill-level card"><img src="img/skill_level_advanced.svg" class=" skill-level-guide" title="Difficulty: Advanced"></div>';return g},self.displayDirectionIcon=function(a){switch(a){case"left":if(p)var b=images.roIconDirectionLeft;else var b='<div class=" direction card"><img src="img/direction_left.svg" class="wave-direction-guide" title="Wave Direction: Left"></div>';break;case"right":if(p)var b=images.roIconDirectionRight;else var b='<div class=" direction card"><img src="img/direction_right.svg" class="wave-direction-guide" title="Wave Direction: Right"></div>';break;case"left & right":if(p)var b=images.roIconDirectionBoth;else var b='<div class=" direction card"><img src="img/direction_both.svg" class="wave-direction-guide" title="Wave Direction: Left & Right"></div>'}return b},self.displayBreakIcon=function(a){switch(a){case"reef":if(p)var b=images.roIconBreakReef;else var b='<div class=" break card"><img src="img/break_reef.svg" class="break-type-guide" title="Break Type: Reef"></div>';break;case"beach":if(p)var b=images.roIconBreakBeach;else var b='<div class=" break card"><img src="img/break_beach.svg" class="break-type-guide" title="Break Type: Beach"></div>';break;case"point":if(p)var b=images.roIconBreakPoint;else var b='<div class=" break card"><img src="img/break_point.svg" class="break-type-guide" title="Break Type: Point"></div>';break;case"river mouth":if(p)var b=images.roIconBreakRiver;else var b='<div class=" break card"><img src="img/break_river_mouth.svg" class="break-type-guide" title="Break Type: River Mouth"></div>'}return b},self.displayCompassIcon=function(a,b,c,d,e){function f(a){if(g){g=!1,drawBackground=!0,c.append('<div class=" small-compass-guide card" title="Best Swell & Best Wind"><canvas id="compass-small" width="'+d+'" height="'+e+'"></canvas></div>');var b=images.swellPointer,f=images.smallCompass}else if(h){h=!1;var b=images.windPointer}var i=document.getElementById("compass-small"),j=i.getContext("2d"),k=b;drawBackground&&(j.drawImage(f,0,0),j.save());var l=d/2,m=e/2;j.translate(l,m);for(var n=a.length,o=n;o--;){switch(a[o]){case"N":var p=0;break;case"NNE":var p=22.5;break;case"NE":var p=45;break;case"ENE":var p=67.5;break;case"E":var p=90;break;case"ESE":var p=112.5;break;case"SE":var p=135;break;case"SSE":var p=157.5;break;case"S":var p=180;break;case"SSW":var p=202.5;break;case"SW":var p=225;break;case"WSW":var p=247.5;break;case"W":var p=270;break;case"WNW":var p=292.5;break;case"NW":var p=315;break;case"NNW":var p=337.5}var q=p*(Math.PI/180);j.rotate(q),j.drawImage(k,-l,-m),j.rotate(-q)}drawBackground&&(drawBackground=!1,j.restore())}if(a){var g=!0;f(a)}var h=!0;f(b)},self.displayTideIcon=function(a){for(var b=0,c=0,d=0,e=a.length,f=e;f--;)switch(a[f]){case"low":b++;break;case"mid":c++;break;case"high":d++}if(b===c&&b===d)var g='<div class=" tide card"><img src="img/tide_all.svg" class="tide-guide" title="Best Tide: All"></div>';else if(b>=c&&b>=d)if(b===c)var g='<div class=" tide card"><img src="img/tide_low_mid.svg" class="tide-guide" title="Best Tide: Low & Mid"></div>';else if(b===d)var g='<div class=" tide card"><img src="img/tide_low_high.svg" class="tide-guide" title="Best Tide: Low & High"></div>';else var g='<div class=" tide card"><img src="img/tide_low.svg" class="tide-guide" title="Best Tide: Low"></div>';else if(c>b&&c>=d)if(c===d)var g='<div class=" tide card"><img src="img/tide_high_mid.svg" class="tide-guide" title="Best Tide: Mid & High"></div>';else var g='<div class=" tide card"><img src="img/tide_mid.svg" class="tide-guide" title="Best Tide: Mid"></div>';else var g='<div class=" tide card"><img src="img/tide_high.svg" class="tide-guide" title="Best Tide: High"></div>';return g},self.displayBestSeasonIcon=function(a){for(var b=0,c=0,d=0,e=0,f=a.length,g=f;g--;)switch(a[g]){case" Dec":case" Jan":case" Feb":e++;break;case" Mar":case" Apr":case" May":b++;break;case" Jun":case" Jul":case" Aug":c++;break;case" Sep":case" Oct":case" Nov":d++}if(e===b&&e===c&&e===d)if(p)var h=images.roIconBestSeasonAll;else var h='<div class=" time card"><img src="img/season_all.svg" class="best-season-guide" title="Best Season: All"></div>';else if(e>=b&&e>=c&&e>=d)if(e===b)if(p)var h=images.roIconBestSeasonWinSpr;else var h='<div class=" time card"><img src="img/season_winter_spring.svg" class="best-season-guide" title="Winter & Spring"></div>';else if(e===c)if(p)var h=images.roIconBestSeasonWinSum;else var h='<div class=" time card"><img src="img/season_winter_summer.svg" class="best-season-guide" title="Best Season: Winter & Summer"></div>';else if(e===d)if(p)var h=images.roIconBestSeasonWinAut;else var h='<div class=" time card"><img src="img/season_winter_autumn.svg" class="best-season-guide" title="Best Season: Winter & Autumn"></div>';else if(p)var h=images.roIconBestSeasonWin;else var h='<div class=" time card"><img src="img/season_winter.svg" class="best-season-guide" title="Best Season: Winter"></div>';else if(b>=c&&b>=d&&b>e)if(b===c)if(p)var h=images.roIconBestSeasonSpgSum;else var h='<div class=" time card"><img src="img/season_spring_summer.svg" class="best-season-guide" title="Best Season: Spring & Summer"></div>';else if(b===d)if(p)var h=images.roIconBestSeasonSpgAut;else var h='<div class=" time card"><img src="img/season_spring_autumn.svg" class="best-season-guide" title="Best Season: Spring & Autumn"></div>';else if(p)var h=images.roIconBestSeasonSpg;else var h='<div class=" time card"><img src="img/season_spring.svg" class="best-season-guide" title="Best Season: Spring"></div>';else if(c>=d&&c>e&&c>b)if(c===d)if(p)var h=images.roIconBestSeasonSumAut;else var h='<div class=" time card"><img src="img/season_summer_autumn.svg" class="best-season-guide" title="Best Season: Summer & Autumn"></div>';else if(p)var h=images.roIconBestSeasonSum;else var h='<div class=" time card"><img src="img/season_summer.svg" class="best-season-guide" title="Best Season: Summer"></div>';else if(p)var h=images.roIconBestSeasonAut;else var h='<div class=" time card"><img src="img/season_autumn.svg" class="best-season-guide" title="Best Season: Autumn"></div>';return h},self.displaySuggestedAttireIcons=function(a,b,c,d){function e(a,b){if(1===b)var c=document.getElementById("spring"),d=images.attireSpring;else if(2===b)var c=document.getElementById("summer"),d=images.attireSummer;else if(3===b)var c=document.getElementById("autumn"),d=images.attireAutumn;else var c=document.getElementById("winter"),d=images.attireWinter;var e=c.getContext("2d"),f=a,g=d;e.drawImage(g,0,0),e.drawImage(f,0,0)}function f(a){if(a>59)if(a>72)if(p)var b=images.roIconMiscOneBoardies;else var b=images.attireBoardies;else if(a>66)if(p)var b=images.roIconMiscOneWetSuitTwo;else var b=images.attireWetsuitTwo;else if(p)var b=images.roIconMiscOneWetSuitThree;else var b=images.attireWetsuitThree;else if(a>54)if(p)var b=images.roIconMiscOneWetSuitFour;else var b=images.attireWetsuitFour;else if(a>48)if(p)var b=images.roIconMiscOneWetSuitFive;else var b=images.attireWetsuitFive;else if(p)var b=images.roIconMiscOneWetSuitSix;else var b=images.attireWetsuitSix;return b}if(p){var g=getCurrentSeason();if("winter"===g)var h=f(a.winter);else if("spring"===g)var h=f(a.spring);else if("winter"===g)var h=f(a.summer);else if("autumn"===g)var h=f(a.autumn);return h}d.append('<div class=" water-temp spring card" title="Suggested Spring Attire"><canvas id="spring" width="'+b+'" height="'+c+'"></canvas>'),d.append('<div class=" water-temp summer card" title="Suggested Summer Attire"><canvas id="summer" width="'+b+'" height="'+c+'"></canvas>'),d.append('<div class=" water-temp autumn card" title="Suggested Autumn Attire"><canvas id="autumn" width="'+b+'" height="'+c+'"></canvas>'),d.append('<div class=" water-temp winter card" title="Suggested Winter Attire"><canvas id="winter" width="'+b+'" height="'+c+'"></canvas>');var i=0;for(var j in a){i++;var k=f(a[j]);e(k,i)}var g=getCurrentSeason();"winter"===g?$(".winter").addClass("highlight-attire"):"spring"===g?$(".spring").addClass("highlight-attire"):"winter"===g?$(".summer").addClass("highlight-attire"):"autumn"===g&&$(".autumn").addClass("highlight-attire")},self.displayClimateIcon=function(a){var b='<div class="climate card" title="Köppen Climate Classification"><p>'+a+"</p></div>";return b},self.displayCost=function(a,b){if(p)var c='<p class="rollover-info cost-rollover cost-hover-default-style ">$'+a.budget+"</p>";else var d=Math.floor((a.highEnd-a.budget)/2+a.budget),c=b.append('<div class="cost card"><img src="img/cost.svg" class="cost-guide" title="Estimated Daily Cost: Low, Mid, High"><p>'+a.budget+"</p><p>"+d+"</p><p>"+a.highEnd+"</p></div>");return c},self.displayDistance=function(a,b){function c(a){return a*(Math.PI/180);
}var d=currentLat,e=currentLng,f=3959,g=c(a-d),h=c(b-e),i=Math.sin(g/2)*Math.sin(g/2)+Math.cos(c(d))*Math.cos(c(a))*Math.sin(h/2)*Math.sin(h/2),j=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),k=f*j,l=Math.round(k);if(l>200){var m=l/450;if(1>m)var n=1;else var n=Math.round(m);if(n>8&&12>=n)var o=n+2,q=o;else if(n>12)var o=n+4,q=o;else var q=n;var r=q;if(p){var s='<p class="rollover-info distance-rollover distance-hover-default-style">'+r+"h</p>";return s}var t='<img src="img/distance_plane.svg" class="icon distance-guide" title="Estimated flight duration from your location"><p class="distance-guide-hours">'+r+"h</p>";return t}var u=l;if(p){var s='<p class="rollover-info distance-rollover distance-hover-default-style">'+u+"mi</p>";return s}var t='<img src="img/distance.svg" class="icon distance-guide" title="Estimated (straight line) distance in miles from your location (actual distance via roads will be greater) "><p class="distance-guide-miles">'+u+"mi</p>";return t},self.displayCurrentWaterTemp=function(a){var b=getCurrentSeason();switch(b){case"winter":var c=a.winter;break;case"spring":var c=a.spring;break;case"summer":var c=a.summer;break;case"autumn":var c=a.autumn}var d='<p class="rollover-info water-temp-rollover water-temp-hover-default-style ">'+c+"℉</p>";return d},self.displayWaveSize=function(a){if(a.aboveMax)var b="+";else var b="";if(p)var c='<p class="rollover-info wave-size-rollover wave-size-hover-default-style ">'+a.min+"-"+a.max+"'</p>";else var c='<div class=" wave-size card"><img src="img/wave_range.svg" class"wave-size-guide" title="Wave Size"><p>'+a.min+"-"+a.max+b+"ft</p></div>";return c},self.getCurrentSeason=function(){var a=new Date,b=a.getMonth();switch(b){case 11:case 0:case 1:var c="winter";break;case 2:case 3:case 4:var c="spring";break;case 5:case 6:case 7:var c="summer";break;case 8:case 9:case 10:var c="autumn"}return c},self.displayHazardIcons=function(a,b){function c(a,b){switch(a){case"beginners":if(p)var c=images.roIconMiscTwoBeginners;else b.append('<div class=" hazard card"><img src="img/hazards_beginners.svg" class="hazard-guide" title="Hazard: Beginners"></div>');break;case"boats":if(p)var c=images.roIconMiscTwoBoats;else b.append('<div class=" hazard card"><img src="img/hazards_boats.svg" class="hazard-guide" title="Hazard: Boats"></div>');break;case"crocs":if(p)var c=images.roIconMiscTwoCrocs;else b.append('<div class=" hazard card"><img src="img/hazards_crocs.svg" class="hazard-guide" title="Hazard: Crocodiles"></div>');break;case"crowded":if(p)var c=images.roIconMiscTwoCrowded;else b.append('<div class=" hazard card"><img src="img/hazards_crowded.svg" class="hazard-guide" title="Hazard: Crowded"></div>');break;case"dangerous break":if(p)var c=images.roIconMiscTwoDgrBreak;else b.append('<div class=" hazard card"><img src="img/hazards_dangerous_break.svg" class="hazard-guide" title="Hazard: Dangerous Break"></div>');break;case"far from shore":if(p)var c=images.roIconMiscTwoFar;else b.append('<div class=" hazard card"><img src="img/hazards_far_from_shore.svg" class="hazard-guide" title="Hazard: Far From Shore"></div>');break;case"pollution":if(p)var c=images.roIconMiscTwoPollution;else b.append('<div class=" hazard card"><img src="img/hazards_pollution.svg" class="hazard-guide" title="Hazard: Pollution"></div>');break;case"rocky bottom":if(p)var c=images.roIconMiscTwoRocky;else b.append('<div class=" hazard card"><img src="img/hazards_rocky_bottom.svg" class="hazard-guide" title="Hazard: Rocky Bottom"></div>');break;case"sea snakes":if(p)var c=images.roIconMiscTwoSnakes;else b.append('<div class=" hazard card"><img src="img/hazards_sea_snakes.svg" class="hazard-guide" title="Hazard: Sea Snakes"></div>');break;case"seals":if(p)var c=images.roIconMiscTwoSeals;else b.append('<div class=" hazard card"><img src="img/hazards_seals.svg" class="hazard-guide" title="Hazard: Seals"></div>');break;case"seaweed":if(p)var c=images.roIconMiscTwoSeaweed;else b.append('<div class=" hazard card"><img src="img/hazards_seaweed.svg" class="hazard-guide" title="Hazard: Seaweed"></div>');break;case"sewage":if(p)var c=images.roIconMiscTwoSewage;else b.append('<div class=" hazard card"><img src="img/hazards_sewage.svg" class="hazard-guide" title="Hazard: Sewage"></div>');break;case"shallow":if(p)var c=images.roIconMiscTwoShallow;else b.append('<div class=" hazard card"><img src="img/hazards_shallow.svg" class="hazard-guide" title="Hazard: Shallow Break"></div>');break;case"sharks":if(p)var c=images.roIconMiscTwoSharks;else b.append('<div class=" hazard card"><img src="img/hazards_sharks.svg" class="hazard-guide" title="Hazard: Sharks"></div>');break;case"strong currents":if(p)var c=images.roIconMiscTwoStrCurrent;else b.append('<div class=" hazard card"><img src="img/hazards_strong_currents.svg" class="hazard-guide" title="Hazard: Strong Currents"></div>');break;case"strong rips":if(p)var c=images.roIconMiscTwoStrRips;else b.append('<div class=" hazard card"><img src="img/hazards_strong_rips.svg" class="hazard-guide" title="Hazard: Strong Rips"></div>');break;case"theft":if(p)var c=images.roIconMiscTwoTheft;else b.append('<div class=" hazard card"><img src="img/hazards_theft.svg" class="hazard-guide" title="Hazard: Theft"></div>');break;case"undertow":if(p)var c=images.roIconMiscTwoUndertow;else b.append('<div class=" hazard card"><img src="img/hazards_undertow.svg" class="hazard-guide" title="Hazard: Strong Undertow"></div>');break;case"unfriendly":if(p)var c=images.roIconMiscTwoUnfriendly;else b.append('<div class=" hazard card"><img src="img/hazards_unfriendly.svg" class="hazard-guide" title="Hazard: Unfriendly Locals"></div>');break;case"urchins":if(p)var c=images.roIconMiscTwoUrchins;else b.append('<div class=" hazard card"><img src="img/hazards_urchins.svg" class="hazard-guide" title="Hazard: Urchins"></div>')}return c}if(p){var d=0,e=a.length,f=Math.floor(Math.random()*(e-d)+d),g=a[f],h=c(g);return h}for(var i=a.length,j=i;j--;)c(a[j],b)},self.getMagicSeaweed=function(a,b,c){function d(a){function c(){function a(){c.drawImage(f,0,0),c.save(),c.translate(150,150),c.rotate(g),c.drawImage(d,-150,-150),c.rotate(-g),c.rotate(h),c.drawImage(e,-150,-150),c.restore()}var b=document.getElementById("compass"),c=b.getContext("2d"),d=new Image;d.src="img/windPointer.svg";var e=new Image;e.src="img/swellPointer.svg";var f=new Image;f.src="img/compass.svg",f.onload=a;var g=n*(Math.PI/180),h=k*(Math.PI/180)}$(".surf-guide-container");if(f===b&&!$(".conditions-error").length){var d=a.swell.minBreakingHeight,e=a.swell.maxBreakingHeight;if(d===e)var h=d;else var h=d+" - "+e;for(var i=a.swell.components.primary.height,j=a.swell.components.primary.period,k=a.swell.components.primary.direction,l=a.swell.components.primary.compassDirection,m=a.wind.speed,n=a.wind.direction,o=a.wind.compassDirection,p=a.condition.temperature,q=a.condition.weather,r="http://cdnimages.magicseaweed.com/30x30/"+q+".png",s="img/wind.svg",t=[],u=a.solidRating,v='<img class="star" src="img/star_filled.svg"/>',w=u;w--;)t.push(v);for(var x=a.fadedRating,y='<img class="star" src="img/star_faded.svg"/>',w=x;w--;)t.push(y);for(var z=5-t.length,A='<img class="star" src="img/star_empty.svg"/>',w=z;w--;)t.push(A);var B=t.join(""),C='<div class="col-xs-12 surf-conditions-container live-surf-conditions"></div>',D='<div class="col-xs-12 col-sm-4 col-md-6 live-surf-conditions live-compass" title="Live wind & swell conditions"><canvas id="compass" width="300" height="300"></canvas></div>';g.after(D),$(".icon-frame").addClass("col-sm-6 sm-icon-frame"),$(".icon-container").addClass("md-icon-container"),g.after(C);var E=$(".surf-conditions-container"),F='<div class="col-xs-12 col-sm-6 surf-conditions-small surf-conditions-waves"></div>',G='<div class="col-xs-6 col-sm-3 surf-conditions-small surf-conditions-swell"></div>',H='<div class="col-xs-6 col-sm-3 surf-conditions-small surf-conditions-wind"></div>';E.append(F),E.append(G),E.append(H);var I=$(".title"),J='<p class="live-temp live-surf-conditions" title="Live weather conditions">'+p+' ℉<img class="live-weather" src="'+r+'" alt="Symbol for current weather"></p>',K='<a href="http://magicseaweed.com" target="_blank"><img src="img/msw_powered_by.png" class="live-surf-conditions msw-banner" title="Live conditions provided by MSW - Click to visit"></a>';I.after(K),I.after(J);var L=$(".surf-conditions-wind"),M=$(".surf-conditions-swell"),N=$(".surf-conditions-waves"),O="<p>"+m+"mph</p>",P='<img class="img-responsive" title="Wind direction & speed" src="'+s+'" alt="Symbol for wind">',Q="<p>"+o+" wind</p>";L.append(O),L.append(P),L.append(Q);var R="<p>"+i+"ft</p>",S='<p title="The main swell generating waves">primary</p>',T='<p title="Live period between waves & current direction">@ '+j+"s "+l+"</p>";M.append(R),M.append(S),M.append(T);var U='<p class="live-wave-height" title="Live wave height">'+h+"ft</p>",V='<p class="star-rating" title="Magic Seaweed Rating: The more solid stars, the better. Unfavorable wind conditions change a solid star to a faded star">'+B+"</p>";N.append(U),N.append(V),c();var W='<button type="button" class="btn conditions-close-button">✖</button>';N.prepend(W);var X=$(".conditions-close-button"),Y=$(".live-surf-conditions"),Z=$(".conditions-button"),_=$(".icon-frame"),aa=$(".icon-container");X.on("click",function(a){_.removeClass("col-sm-6 sm-icon-frame"),aa.removeClass("md-icon-container"),Y.toggle(),X.toggle(),Z.toggle()})}}function e(a){if(console.log("MSW api request unsuccessful"),f===b){var c='<div class="col-xs-12 error-frame"></div>',d='<div class="error-container"></div>',e='<p class="conditions-error">'+b+" conditions unavailable =(</p>",h='<button type="button" class="btn error-close-button">✖</button>';g.after(c);var i=$(".error-frame");i.append(d);var j=$(".error-container");j.append(e),j.prepend(h);var k=$(".error-close-button"),l=$(".conditions-close-button"),m=$(".conditions-button");k.on("click",function(a){j.remove(),l.remove(),m.toggle()})}}console.log("get current conditions");var f=$("#guide-break-name").text(),g=$(".guide-header");if("none"===a)$("#canvasLoader").remove(),e();else{var h=setTimeout(function(){$("#canvasLoader").remove(),e()},8e3),i="http://magicseaweed.com/api/d2983e394d07724e96404fba11c10485/forecast/?spot_id="+a+"&units=us&fields=timestamp,fadedRating,solidRating,swell.minBreakingHeight,swell.maxBreakingHeight,swell.components.primary.*,wind.*,condition.*";$.ajax({url:i,dataType:"jsonp",success:function(a){console.log("MSW api request successful");for(var b=Date.now(),c=b/1e3,e=c-10800,f=c+10800,g=a.length,i=g;i--;){var j=a[i].timestamp;if(c>j&&j>e)var k=a[i];else if(j>c&&f>j)var k=a[i]}d(k),clearTimeout(h),$("#canvasLoader").remove()}})}},$(".map-symbol").on("click",function(a){var b=$(".map-symbol"),g=$(".map-container"),h=$("#map"),i=$(".surf-guide-container"),j=($(".search-container"),$(window).scrollTop()),k=$(".map-section").height(),l=$(".location-frame"),m=$(".location-frame:visible").length;d?(b.toggleClass("map-default map-selected"),h.hide(),self.checkView(),g.show(),1==m&&l.length>1&&l.show(),g.slideToggle(200,function(){console.log("close map & any open infowindows"),makeMarkerSmall(),infoWindow.close()})):e?(document.body.scrollTop=document.documentElement.scrollTop=0,b.toggleClass("map-default map-selected"),h.is(":hidden")&&h.show(),self.checkView(),console.log("open map"),g.fadeIn(1e3),console.log("resize map"),google.maps.event.trigger(map,"resize"),setMapBounds()):f&&!c?(document.body.scrollTop=document.documentElement.scrollTop=0,b.toggleClass("map-default map-selected"),h.is(":hidden")&&h.show(),g.slideToggle(200,function(){h.is(":visible")?(console.log("open map"),console.log("resize map"),google.maps.event.trigger(map,"resize"),centerOnGuideMarker()):(console.log("close map & any open infowindows"),makeMarkerSmall(),infoWindow.close())})):c&&k>j||j>=k&&g.is(":hidden")?(document.body.scrollTop=document.documentElement.scrollTop=0,b.toggleClass("map-default map-selected"),h.is(":hidden")&&h.show(),1==m&&l.length>1&&l.show(),g.slideToggle(200,function(){h.is(":visible")?(console.log("open map"),i.is(":visible")?(console.log("resize map"),google.maps.event.trigger(map,"resize"),centerOnGuideMarker()):(console.log("resize map"),google.maps.event.trigger(map,"resize"),setMapBounds())):(console.log("close map & any open infowindows"),makeMarkerSmall(),infoWindow.close())})):(console.log("scroll to map"),document.body.scrollTop=document.documentElement.scrollTop=0)}),self.loadProgressBar=function(){var a=new CanvasLoader("progressBarContainer");return a.setColor("#00b8e6"),a.setShape("spiral"),a.setDiameter(72),a.setDensity(33),a.setRange(1),a.setFPS(23),a.show(),a},self.generateMarkers=function(a){for(var b=a.length,c=b;c--;){var d=a[c],e={lat:d.lat,lng:d.lng},f=d.breakName,g=d.location;self.addMarker(f,e,g,d)}google.maps.event.addListener(map,"idle",self.manageFrames),google.maps.event.addListener(map,"click",self.clickMap),showMarkers(map),setMapBounds()},self.addMarker=function(a,b,c,d){if(favoritesUpdated)if(console.log("error: marker favorites not updated! --update again"),userFavorites.indexOf(a)>-1)var e="img/marker_smallFav.svg";else var e="img/marker_small.svg";else var e="img/marker_small.svg";var f=new google.maps.Marker({position:b,map:map,icon:e,title:a+" ("+c+")"});self.addListeners(f,a,d)},self.addListeners=function(a,b,c){google.maps.event.addListener(a,"dblclick",function(a){return function(){map.setCenter(a.getPosition()),map.getZoom()<14&&map.setZoom(14)}}(a)),google.maps.event.addListener(a,"click",function(a,b,c){return function(){makeMarkerSmall(),self.manageFrames();var d=a.title.replace(/ *\([^)]*\) */g,"");"img/marker_small.svg"===a.icon?(console.log("make "+d+"'s marker big"),a.setIcon("img/marker_selected.svg")):"img/marker_smallFav.svg"===a.icon&&(console.log("make "+d+"'s marker big"),a.setIcon("img/marker_selectedFav.svg")),getInfoWindow(a,b),animateMarker(a),$(".surf-guide-container").is(":visible")?($(".surf-conditions").remove(),renderSurfGuide(c)):showLocationFrame(b)}}(a,b,c)),google.maps.event.addListener(a,"mouseover",function(a){return function(){var b=$(".location-frame:visible").length;$(".surf-guide-container").length||(pulsateLocationFrame(a),1!==b&&window.outerWidth>=768&&scrollToFrame(a))}}(b)),google.maps.event.addListener(a,"mouseout",function(a){return function(){$(".surf-guide-container").length||pulsateLocationFrame(a)}}(b)),markers.push(a)},self.clickMap=function(){makeMarkerSmall(),$(".surf-guide-container").is(":visible")||$(".location-frame").show(),infoWindow.close(),self.manageFrames()},self.manageFrames=function(){function a(a){self.locationArray.forEach(function(b){a===b.breakName&&self.locationGrid.push(b)})}if($("#map").is(":visible")){for(var b=markers.length,d=b;d--;)if("img/marker_selected.svg"===markers[d].icon||"img/marker_selectedFav.svg"===markers[d].icon)return;console.log("manage location frames"),self.locationGrid.removeAll();for(var d=b;d--;){var e=markers[d].title.replace(/ *\([^)]*\) */g,"");if(map.getBounds().contains(markers[d].getPosition()))if($(".search-container").is(":visible")){var f=self.Query().toLowerCase().replace(/ /g,"").replace(/'/g,"").replace(/,/g,"");markers[d].title.toLowerCase().replace(/ /g,"").replace(/'/g,"").replace(/,/g,"").indexOf(f)>-1&&a(e)}else a(e)}c||self.resetLocationFrames(),self.addRolloverEffect(),self.renderFavoriteOnLocationFrame()}}}function success(a){currentLat=a.coords.latitude,currentLng=a.coords.longitude}function initMap(){var a=[{featureType:"all",elemntType:"geometry",stylers:[{visibility:"off"}]},{featureType:"all",elemntType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elemntType:"geometry",stylers:[{color:"#FFFFFF"},{visibility:"on"}]},{featureType:"landscape",elemntType:"geometry",stylers:[{visibility:"on"},{color:"#99EB99"}]}],b=[{stylers:[{hue:"#99EB99"},{saturation:-20}]},{featureType:"water",elemntType:"geometry",stylers:[{color:"#FFFFFF"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"road.local",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:50},{color:"#00B8E6"}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"none"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"none"}]}],c=new google.maps.StyledMapType(a,{name:"Surf"}),d=new google.maps.StyledMapType(b,{name:"Drive"}),e={center:new google.maps.LatLng(20.67,-157.505),mapTypeControlOptions:{mapTypeIds:["drive_map_style","surf_map_style"]},disableDefaultUI:!0,zoomControl:!0,mapTypeControl:!0,scrollwheel:!1};map=new google.maps.Map(document.getElementById("map"),e),map.mapTypes.set("surf_map_style",c),map.mapTypes.set("drive_map_style",d),map.setMapTypeId("surf_map_style"),infoWindow=new google.maps.InfoWindow}function showMarkers(a){for(var b=markers.length,c=b;c--;)markers[c].setMap(a)}function setMapBounds(){console.log("set map bounds");for(var a=new google.maps.LatLngBounds,b=markers.length,c=b;c--;)markers[c].visible&&a.extend(markers[c].getPosition());map.fitBounds(a),map.getZoom()>12&&map.setZoom(12)}function centerOnGuideMarker(){console.log("center map to relevant marker");var a=$("#guide-break-name").text();markers.forEach(function(b){var c=b.title.replace(/ *\([^)]*\) */g,"");a===c&&(isInfoWindowOpen(infoWindow)||(console.log("info window & marker not activated"),makeMarkerBig(b,c),getInfoWindow(b,a)),map.setCenter(b.getPosition()),map.setZoom(10))})}function getInfoWindow(a,b){console.log("show "+b+"'s info window"),infoWindow.setContent(b),infoWindow.open(map,a)}function isInfoWindowOpen(a){var b=a.getMap();return null!==b&&"undefined"!=typeof b}function animateMarker(a){a.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(function(){a.setAnimation(null)},730)}function showLocationFrame(a){var b=$(".location-frame");b.hide(),b.each(function(){var b=$(this),c=b.text();c.indexOf(a)>-1&&(console.log("show only "+a+"'s location frame"),b.show())})}function pulsateLocationFrame(a){function b(a){setTimeout(function(){a.removeClass("reverse-pulse")},400)}var c=$(".location-frame"),d=$(".location-frame:visible").length;if(1!==d&&window.outerWidth>=768)c.each(function(){var c=$(this),d=c.text();d.indexOf(a)>-1&&($(".pulse-location-frame").length?(console.log("make "+a+"'s location frame small"),c.removeClass("pulse-location-frame").addClass("reverse-pulse"),b(c)):(console.log("make "+a+"'s location frame big"),c.removeClass("reverse-pulse").addClass("pulse-location-frame")))});else if(1===d&&$(".pulse-location-frame").length){var e=$(".location-frame:visible"),f=e[0].children[1].innerText;console.log("make "+f+"'s location frame small"),e.removeClass("pulse-location-frame").addClass("reverse-pulse"),b(e)}}function scrollToFrame(a){function b(){"undefined"!=typeof scrollLeftRunning&&scrollLeftRunning?(clearInterval(p),scrollLeftRunning=!1):"undefined"!=typeof scrollRightRunning&&scrollRightRunning&&(clearInterval(n),scrollRightRunning=!1),c.scrollLeft(l),console.log("move scroll position from "+f+" toward "+l),console.log("stop scrolling"),console.log("scroll position at: "+c.scrollLeft())}var c=$(".location-grid"),d=$(".location-frame"),e=$(".pulse-location-frame"),f=c.scrollLeft();"undefined"!=typeof scrollRightRunning&&scrollRightRunning?(console.log("clear right scrolling in progress"),clearInterval(n)):"undefined"!=typeof scrollLeftRunning&&scrollLeftRunning&&(console.log("clear left scrolling in progress"),clearInterval(p));var g=c.width(),h=d.outerWidth(!0),i=(g-h)/2,j=e.index(),k=h*j,l=k-i;if(console.log("auto scroll to "+a+"'s location frame"),l>f)var m=f,n=setInterval(function(){scrollRightRunning=!0,m+=50,l>m?c.scrollLeft(m):b()},1);else var o=f,p=setInterval(function(){scrollLeftRunning=!0,o-=50,o>l?c.scrollLeft(o):b()},1)}function makeMarkerSmall(){markers.forEach(function(a){var b=a.title.replace(/ *\([^)]*\) */g,"");"img/marker_selected.svg"===a.icon?(console.log("make "+b+"'s marker small"),a.setIcon("img/marker_small.svg")):"img/marker_selectedFav.svg"===a.icon&&(console.log("make "+b+"'s marker small"),a.setIcon("img/marker_smallFav.svg"))})}function makeMarkerBig(a,b){"img/marker_small.svg"===a.icon?(console.log("make "+b+"'s marker big"),a.setIcon("img/marker_selected.svg")):"img/marker_smallFav.svg"===a.icon&&(console.log("make "+b+"'s marker big"),a.setIcon("img/marker_selectedFav.svg"))}function updateFavMarkers(a){markers.forEach(function(b){var c=b.title.replace(/ *\([^)]*\) */g,"");a.indexOf(c)>-1?"img/marker_small.svg"===b.icon?(console.log("make "+c+"'s marker a favorite!"),b.setIcon("img/marker_smallFav.svg")):"img/marker_selected.svg"===b.icon&&(console.log("make "+c+"'s marker a favorite!"),b.setIcon("img/marker_selectedFav.svg")):"img/marker_smallFav.svg"===b.icon?(console.log("unfavorite "+c+"'s marker!"),b.setIcon("img/marker_small.svg")):"img/marker_selectedFav.svg"===b.icon&&(console.log("unfavorite "+c+"'s marker!"),b.setIcon("img/marker_selected.svg"))})}var imagesLoaded,locationsLoaded,favoritesUpdated=!1,images={};$(document).ready(function(){function a(a){for(var d in a)b++;for(var d in a)switch(images[d]=new Image,images[d].onload=function(){++c>=b&&(console.log("images loaded"),imagesLoaded=!0,locationsLoaded&&addRolloverEffect())},images[d].src=a[d],a){case e:images[d].className="rollover-info skill-level-rollover skill-level-hover-default-style";break;case f:images[d].className="rollover-info break-type-rollover break-type-hover-default-style";break;case g:images[d].className="rollover-info wave-direction-rollover wave-direction-hover-default-style";break;case h:images[d].className="rollover-info best-season-rollover best-season-hover-default-style";break;case i:images[d].className="rollover-info misc-info-one-rollover misc-info-one-hover-default-style";break;case j:images[d].className="rollover-info misc-info-two-rollover misc-info-two-hover-default-style"}}$("[title]").tooltip({show:!0,hide:"fade"}),console.log("tooltips loaded");var b=0,c=0,d={attireSpring:"img/water_temp_spring.svg",attireSummer:"img/water_temp_summer.svg",attireAutumn:"img/water_temp_autumn.svg",attireWinter:"img/water_temp_winter.svg",attireBoardies:"img/water_attire_boardies.svg",attireWetsuitTwo:"img/water_attire_2mm_wetsuit.svg",attireWetsuitThree:"img/water_attire_3mm_wetsuit.svg",attireWetsuitFour:"img/water_attire_4mm_wetsuit.svg",attireWetsuitFive:"img/water_attire_5mm_wetsuit.svg",attireWetsuitSix:"img/water_attire_6mm_wetsuit.svg",swellPointer:"img/compass_swell_pointer.svg",windPointer:"img/compass_wind_pointer.svg",smallCompass:"img/compass_guide.svg"},e={roIconSkillAll:"img/skill_level_ro_all.svg",roIconSkillBegInt:"img/skill_level_ro_beginner_intermediate.svg",roIconSkillBeg:"img/skill_level_ro_beginner.svg",roIconSkillIntAdv:"img/skill_level_ro_intermediate_advanced.svg",roIconSkillInt:"img/skill_level_ro_intermediate.svg",roIconSkillAdv:"img/skill_level_ro_advanced.svg"},f={roIconBreakReef:"img/break_ro_reef.svg",roIconBreakBeach:"img/break_ro_beach.svg",roIconBreakPoint:"img/break_ro_point.svg",roIconBreakRiver:"img/break_ro_river_mouth.svg"},g={roIconDirectionLeft:"img/direction_ro_left.svg",roIconDirectionRight:"img/direction_ro_right.svg",roIconDirectionBoth:"img/direction_ro_both.svg"},h={roIconBestSeasonAll:"img/season_ro_all.svg",roIconBestSeasonWinSpr:"img/season_ro_winter_spring.svg",roIconBestSeasonWinSum:"img/season_ro_winter_summer.svg",roIconBestSeasonWinAut:"img/season_ro_winter_autumn.svg",roIconBestSeasonWin:"img/season_ro_winter.svg",roIconBestSeasonSpgSum:"img/season_ro_spring_summer.svg",roIconBestSeasonSpgAut:"img/season_ro_spring_autumn.svg",roIconBestSeasonSpg:"img/season_ro_spring.svg",roIconBestSeasonSumAut:"img/season_summer_autumn.svg",roIconBestSeasonSum:"img/season_summer.svg",roIconBestSeasonAut:"img/season_autumn.svg"},i={roIconMiscOneBoardies:"img/water_attire_ro_boardies.svg",roIconMiscOneWetSuitTwo:"img/water_attire_ro_2mm_wetsuit.svg",roIconMiscOneWetSuitThree:"img/water_attire_ro_3mm_wetsuit.svg",roIconMiscOneWetSuitFour:"img/water_attire_ro_4mm_wetsuit.svg",roIconMiscOneWetSuitFive:"img/water_attire_ro_5mm_wetsuit.svg",roIconMiscOneWetSuitSix:"img/water_attire_ro_6mm_wetsuit.svg",roIconMiscOneBigWave:"img/big_wave_ro.svg"},j={roIconMiscTwoBeginners:"img/hazards_ro_beginners.svg",roIconMiscTwoBoats:"img/hazards_ro_boats.svg",roIconMiscTwoCrocs:"img/hazards_ro_crocs.svg",roIconMiscTwoCrowded:"img/hazards_ro_crowded.svg",roIconMiscTwoDgrBreak:"img/hazards_ro_dangerous_break.svg",roIconMiscTwoFar:"img/hazards_ro_far_from_shore.svg",roIconMiscTwoPollution:"img/hazards_ro_pollution.svg",roIconMiscTwoRocky:"img/hazards_ro_rocky_bottom.svg",roIconMiscTwoSnakes:"img/hazards_ro_sea_snakes.svg",roIconMiscTwoSeals:"img/hazards_ro_seals.svg",roIconMiscTwoSeaweed:"img/hazards_ro_seaweed.svg",roIconMiscTwoSewage:"img/hazards_ro_sewage.svg",roIconMiscTwoShallow:"img/hazards_ro_sharks.svg",roIconMiscTwoSharks:"img/hazards_ro_sharks.svg",roIconMiscTwoStrCurrent:"img/hazards_ro_strong_currents.svg",roIconMiscTwoStrRips:"img/hazards_ro_strong_rips.svg",roIconMiscTwoTheft:"img/hazards_ro_theft.svg",roIconMiscTwoUndertow:"img/hazards_ro_undertow.svg",roIconMiscTwoUnfriendly:"img/hazards_ro_unfriendly.svg",roIconMiscTwoUrchins:"img/hazards_ro_urchins.svg",roIconMiscTwoWellknown:"img/well_known_ro.svg"};a(d),a(e),a(f),a(g),a(h),a(i),a(j)}),navigator.geolocation.getCurrentPosition(success);var map,infoWindow,markers=[];ko.applyBindings(new AppViewModel);