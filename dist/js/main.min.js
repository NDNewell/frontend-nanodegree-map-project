function initMap(){var a=[{featureType:"administrative",elementType:"all",stylers:[{color:"#525252"},{visibility:"off"}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"all",stylers:[{visibility:"simplified"},{color:"#525252"}]},{featureType:"landscape",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{visibility:"simplified"},{color:"#525252"}]},{featureType:"poi",elementType:"all",stylers:[{color:"#525252"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"road.local",elementType:"geometry",stylers:[{visibility:"simplified"}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:50},{color:"#e8e7e7"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.line",elementType:"all",stylers:[{visibility:"simplified"},{color:"#e8e7e7"}]},{featureType:"transit.station.airport",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#56c4d1"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]}],b=new google.maps.StyledMapType(a,{name:"Map"});map=new google.maps.Map(document.getElementById("map"),{mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,mapTypeIds:["custom_style",google.maps.MapTypeId.SATELLITE]},disableDefaultUI:!0,zoomControl:!0,rotateControl:!0,streetViewControl:!0,mapTypeControl:!0,scrollwheel:!1,scaleControl:!0}),map.setTilt(45),map.mapTypes.set("custom_style",b),map.setMapTypeId("custom_style"),infoWindow=new google.maps.InfoWindow}function success(a){console.log("get user's location"),currentLat=a.coords.latitude,currentLng=a.coords.longitude}function AppViewModel(){this.self=this;var a={},b=0,c=0;self.loadImages=function(d){for(var k in d)b++;for(var k in d)switch(a[k]=new Image,a[k].onload=function(){function a(){console.log("locations loaded"),console.log("add hover effects"),self.addRolloverEffect()}++c>=b&&(console.log("images loaded"),self.locationArray.length>1?a():checkLocations=setInterval(function(){self.locationArray.length>1&&(clearInterval(checkLocations),a())},500))},a[k].src=d[k],d){case e:a[k].className="rollover-info skill-level-rollover skill-level-hover-default-style hover-tooltip-only ";break;case f:a[k].className="rollover-info break-type-rollover break-type-hover-default-style hover-tooltip-only ";break;case g:a[k].className="rollover-info wave-direction-rollover wave-direction-hover-default-style hover-tooltip-only ";break;case h:a[k].className="rollover-info best-season-rollover best-season-hover-default-style hover-tooltip-only ";break;case i:a[k].className="rollover-info misc-info-one-rollover misc-info-one-hover-default-style hover-tooltip-only ";break;case j:a[k].className="rollover-info misc-info-two-rollover misc-info-two-hover-default-style hover-tooltip-only "}};var d={attireSpring:"img/water_temp_spring.svg",attireSummer:"img/water_temp_summer.svg",attireAutumn:"img/water_temp_autumn.svg",attireWinter:"img/water_temp_winter.svg",attireBoardies:"img/water_attire_boardies.svg",attireWetsuitTwo:"img/water_attire_2mm_wetsuit.svg",attireWetsuitThree:"img/water_attire_3mm_wetsuit.svg",attireWetsuitFour:"img/water_attire_4mm_wetsuit.svg",attireWetsuitFive:"img/water_attire_5mm_wetsuit.svg",attireWetsuitSix:"img/water_attire_6mm_wetsuit.svg",swellPointer:"img/compass_swell_pointer.svg",windPointer:"img/compass_wind_pointer.svg",smallSwellPointer:"img/compass_swell_pointer_guide.svg",smallWindPointer:"img/compass_wind_pointer_guide.svg",smallCompass:"img/compass_guide.svg"},e={roIconSkillAll:"img/skill_level_ro_all.svg",roIconSkillBegInt:"img/skill_level_ro_beginner_intermediate.svg",roIconSkillBeg:"img/skill_level_ro_beginner.svg",roIconSkillIntAdv:"img/skill_level_ro_intermediate_advanced.svg",roIconSkillInt:"img/skill_level_ro_intermediate.svg",roIconSkillAdv:"img/skill_level_ro_advanced.svg"},f={roIconBreakReef:"img/break_ro_reef.svg",roIconBreakBeach:"img/break_ro_beach.svg",roIconBreakPoint:"img/break_ro_point.svg",roIconBreakRiver:"img/break_ro_river_mouth.svg"},g={roIconDirectionLeft:"img/direction_ro_left.svg",roIconDirectionRight:"img/direction_ro_right.svg",roIconDirectionBoth:"img/direction_ro_both.svg"},h={roIconBestSeasonAll:"img/season_ro_all.svg",roIconBestSeasonWinSpr:"img/season_ro_winter_spring.svg",roIconBestSeasonWinSum:"img/season_ro_winter_summer.svg",roIconBestSeasonWinAut:"img/season_ro_winter_autumn.svg",roIconBestSeasonWin:"img/season_ro_winter.svg",roIconBestSeasonSpgSum:"img/season_ro_spring_summer.svg",roIconBestSeasonSpgAut:"img/season_ro_spring_autumn.svg",roIconBestSeasonSpg:"img/season_ro_spring.svg",roIconBestSeasonSumAut:"img/season_summer_autumn.svg",roIconBestSeasonSum:"img/season_summer.svg",roIconBestSeasonAut:"img/season_autumn.svg"},i={roIconMiscOneBoardies:"img/water_attire_ro_boardies.svg",roIconMiscOneWetSuitTwo:"img/water_attire_ro_2mm_wetsuit.svg",roIconMiscOneWetSuitThree:"img/water_attire_ro_3mm_wetsuit.svg",roIconMiscOneWetSuitFour:"img/water_attire_ro_4mm_wetsuit.svg",roIconMiscOneWetSuitFive:"img/water_attire_ro_5mm_wetsuit.svg",roIconMiscOneWetSuitSix:"img/water_attire_ro_6mm_wetsuit.svg",roIconMiscOneBigWave:"img/big_wave_ro.svg"},j={roIconMiscTwoBeginners:"img/hazards_ro_beginners.svg",roIconMiscTwoBoats:"img/hazards_ro_boats.svg",roIconMiscTwoCrocs:"img/hazards_ro_crocs.svg",roIconMiscTwoCrowded:"img/hazards_ro_crowded.svg",roIconMiscTwoDgrBreak:"img/hazards_ro_dangerous_break.svg",roIconMiscTwoFar:"img/hazards_ro_far_from_shore.svg",roIconMiscTwoPollution:"img/hazards_ro_pollution.svg",roIconMiscTwoRocky:"img/hazards_ro_rocky_bottom.svg",roIconMiscTwoSnakes:"img/hazards_ro_sea_snakes.svg",roIconMiscTwoSeals:"img/hazards_ro_seals.svg",roIconMiscTwoSeaweed:"img/hazards_ro_seaweed.svg",roIconMiscTwoSewage:"img/hazards_ro_sewage.svg",roIconMiscTwoShallow:"img/hazards_ro_sharks.svg",roIconMiscTwoSharks:"img/hazards_ro_sharks.svg",roIconMiscTwoStrCurrent:"img/hazards_ro_strong_currents.svg",roIconMiscTwoStrRips:"img/hazards_ro_strong_rips.svg",roIconMiscTwoTheft:"img/hazards_ro_theft.svg",roIconMiscTwoUndertow:"img/hazards_ro_undertow.svg",roIconMiscTwoUnfriendly:"img/hazards_ro_unfriendly.svg",roIconMiscTwoUrchins:"img/hazards_ro_urchins.svg",roIconMiscTwoWellknown:"img/well_known_ro.svg"};self.loadImages(d),self.loadImages(e),self.loadImages(f),self.loadImages(g),self.loadImages(h),self.loadImages(i),self.loadImages(j),self.makeSVGInline=function(a){var b=a,c=b.attr("class"),d=b.attr("src");$.get(d,function(a){var d=$(a).find("svg");"undefined"!=typeof c&&(d=d.attr("class",c)),d=d.removeAttr("xmlns:a"),b.replaceWith(d)},"xml")},self.makeSVGInline($(".search-symbol-desktop")),self.makeSVGInline($(".search-symbol-mobile")),self.makeSVGInline($(".favorite-filter-symbol-desktop")),self.makeSVGInline($(".favorite-filter-symbol-mobile")),self.makeSVGInline($(".map-symbol-desktop")),self.makeSVGInline($(".map-symbol-mobile"));var k=setTimeout(function(){showLocationsLoadError()},15e3),l="https://dazzling-torch-4012.firebaseio.com/locationData.json?";console.log("get location data"),$.ajax({url:l,dataType:"jsonp",success:function(a){function b(){console.log("Google maps api loaded"),console.log("generate map markers"),self.generateMarkers(a),self.addMapListeners()}if(console.log("get location data successful"),self.parseLocationData(a),"object"==typeof google&&"object"==typeof google.maps)b();else var c=setInterval(function(){console.log("error: Google maps api NOT loaded"),console.log("load Google maps api again"),"object"==typeof google&&"object"==typeof google.maps&&(b(),clearInterval(c))},500)}}),self.locationArray=[],self.locationGrid=ko.observableArray(""),self.searchKeywords=[],self.parseLocationData=function(a){a.forEach(function(a){self.locationArray.push(a),self.locationGrid.push(a),self.searchKeywords.push(a.breakName),searchKeywords.indexOf(a.location)<0&&self.searchKeywords.push(a.location)}),clearTimeout(k)},self.showLocationsLoadError=function(){console.log("get location data unsuccessful"),$(".search-container").toggle(),$(".search-section").toggle(),$(".map-section").toggle(),$(".surf-info-section").toggle(),$(".list-section").toggle();var a='<section class="error-section"><div class="row"><div class="col-xs-12 data-load-error-container"><img src="img/no_connection.svg" class="no-connection"><p>Dude! Really?! =(</p></div></div></section>',b='<button type="button" class="btn reload-button">Reload</button>';$("header").after(a),$(".data-load-error-container").append(b),$(".reload-button").on("click",function(a){location=location})};var m=new Firebase("https://dazzling-torch-4012.firebaseio.com"),n=new Firebase("https://dazzling-torch-4012.firebaseio.com/locationData"),o=new Firebase("https://dazzling-torch-4012.firebaseio.com/users"),p=function(a){a?console.log("data could not be saved."+a):console.log("data saved successfully.")},q=function(a){console.log("the read failed: "+a.code)};self.updateFavsOnFrames=function(){console.log("display 'favorite' icons on relevant location frames");var a=$(".location-frame");a.each(function(){var a=$(this),b=a.children(":nth-child(3)"),c=a.children(":nth-child(2)").text();userFavorites.indexOf(c)>-1?b.removeClass("not-a-favorite").addClass("is-a-favorite"):b.hasClass("is-a-favorite")&&b.addClass("not-a-favorite").removeClass("is-a-favorite")})},userFavorites=[],self.getFavorites=function(a){function b(){o.child(a.uid).child("favorites").on("value",function(a){var b=a.val();if(userFavorites=[],null===b){console.log("user has no favorites");var b=[];self.updateFavMarkers(b)}else self.updateFavMarkers(b),b.forEach(function(a){userFavorites.push(a)}),console.log("the user's favorite(s) is/are: "+userFavorites.join(", ")),self.updateFavsOnFrames()},q)}if(null===a)console.log("cannot find favorites because there are no logged in users");else{var c=0;n.on("value",function(a){var b=a.val();b.forEach(function(a){c++})});var d=setInterval(function(){c===s.length&&s.length>0&&(console.log(s.length+" out of "+c+" markers loaded"),console.log("update favorites"),b(),clearInterval(d))},1e3)}};var r;self.checkAuthentication=function(a){a?(console.log("user "+a.uid+" is logged in with "+a.provider),r=!1,self.getFavorites(a)):(console.log("user is logged out"),r=!0)},m.onAuth(self.checkAuthentication),r&&m.authAnonymously(function(a,b){a?console.log("login Failed!",a):m.child("users").child(b.uid).set({favorites:[],name:prompt("Please enter your name")})}),self.showUser=function(){var a=m.getAuth();o.child(a.uid).child("name").on("value",function(a){var b=a.val();console.log(b+" is currently logged in")},q)},setInterval(self.showUser,6e4),self.addFavorite=function(a){userFavorites.push(a),o.child(m.getAuth().uid).update({favorites:userFavorites},p)},self.removeFavorite=function(a){var b=[];userFavorites.forEach(function(c){a!==c&&b.push(c)}),o.child(m.getAuth().uid).update({favorites:b},p)},self.removeAllFavorites=function(){userFavorites=[],self.updateFavsOnFrames(),o.child(m.getAuth().uid).update({favorites:userFavorites},p)};var s=[];self.generateMarkers=function(a){for(var b=a.length,c=b;c--;){var d=a[c],e={lat:d.lat,lng:d.lng},f=d.breakName,g=d.location;self.addMarker(f,e,g,d)}self.displayMarkers(map),$("#map").is(":visible")&&self.setMapBounds()},self.addMarker=function(a,b,c,d){var e=new google.maps.Marker({position:b,map:map,icon:"img/marker_small.svg",title:a+" ("+c+")"});self.addMarkerListeners(e,d)},self.addMarkerListeners=function(a,b){google.maps.event.addListener(a,"dblclick",function(b){return function(){map.setCenter(a.getPosition()),map.getZoom()<14&&map.setZoom(14)}}(a)),google.maps.event.addListener(a,"click",function(c){return function(){self.makeMarkerSmall(),self.makeMarkerBig(a),self.getInfoWindow(a),self.animateMarker(a),H?($(".surf-conditions").remove(),renderSurfGuide(b)):self.focusOnFrame(a)}}(a,b)),google.maps.event.addListener(a,"mouseover",function(b){return function(){self.removeTitle();var b=$(".location-frame:visible").length;$(".surf-guide-container").length||(self.pulseFrame(a),1!==b&&window.innerWidth>=768&&self.scrollToFrame(a))}}()),google.maps.event.addListener(a,"mouseout",function(b){return function(){$(".surf-guide-container").length||self.pulseFrame(a)}}()),s.push(a),v.push(a.title)},self.displayMarkers=function(a){for(var b=s.length,c=b;c--;)s[c].setMap(a)},self.getMarkerName=function(a){var b=a.title.replace(/ *\([^)]*\) */g,"");return b},self.animateMarker=function(a){a.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(function(){a.setAnimation(null)},730)},self.makeMarkerBig=function(a){var b=getMarkerName(a);"img/marker_small.svg"===a.icon?(console.log("make "+b+"'s marker big"),a.setIcon("img/marker_selected.svg")):"img/marker_smallFav.svg"===a.icon&&(console.log("make "+b+"'s marker big"),a.setIcon("img/marker_selectedFav.svg"))},self.makeMarkerSmall=function(){s.forEach(function(a){var b=getMarkerName(a);"img/marker_selected.svg"===a.icon?(console.log("make "+b+"'s marker small"),a.setIcon("img/marker_small.svg")):"img/marker_selectedFav.svg"===a.icon&&(console.log("make "+b+"'s marker small"),a.setIcon("img/marker_smallFav.svg"))})},self.getGuideMarker=function(){for(var a=$("#guide-break-name").text(),b=s.length,c=b;c--;){var d=s[c],e=getMarkerName(d);if(a===e)return d}},self.activateMarker=function(a){s.forEach(function(b){var c=getMarkerName(b);c===a&&self.makeMarkerBig(b)})},self.resetMarkers=function(){console.log("reset markers");for(var a=s.length,b=a;b--;){var c=s[b];self.filterMarkers(c)}},self.updateFavMarkers=function(a){s.forEach(function(b){var c=getMarkerName(b);a.indexOf(c)>-1?"img/marker_small.svg"===b.icon?(console.log("make "+c+"'s marker a favorite"),b.setIcon("img/marker_smallFav.svg")):"img/marker_selected.svg"===b.icon&&(console.log("make "+c+"'s marker a favorite"),b.setIcon("img/marker_selectedFav.svg")):"img/marker_smallFav.svg"===b.icon?(console.log("unfavorite "+c+"'s marker"),b.setIcon("img/marker_small.svg")):"img/marker_selectedFav.svg"===b.icon&&(console.log("unfavorite "+c+"'s marker"),b.setIcon("img/marker_selected.svg"))})},self.checkVisibleMarkers=function(){var a=s.length;numMarkersVisible=0;for(var b=a;b--;){var c=s[b];c.getVisible()&&numMarkersVisible++}numMarkersVisible<1?$(".reset-map-container").length||H||(console.log("no markers visible"),self.repositionMap()):$(".reset-map-container").length&&$(".reset-map-container").remove()},self.filterMarkers=function(a){var b=getMarkerName(a);if($(".search-container").is(":visible")){var c=self.formatText(self.Query()),b=self.formatText(a.title);b.indexOf(c)>-1&&a.setVisible(!0)}else $(".favorite-filter-selected").length?userFavorites.indexOf(b)>-1&&a.setVisible(!0):a.setVisible(!0)},self.manageMarkers=function(){console.log("manage markers");for(var a=s.length,b=a;b--;){var c=s[b];map.getBounds().contains(c.getPosition())?self.filterMarkers(c):"img/marker_selected.svg"===c.icon||"img/marker_selectedFav.svg"===c.icon?c.setVisible(!0):c.setVisible(!1)}self.checkVisibleMarkers()},self.clickLocationFrame=function(a){if(t=!1,self.renderSurfGuide(a),$(".map-container").is(":visible")){var b=self.getGuideMarker();self.animateMarker(b)}self.manageView()},self.scrollToFrame=function(a){function b(){"undefined"!=typeof scrollLeftRunning&&scrollLeftRunning?(clearInterval(q),scrollLeftRunning=!1):"undefined"!=typeof scrollRightRunning&&scrollRightRunning&&(clearInterval(o),scrollRightRunning=!1),c.scrollLeft(m),console.log("move scroll position from "+f+" toward "+m),console.log("stop scrolling"),console.log("scroll position at: "+c.scrollLeft())}var c=$(".location-grid"),d=$(".location-frame"),e=$(".pulse-location-frame"),f=c.scrollLeft(),g=getMarkerName(a);"undefined"!=typeof scrollRightRunning&&scrollRightRunning?(console.log("clear right scrolling in progress"),clearInterval(o)):"undefined"!=typeof scrollLeftRunning&&scrollLeftRunning&&(console.log("clear left scrolling in progress"),clearInterval(q));var h=c.width(),i=d.outerWidth(!0),j=(h-i)/2,k=e.siblings(":visible").addBack().index(e),l=i*k,m=l-j;if(console.log("auto scroll to "+g+"'s location frame"),m>f)var n=f,o=setInterval(function(){scrollRightRunning=!0,n+=70,m>n?c.scrollLeft(n):b()},1);else var p=f,q=setInterval(function(){scrollLeftRunning=!0,p-=70,p>m?c.scrollLeft(p):b()},1)},self.pulseFrame=function(a){function b(a){setTimeout(function(){a.removeClass("reverse-pulse")},400)}var c=$(".location-frame"),d=$(".location-frame:visible").length,e=getMarkerName(a);if(1!==d&&window.innerWidth>=768)c.each(function(){var a=$(this),c=a.children(":nth-child(2)").text();c===e&&($(".pulse-location-frame").length?(console.log("make "+e+"'s location frame small"),a.removeClass("pulse-location-frame").addClass("reverse-pulse"),b(a)):(console.log("make "+e+"'s location frame big"),a.removeClass("reverse-pulse").addClass("pulse-location-frame")))});else if(1===d&&$(".pulse-location-frame").length){var f=$(".location-frame:visible"),g=f[0].children[1].textContent;console.log("make "+g+"'s location frame small"),f.removeClass("pulse-location-frame").addClass("reverse-pulse"),b(f)}},self.adjustFrameStyle=function(){var a=$(".location-frame"),b=$(".location-name"),c=$(".break-name"),d=$(".favorite");a.addClass("location-frame-map-view-style").removeClass("location-frame-default-style"),a.each(function(){var a=$(this);a.is(":visible")&&a.css("display","inline-block")}),a.removeClass("col-xs-12 col-sm-6 col-md-4"),c.removeClass("break-name-default-style").addClass("break-name-map-view-style"),b.removeClass("location-name-default-style").addClass("location-name-map-view-style"),d.attr("class","favorite favorite-map-view-style")},self.resetFrames=function(){console.log("reset location frames");var a=s.length,b=$(".location-frame");b.hide();for(var c=a;c--;){var d=s[c];self.filterFrames(d)}},self.focusOnFrame=function(a){var b=getMarkerName(a),c=$(".location-frame");c.hide(),c.each(function(){var a=$(this),c=a.children(":nth-child(2)").text();c===b&&(console.log("show only "+b+"'s location frame"),a.show())})},self.filterFrames=function(a){function b(a){var b=$(".location-frame");b.each(function(){var b=$(this),c=b.children(":nth-child(2)").text();c===a&&b.show()})}var c=getMarkerName(a);if($(".search-container").is(":visible")){var d=self.formatText(self.Query()),e=self.formatText(a.title);e.indexOf(d)>-1&&b(c)}else $(".favorite-filter-selected").length?userFavorites.indexOf(c)>-1&&b(c):b(c)},self.manageFrames=function(){for(var a=s.length,b=a;b--;)if("img/marker_selected.svg"===s[b].icon||"img/marker_selectedFav.svg"===s[b].icon)return;console.log("manage location frames");var c=$(".location-frame");c.hide();for(var b=a;b--;){var d=s[b];map.getBounds().contains(d.getPosition())&&self.filterFrames(d)}},self.addMapListeners=function(){google.maps.event.addListener(map,"idle",function(){!$("#map").is(":visible")||J||H||(self.manageFrames(),self.manageMarkers())}),google.maps.event.addListener(map,"click",function(){self.makeMarkerSmall(),infoWindow.close(),H||(self.manageMarkers(),self.manageFrames())})},self.addMapZoomListener=function(){var a=setInterval(function(){var b=$(".gm-style").children(":nth-child(8)").children(":nth-child(1)");b.length?(console.log("zoom listener loaded"),clearInterval(a),"undefined"!=typeof zoomListener&&b.off("click",zoomListener),b.on("click",function(){if(!H)for(var a=s.length,b=a;b--;){var c=s[b];("img/marker_selectedFav.svg"===c.icon||"img/marker_selected.svg"===c.icon)&&self.centerOnMarker(c)}})):console.log("zoom listener not loaded")},1e3)},self.repositionMap=function(){function a(){console.log("reposition map"),d.remove();s.length;self.resetMarkers(),self.setMapBounds(),d.remove()}var b='<div class="reset-map-container"></div>',c=$(".location-grid");c.append(b);var d=$(".reset-map-container"),e='<img src="img/reset_button.svg" class="reset-button" alt="reload location frames and markers button">';d.append(e),$resetButton=$(".reset-button"),$resetButton.on("click",function(){a()})},self.setMarkerForGuide=function(){var a=self.getGuideMarker();if(self.makeMarkerBig(a),isInfoWindowOpen(infoWindow))self.centerOnMarker(a),map.setZoom(10);else{self.getInfoWindow(a);setTimeout(function(){self.centerOnMarker(a),map.setZoom(10)},150)}},self.centerOnMarker=function(a){var b=self.getMarkerName(a);console.log("resize map"),google.maps.event.trigger(map,"resize"),console.log("center map over "+b),map.setCenter(a.getPosition())},self.setMapBounds=function(){console.log("set map bounds");for(var a=new google.maps.LatLngBounds,b=s.length,c=b;c--;)s[c].visible&&a.extend(s[c].getPosition());map.fitBounds(a),map.getZoom()>12&&map.setZoom(12)},self.adjustMapSize=function(){var a=$(".location-grid").outerHeight(),b=$("#myNavbar").outerHeight(),c=$(window).height(),d=$(".map-container"),e=$(".search-container");if(e.is(":visible"))var f=e.outerHeight(),g=c-(a+f+b);else var g=c-(a+b);d.css("height",g),0!==s.length&&$("#map").is(":visible")&&!J&&(google.maps.event.trigger(map,"resize"),self.setMapBounds())},self.getInfoWindow=function(a){var b=getMarkerName(a);console.log("show "+b+"'s info window");var c='<div class="info-window"><p>'+b+"</p><div>";infoWindow.setContent(c),infoWindow.open(map,a);var d=$(".gm-style-iw");$iwFrame=d.parent(),$iwContainer=d.parent().parent(),$iwFrame.children(":nth-child(1)").children(":nth-child(3)").css("display","none"),$iwFrame.children(":nth-child(1)").children(":nth-child(1)").css("display","none"),$iwFrame.children(":nth-child(1)").children(":nth-child(4)").css("display","none"),$iwFrame.children(":nth-child(1)").children(":nth-child(2)").css("display","none"),$iwFrame.children(":nth-child(3)").css("display","none"),$iwContainer.css("pointer-events","none"),$iwContainer.on("mousemove",function(a){$(this).next().trigger(a)}),$iwContainer.css({left:"11px",top:"42px"})},self.isInfoWindowOpen=function(a){var b=a.getMap();return null!==b&&"undefined"!=typeof b},self.toggleRolloverClasses=function(){var a=$(".skill-level-rollover"),b=$(".break-type-rollover"),c=$(".wave-direction-rollover");$bestSeasonIcon=$(".best-season-rollover"),$miscInfoOneIcon=$(".misc-info-one-rollover"),$miscInfoTwoIcon=$(".misc-info-two-rollover"),$distanceInfo=$(".distance-rollover"),$waterTempInfo=$(".water-temp-rollover"),$waveSizeInfo=$(".wave-size-rollover"),$costInfo=$(".cost-rollover"),t?(console.log("adjust hover icons and info to map view style"),a.addClass("skill-level-hover-map-view-style").removeClass("skill-level-hover-default-style"),b.addClass("break-type-hover-map-view-style").removeClass("break-type-hover-default-style"),c.addClass("wave-direction-hover-map-view-style").removeClass("wave-direction-hover-default-style"),$bestSeasonIcon.addClass("best-season-hover-map-view-style").removeClass("best-season-hover-default-style"),$miscInfoOneIcon.addClass("misc-info-one-hover-map-view-style").removeClass("misc-info-one-hover-default-style"),$miscInfoTwoIcon.addClass("misc-info-two-hover-map-view-style").removeClass("misc-info-two-hover-default-style"),$distanceInfo.addClass("distance-hover-map-view-style").removeClass("distance-hover-default-style"),$waterTempInfo.addClass("water-temp-hover-map-view-style").removeClass("water-temp-hover-default-style"),$waveSizeInfo.addClass("wave-size-hover-map-view-style").removeClass("wave-size-hover-default-style"),$costInfo.addClass("cost-hover-map-view-style").removeClass("cost-hover-default-style")):(console.log("revert hover icons and info back to default style"),a.addClass("skill-level-hover-default-style").removeClass("skill-level-hover-map-view-style"),b.addClass("break-type-hover-default-style").removeClass("break-type-hover-map-view-style"),c.addClass("wave-direction-hover-default-style").removeClass("wave-direction-hover-map-view-style"),$bestSeasonIcon.addClass("best-season-hover-default-style").removeClass("best-season-hover-map-view-style"),$miscInfoOneIcon.addClass("misc-info-one-hover-default-style").removeClass("misc-info-one-hover-map-view-style"),$miscInfoTwoIcon.addClass("misc-info-two-hover-default-style").removeClass("misc-info-two-hover-map-view-style"),$distanceInfo.addClass("distance-hover-default-style").removeClass("distance-hover-map-view-style"),$waterTempInfo.addClass("water-temp-hover-default-style").removeClass("water-temp-hover-map-view-style"),$waveSizeInfo.addClass("wave-size-hover-default-style").removeClass("wave-size-hover-map-view-style"),$costInfo.addClass("cost-hover-default-style").removeClass("cost-hover-map-view-style"))};var t;self.addRolloverEffect=function(){console.log("enable hover effect"),$(".location-frame").each(function(){var a=$(this),b=$(this).find(".break-name"),c=$(this).find(".location-name"),d=$(this).find("img.location-image"),e=$(this).find(".favorite-wrapper");$(".map-container");a.on("mouseenter",function(f){function g(f){d.css({"-webkit-filter":"blur(4px) brightness(80%)",filter:"blur(4px) brightness(80%)"}),c.hide(),b.hide(),e.hide();var g=displaySkillIcon(f.skillLevel);a.append(g);var h=displayBreakIcon(f.breakDetails);a.append(h);var i=displayDirectionIcon(f.waveDirection);a.append(i);var j=displayBestSeasonIcon(f.optimalTime);a.append(j);var k=displayBigWaveIcon(f);a.append(k);var l=displayWellKnownIcon(f);a.append(l);var m=displayCost(f.cost);if(a.append(m),"undefined"!=typeof currentLat){var n=displayDistance(f.lat,f.lng);a.append(n)}var o=displayCurrentWaterTemp(f.avgWaterTemp);a.append(o);var p=displayWaveSize(f.avgSize);a.append(p)}t=!0;var h=f.currentTarget.children[1].textContent;console.log("hover over "+h),F&&activateMarker(h),self.locationArray.forEach(function(a){h===a.breakName&&g(a)}),E||G||self.toggleRolloverClasses(),console.log("add hover tooltips"),self.addToolTips()}),a.on("mouseleave",function(){t=!1;var a=$(".rollover-info");a.removeClass("tooltip-loaded"),E||G||self.toggleRolloverClasses(),d.css({"-webkit-filter":"blur(0px) brightness(100%)",filter:"blur(0px) brightness(100%)"}),c.show(),b.show(),e.show(),$(".surf-guide-container").length||self.isInfoWindowOpen(infoWindow)||G||self.makeMarkerSmall(),a.remove()})})},self.addToolTips=function(){function a(a,c,d){var e='<p class="tooltip-info">'+a+"</p>",f=20,g=c.pageX,h=c.pageY+f;$("body").append(e);var i=$(".tooltip-info");i.offset({top:h,left:g});var j=window.innerWidth,k=j-20,l=i.offset().left,m=i.outerWidth(),n=l+m;if(n>=k){i.outerWidth(220);var l=i.offset().left,m=i.outerWidth(),n=l+m}if(n>=j){var o=-20,p=n-j,q=g-p+o;i.offset({top:h,left:q})}b=setTimeout(function(){i.fadeOut(500,function(){console.log("hide tooltip"),i.remove()})},2e3),d.on("mousemove",function(){if(d.off("mousemove"),clearTimeout(b),d.hasClass("hover-tooltip-only"))var a=0;else var a=500;i.fadeOut(a,function(){console.log("hide tooltip"),i.remove()})})}var b,c,d,e=$("[title]");e.each(function(){var e=$(this);if(!e.hasClass("tooltip-loaded")){var f=e.attr("title");e.addClass("tooltip-loaded"),e.on("click mouseover mouseleave",function(g){var h=g;switch($(".tooltip-info").length&&(console.log("hide tooltip"),clearInterval(b),$(".tooltip-info").remove()),clearTimeout(c),e.off("mousemove"),h.type){case"mouseover":if(e.removeAttr("title"),e.on("mousemove",function(a){d=a}),e.hasClass("hover-tooltip-only"))var i=3e3;else var i=2e3;c=setTimeout(function(){console.log("show tooltip"),e.off("mousemove"),a(f,d,e)},i);break;case"mouseleave":e.attr("title",f);break;case"click":e.hasClass("hover-tooltip-only")||(console.log("show tooltip"),e.removeAttr("title"),a(f,h,e))}})}})},self.removeTitle=function(){$("[title]").each(function(){var a=$(this);u.indexOf(a.attr("title"))>-1?a.removeAttr("title"):v.indexOf(a.attr("title"))>-1&&(console.log("disable marker tooltip"),a.removeAttr("title"))})};var u=["Report errors in the road map or imagery to Google","Zoom in","Zoom out","Rotate map 90 degrees","Show satellite imagery","Change map style"],v=[];self.removeGoogleElemTitles=function(){var a=u.length,b=0,c=setInterval(function(){$("[title]").each(function(){var d=$(this);u.indexOf(d.attr("title"))>-1&&(b++,b===a&&(clearInterval(c),console.log("disable Google tooltips"),self.removeTitle()))})},500)};var w=$("#navbar-main"),x=w.offset().top,y=$(window),z=$("body");if(y.scroll(function(){y.scrollTop()>x?(w.addClass("navbar-fixed-top"),z.css("padding-top","50px")):(w.removeClass("navbar-fixed-top"),z.css("padding-top","0px"))}),self.loadProgressIndicator=function(){var a=new CanvasLoader("progressBarContainer");return a.setColor("#35ABBB"),a.setShape("spiral"),a.setDiameter(72),a.setDensity(33),a.setRange(1),a.setFPS(23),a.show(),a},"ontouchstart"in document.documentElement){console.log("device supports touch events");for(var A=document.styleSheets.length-1;A>=0;A--){var B=document.styleSheets[A];if(B.cssRules)for(var C=B.cssRules.length-1;C>=0;C--){var D=B.cssRules[C];D.selectorText&&(D.selectorText=D.selectorText.replace(":hover",":active"))}}}self.enableHorizontalScrolling=function(){var a=$(".location-grid");a.off(),a.mousewheel(function(a,b){this.scrollLeft-=1*b,a.preventDefault()})},self.manageLayout=function(){console.log("manage layout");var a=$(".location-grid"),b=$(".location-frame"),c=$("#container"),d=$(".map-container"),e=$("#map"),f=$(".favorite"),g=$(".break-name"),h=$(".location-name"),i=$(".search-form"),j=$(".clear"),k=$(".clear-favorites-button");E||G||H?(d.removeClass("map-container-map-view-style").addClass("map-container-default-style"),d.css("height","245px"),$(".map-selected").length&&d.show(),i.removeClass("search-form-map-view-style").addClass("search-form-default-style"),j.removeClass("clear-map-view-style").addClass("clear-default-style"),k.removeClass("clear-favorites-button-map-view-style").addClass("clear-favorites-button-default-style"),a.removeClass("location-grid-map-view-style"),b.removeClass("location-frame-map-view-style").addClass("location-frame-default-style"),c.removeClass("container-fluid").addClass("container"),a.removeClass("row-fluid").addClass("row"),b.addClass("col-xs-12 col-sm-6 col-md-4"),g.removeClass("break-name-map-view-style").addClass("break-name-default-style"),h.removeClass("location-name-map-view-style").addClass("location-name-default-style"),f.attr("class","favorite favorite-default-style"),a.off(),0===s.length||!e.is(":visible")||H||J?H&&e.is(":visible")&&self.setMarkerForGuide():(console.log("map is visible"),google.maps.event.trigger(map,"resize"),self.setMapBounds())):(console.log("update map view layout"),d.removeClass("map-container-default-style").addClass("map-container-map-view-style"),i.addClass("search-form-map-view-style").removeClass("search-form-default-style"),j.addClass("clear-map-view-style").removeClass("clear-default-style"),k.removeClass("clear-favorites-button-default-style").addClass("clear-favorites-button-map-view-style"),a.addClass("location-grid-map-view-style"),c.removeClass("container").addClass("container-fluid"),a.removeClass("row").addClass("row-fluid"),self.adjustFrameStyle(),self.adjustMapSize(),self.enableHorizontalScrolling())};var E,F,G,H;self.manageView=function(){var a=window.innerWidth;$(".surf-guide-container").is(":visible")&&768>a?(F=!1,G=!1,E=!0,H=!0,console.log("view is surf guide/mobile")):$(".surf-guide-container").is(":visible")&&a>=768?(F=!1,G=!1,E=!1,H=!0,console.log("view is surf guide")):768>a?(F=!1,G=!1,H=!1,E=!0,console.log("view is mobile")):(E=!1,H=!1,$(".map-selected").length?(G=!1,F=!0,console.log("view is map")):(F=!1,G=!0,console.log("view is grid"))),self.manageLayout()},self.manageView();var I,J;$(window).resize(function(){self.manageView(),console.log("resize window"),$("#map").is(":visible")&&!H&&(J=!0,console.log("disable frame and marker managers"),clearTimeout(I),I=setTimeout(function(){$("#map").is(":visible")&&!H&&(google.maps.event.trigger(map,"resize"),self.setMapBounds()),J=!1,console.log("enable frame and marker managers");
},100))}),self.formatText=function(a){var b=a.toLowerCase().replace(/ /g,"").replace(/'/g,"").replace(/,/g,"");return b},self.Query=ko.observable(""),self.searchLocations=function(){var a=self.formatText(self.Query()),b=$(".location-frame");b.hide(),b.each(function(){var b=$(this),c=self.formatText(b.text());c.indexOf(a)>-1&&b.show()}),s.forEach(function(b){self.formatText(b.title).indexOf(a)>-1?b.setVisible(!0):b.setVisible(!1)}),$("#map").is(":visible")&&self.setMapBounds(),$(".map-container").is(":visible")&&self.manageLayout()};var K=$(".clear"),L=$(".search-form"),M=$(".search-symbol"),N=$(".search-container");L.autocomplete({source:searchKeywords,autoFocus:!0,minLength:2,delay:250,select:function(a,b){self.Query(b.item.value),self.searchLocations()},close:function(){$(this).blur()}}),self.toggleSearch=function(){N.slideToggle(500),setTimeout(function(){console.log("toggle search"),$(".favorite-filter-selected").length||self.resetPage(),K.is(":visible")&&K.toggle(),N.is(":visible")&&!$(".search-selected").length?(L.focus(),M.removeClass("search-default"),M.addClass("search-selected")):(M.removeClass("search-selected"),M.addClass("search-default"))},600)},M.on("click",function(){if($(".favorite-filter-selected").length){var a=$(".favorite-filter-symbol"),b=$(".filters-container");b.slideUp(500),console.log("hide filters container and favorites"),a.removeClass("favorite-filter-selected"),a.addClass("favorite-filter-default")}var c=$(window);c.scrollTop()<56||c.scrollTop()>=56&&N.is(":hidden")?(document.body.scrollTop=document.documentElement.scrollTop=0,self.toggleSearch()):L.focus()}),L.on("click",function(){self.resetPage()}).on("focus",function(){$(L).val()||K.toggle()}).on("blur",function(){$(L).val()||K.toggle()}),K.on("click",function(){K.toggle(),self.resetPage(),L.focus()}),self.filterFavorites=function(){$(".favorite-filter-symbol");if($("#map").is(":hidden")){var a=$(".location-frame");a.hide(),a.each(function(){var a=$(this),b=a.children(":nth-child(2)").text();userFavorites.indexOf(b)>-1&&a.show()})}infoWindow.close(),self.makeMarkerSmall(),s.forEach(function(a){var b=getMarkerName(a);userFavorites.indexOf(b)>-1?a.setVisible(!0):a.setVisible(!1)}),console.log("update map with favorites"),$("#map").is(":visible")&&self.setMapBounds()},$(".favorite-filter-symbol").on("click",function(){var a=$(".favorite-filter-symbol"),b=$(".filters-container");if($(".favorite-filter-selected").length)console.log("show all locations"),$(".map-container-map-view-style").length?b.fadeOut(500):b.slideUp(500),a.removeClass("favorite-filter-selected").addClass("favorite-filter-default"),self.resetPage();else{if($(".favorite-filter-selected").length||!(userFavorites.length>0))return void console.log("user has no favorites");if(console.log("show favorites only"),$(".search-container").is(":visible")&&self.toggleSearch(),$(".surf-guide-container").length&&self.closeSurfGuide(),a.removeClass("favorite-filter-default").addClass("favorite-filter-selected"),$("#map").is(":visible")&&$(".search-container").is(":visible")){setTimeout(function(){self.filterFavorites(),self.manageLayout()},600)}else self.filterFavorites(),self.manageLayout();$("#map").is(":visible")?b.fadeIn(500):b.slideDown(500)}$(".map-container-map-view-style").length||(document.body.scrollTop=document.documentElement.scrollTop=0)}),$(".clear-favorites-button").on("click",function(){var a=$(".filters-container"),b=$(".favorite-filter-symbol");$(".map-container-map-view-style").length?a.fadeOut(500):a.slideUp(500),b.removeClass("favorite-filter-selected"),b.addClass("favorite-filter-default"),self.removeAllFavorites(),self.resetPage()}),$(".map-symbol").on("click",function(a){var b=$(".map-symbol"),c=$(".map-container"),d=$("#map"),e=$(".surf-guide-container"),f=($(".search-container"),$(window).scrollTop()),g=$(".map-section").height(),h=$(".location-frame"),i=$(".location-frame:visible").length;F?(b.toggleClass("map-default map-selected"),d.hide(),self.manageView(),c.show(),self.resetFrames(),self.resetMarkers(),c.slideToggle(200,function(){console.log("close map"),console.log("close any open info windows"),infoWindow.close(),self.makeMarkerSmall()})):G?(document.body.scrollTop=document.documentElement.scrollTop=0,b.toggleClass("map-default map-selected"),d.is(":hidden")&&d.show(),self.manageView(),console.log("open map"),self.removeGoogleElemTitles(),self.addMapZoomListener(),c.fadeIn(1e3),console.log("resize map"),google.maps.event.trigger(map,"resize"),self.setMapBounds()):H&&!E?(document.body.scrollTop=document.documentElement.scrollTop=0,b.toggleClass("map-default map-selected"),d.is(":hidden")&&d.show(),c.slideToggle(200,function(){d.is(":visible")?(console.log("open map"),self.removeGoogleElemTitles(),self.addMapZoomListener(),self.setMarkerForGuide()):console.log("close map")})):E&&g>f||f>=g&&c.is(":hidden")?(document.body.scrollTop=document.documentElement.scrollTop=0,b.toggleClass("map-default map-selected"),d.is(":hidden")&&d.show(),1==i&&h.length>1&&h.show(),c.slideToggle(200,function(){d.is(":visible")?(console.log("open map"),self.removeGoogleElemTitles(),self.addMapZoomListener(),e.is(":visible")?self.setMarkerForGuide():(console.log("resize map"),google.maps.event.trigger(map,"resize"),self.setMapBounds())):(self.resetFrames(),self.resetMarkers(),console.log("close map"),H||(console.log("close any open info windows"),infoWindow.close(),self.makeMarkerSmall()))})):(console.log("scroll to map"),document.body.scrollTop=document.documentElement.scrollTop=0)}),self.resetPage=function(){console.log("reset locations & map, clear search, and close surf guide"),$(".surf-guide-container").length&&self.closeSurfGuide(),L.val(""),self.Query(""),infoWindow.close(),self.makeMarkerSmall();var a=$(".location-frame");a.show(),$(".location-grid").is(":hidden")&&$(".location-grid").show(),self.manageView(),s.forEach(function(a){a.setVisible(!0)}),$("#map").is(":hidden")||self.setMapBounds()};self.renderSurfGuide=function(a){$(".favorite-filter-selected").length&&$(".filters-container").toggle(),document.body.scrollTop=document.documentElement.scrollTop=0,$(".surf-guide-container").is(":visible")||$(".location-grid").hide(),$(".surf-guide-container").remove(),$(".surf-info-container").append('<div class="row surf-guide-container"></div>'),$surfGuideContainer=$(".surf-guide-container");var b=displayTitle(a.breakName,a.location);$surfGuideContainer.append(b);var c=displayFavoriteIcon(a.breakName);$(".title").prepend(c),self.makeSVGInline($(".favorite-guide")),addFavoriteListener(a.breakName),$surfGuideContainer.append('<div class="col-xs-12 icon-frame"></div>');var d=$(".icon-frame");d.append('<div class="xs-icon-container sm-icon-container icon-container"></div>');var e=$(".icon-container");displayBigWaveIcon(a,e),displayWellKnownIcon(a,e);var f=displaySkillIcon(a.skillLevel);e.append(f);var g=displayDirectionIcon(a.waveDirection);e.append(g);var h=displayBreakIcon(a.breakDetails);e.append(h);var i=displayWaveSize(a.avgSize);e.append(i);var j=100,k=100;displayCompassIcon(a.optimalSwell,a.optimalWind,e,j,k);var l=displayTideIcon(a.optimalTide);e.append(l);var m=displayBestSeasonIcon(a.optimalTime);e.append(m),displaySuggestedAttireIcons(a.avgWaterTemp,j,k,e);var n=displayClimateIcon(a.climate);e.append(n);var o=displayCost(a.cost,e);if(e.append(o),"undefined"!=typeof currentLat){var p=displayDistance(a.lat,a.lng);e.append('<div class="distance card">'+p+"</div>")}displayHazardIcons(a.hazards,e),$(".card").addClass("col-xs-4 col-sm-3"),self.addGuideButtons(a),console.log("add surf guide tooltips"),self.addToolTips()},self.addGuideButtons=function(a){$surfGuideContainer.prepend('<button type="button" class="btn guide-close-button">âœ–</button>'),$(".guide-header").append('<button type="button" class="btn conditions-button">Current Conditions</button>'),$(".conditions-button").on("click",function(b){if($(".live-surf-conditions").is(":hidden"))$(".icon-frame").addClass("col-sm-6 sm-icon-frame"),$(".icon-container").addClass("md-icon-container"),$(".live-surf-conditions").toggle(),$(".conditions-button").toggle(),$(".conditions-close-button").toggle();else{$(".conditions-button").toggle(),$("#progressBarContainer").length||$(".guide-header").append('<div id="progressBarContainer"></div>');var c=loadProgressIndicator();getMagicSeaweed(a.spotID,a.breakName,c)}}),$(".guide-close-button").on("click",function(a){$(".favorite-filter-selected").length&&($(".filters-container").toggle(),self.filterFavorites()),self.closeSurfGuide()})},self.addFavoriteListener=function(a){$(".favorite-wrapper-guide").on("click",function(){var b=$(this);$(".is-a-favorite-guide").length?(b.removeClass("is-a-favorite-guide").addClass("not-a-favorite-guide"),console.log("unfavorite "+a),removeFavorite(a)):(b.removeClass("not-a-favorite-guide").addClass("is-a-favorite-guide"),console.log("favorite "+a),addFavorite(a))})},self.displayTitle=function(a,b){var c='<div class="col-xs-12 guide-header"><p class="title"><span id="guide-break-name">'+a+"</span>, "+b+"</p></div>";return c},self.displayFavoriteIcon=function(a){if(userFavorites.indexOf(a)>-1)var b=!0;if(b)var c='<span class="favorite-wrapper-guide is-a-favorite-guide"><img class="favorite-guide"  src="img/star.svg"></span>';else var c='<span class="favorite-wrapper-guide not-a-favorite-guide"><img class="favorite-guide" src="img/star.svg"></span>';return c},self.displayBigWaveIcon=function(b,c){if(t)if(b.bigWave){var d=a.roIconMiscOneBigWave;d.title="Known for big wave surfing"}else var d=displaySuggestedAttireIcons(b.avgWaterTemp);else{if(!b.bigWave)return;var d='<div class=" big-wave card " title="Known for big wave surfing"><img src="img/big_wave.svg" class="big-wave-guide"></div>';c.append(d)}return d},self.displayWellKnownIcon=function(b,c){if(t)if(b.wellKnown){var d=a.roIconMiscTwoWellknown;d.title="Well known wave"}else var d=displayHazardIcons(b.hazards,c);else{if(!b.wellKnown)return;var d='<div class=" well-known card " title="Well known wave"><img src="img/well_known.svg" class="well-known-guide"></div>';c.append(d)}return d},self.displaySkillIcon=function(b){for(var c=0,d=0,e=0,f=b.length,g=f;g--;)switch(b[g]){case"beginner":c++;break;case"intermediate":d++;break;case"advanced":e++}if(c===d&&c===e)if(t){var h=a.roIconSkillAll;h.title="Difficulty: All levels"}else var h='<div class="skill-level card " title="Difficulty: All levels"><img src="img/skill_level_all.svg" class="skill-level-guide"></div>';else if(c>=d&&c>e)if(c===d)if(t){var h=a.roIconSkillBegInt;h.title="Difficulty: Beginner to Intermediate"}else var h='<div class="skill-level card " title="Difficulty: Beginner to Intermediate"><img src="img/skill_level_beginner_intermediate.svg" class=" skill-level-guide"></div>';else if(t){var h=a.roIconSkillBeg;h.title="Difficulty: Beginner"}else var h='<div class="skill-level card " title="Difficulty: Beginner"><img src="img/skill_level_beginner.svg" class=" skill-level-guide"></div>';else if(d>c&&d>=e)if(d===e)if(t){var h=a.roIconSkillIntAdv;h.title="Difficulty: Intermediate to Advanced"}else var h='<div class="skill-level card " title="Difficulty: Intermediate to Advanced"><img src="img/skill_level_intermediate_advanced.svg" class=" skill-level-guide"></div>';else if(t){var h=a.roIconSkillInt;h.title="Difficulty: Intermediate"}else var h='<div class="skill-level card " title="Difficulty: Intermediate"><img src="img/skill_level_intermediate.svg" class=" skill-level-guide"></div>';else if(t){var h=a.roIconSkillAdv;h.title="Difficulty: Advanced"}else var h='<div class="skill-level card " title="Difficulty: Advanced"><img src="img/skill_level_advanced.svg" class=" skill-level-guide"></div>';return h},self.displayDirectionIcon=function(b){switch(b){case"left":if(t){var c=a.roIconDirectionLeft;c.title="Wave Direction: Left"}else var c='<div class="direction card " title="Wave Direction: Left"><img src="img/direction_left.svg" class="wave-direction-guide"></div>';break;case"right":if(t){var c=a.roIconDirectionRight;c.title="Wave Direction: Right"}else var c='<div class="direction card " title="Wave Direction: Right"><img src="img/direction_right.svg" class="wave-direction-guide"></div>';break;case"left & right":if(t){var c=a.roIconDirectionBoth;c.title="Wave Direction: Left & Right"}else var c='<div class="direction card " title="Wave Direction: Left & Right"><img src="img/direction_both.svg" class="wave-direction-guide"></div>'}return c},self.displayBreakIcon=function(b){switch(b){case"reef":if(t){var c=a.roIconBreakReef;c.title="Break Type: Reef"}else var c='<div class="break card " title="Break Type: Reef"><img src="img/break_reef.svg" class="break-type-guide"></div>';break;case"beach":if(t){var c=a.roIconBreakBeach;c.title="Break Type: Beach"}else var c='<div class="break card " title="Break Type: Beach"><img src="img/break_beach.svg" class="break-type-guide"></div>';break;case"point":if(t){var c=a.roIconBreakPoint;c.title="Break Type: Point"}else var c='<div class="break card " title="Break Type: Point"><img src="img/break_point.svg" class="break-type-guide"></div>';break;case"river mouth":if(t){var c=a.roIconBreakRiver;c.title="Break Type: River Mouth"}else var c='<div class="break card " title="Break Type: River Mouth"><img src="img/break_river_mouth.svg" class="break-type-guide"></div>'}return c},self.displayCompassIcon=function(b,c,d,e,f){function g(b){if(h){h=!1,drawBackground=!0,d.append('<div class="small-compass-guide card " title="Best Swell & Best Wind"><canvas id="compass-small" width="'+e+'" height="'+f+'"></canvas></div>');var c=a.smallSwellPointer,g=a.smallCompass}else if(i){i=!1;var c=a.smallWindPointer}var j=document.getElementById("compass-small"),k=j.getContext("2d"),l=c;drawBackground&&(k.drawImage(g,0,0),k.save());var m=e/2,n=f/2;k.translate(m,n);for(var o=b.length,p=o;p--;){switch(b[p]){case"N":var q=0;break;case"NNE":var q=22.5;break;case"NE":var q=45;break;case"ENE":var q=67.5;break;case"E":var q=90;break;case"ESE":var q=112.5;break;case"SE":var q=135;break;case"SSE":var q=157.5;break;case"S":var q=180;break;case"SSW":var q=202.5;break;case"SW":var q=225;break;case"WSW":var q=247.5;break;case"W":var q=270;break;case"WNW":var q=292.5;break;case"NW":var q=315;break;case"NNW":var q=337.5}var r=q*(Math.PI/180);k.rotate(r),k.drawImage(l,-m,-n),k.rotate(-r)}drawBackground&&(drawBackground=!1,k.restore())}if(b){var h=!0;g(b)}var i=!0;g(c)},self.displayTideIcon=function(a){for(var b=0,c=0,d=0,e=a.length,f=e;f--;)switch(a[f]){case"low":b++;break;case"mid":c++;break;case"high":d++}if(b===c&&b===d)var g='<div class="tide card " title="Best Tide: All"><img src="img/tide_all.svg" class="tide-guide"></div>';else if(b>=c&&b>=d)if(b===c)var g='<div class="tide card " title="Best Tide: Low & Mid"><img src="img/tide_low_mid.svg" class="tide-guide"></div>';else if(b===d)var g='<div class="tide card " title="Best Tide: Low & High"><img src="img/tide_low_high.svg" class="tide-guide"></div>';else var g='<div class="tide card " title="Best Tide: Low"><img src="img/tide_low.svg" class="tide-guide"></div>';else if(c>b&&c>=d)if(c===d)var g='<div class="tide card " title="Best Tide: Mid & High"><img src="img/tide_high_mid.svg" class="tide-guide"></div>';else var g='<div class="tide card " title="Best Tide: Mid"><img src="img/tide_mid.svg" class="tide-guide"></div>';else var g='<div class="tide card " title="Best Tide: High"><img src="img/tide_high.svg" class="tide-guide"></div>';return g},self.displayBestSeasonIcon=function(b){for(var c=0,d=0,e=0,f=0,g=b.length,h=g;h--;)switch(b[h]){case" Dec":case" Jan":case" Feb":f++;break;case" Mar":case" Apr":case" May":c++;break;case" Jun":case" Jul":case" Aug":d++;break;case" Sep":case" Oct":case" Nov":e++}if(f===c&&f===d&&f===e)if(t){var i=a.roIconBestSeasonAll;i.title="Best Season: All"}else var i='<div class="time card " title="Best Season: All"><img src="img/season_all.svg" class="best-season-guide"></div>';else if(f>=c&&f>=d&&f>=e)if(f===c)if(t){var i=a.roIconBestSeasonWinSpr;i.title="Best Season: Winter & Spring"}else var i='<div class="time card " title="Best Season: Winter & Spring"><img src="img/season_winter_spring.svg" class="best-season-guide"></div>';else if(f===d)if(t){var i=a.roIconBestSeasonWinSum;i.title="Best Season: Winter & Summer"}else var i='<div class="time card " title="Best Season: Winter & Summer"><img src="img/season_winter_summer.svg" class="best-season-guide"></div>';else if(f===e)if(t){var i=a.roIconBestSeasonWinAut;i.title="Best Season: Winter & Autumn"}else var i='<div class="time card " title="Best Season: Winter & Autumn"><img src="img/season_winter_autumn.svg" class="best-season-guide"></div>';else if(t){var i=a.roIconBestSeasonWin;i.title="Best Season: Winter"}else var i='<div class="time card " title="Best Season: Winter"><img src="img/season_winter.svg" class="best-season-guide"></div>';else if(c>=d&&c>=e&&c>f)if(c===d)if(t){var i=a.roIconBestSeasonSpgSum;i.title="Best Season: Spring & Summer"}else var i='<div class="time card " title="Best Season: Spring & Summer"><img src="img/season_spring_summer.svg" class="best-season-guide"></div>';else if(c===e)if(t){var i=a.roIconBestSeasonSpgAut;i.title="Best Season: Spring & Autumn"}else var i='<div class="time card " title="Best Season: Spring & Autumn"><img src="img/season_spring_autumn.svg" class="best-season-guide"></div>';else if(t){var i=a.roIconBestSeasonSpg;i.title="Best Season: Spring"}else var i='<div class="time card " title="Best Season: Spring"><img src="img/season_spring.svg" class="best-season-guide"></div>';else if(d>=e&&d>f&&d>c)if(d===e)if(t){var i=a.roIconBestSeasonSumAut;i.title="Best Season: Summer & Autumn"}else var i='<div class="time card " title="Best Season: Summer & Autumn"><img src="img/season_summer_autumn.svg" class="best-season-guide"></div>';else if(t){var i=a.roIconBestSeasonSum;i.title="Best Season: Summer"}else var i='<div class="time card " title="Best Season: Summer"><img src="img/season_summer.svg" class="best-season-guide"></div>';else if(t){var i=a.roIconBestSeasonAut;i.title="Best Season: Autumn"}else var i='<div class="time card " title="Best Season: Autumn"><img src="img/season_autumn.svg" class="best-season-guide"></div>';return i},self.displaySuggestedAttireIcons=function(b,c,d,e){function f(b,c){if(1===c)var d=document.getElementById("spring"),e=a.attireSpring;else if(2===c)var d=document.getElementById("summer"),e=a.attireSummer;else if(3===c)var d=document.getElementById("autumn"),e=a.attireAutumn;else var d=document.getElementById("winter"),e=a.attireWinter;var f=d.getContext("2d"),g=b,h=e;f.drawImage(h,0,0),f.drawImage(g,0,0)}function g(b){if(b>59)if(b>72)if(t)var c=a.roIconMiscOneBoardies;else var c=a.attireBoardies;else if(b>66)if(t)var c=a.roIconMiscOneWetSuitTwo;else var c=a.attireWetsuitTwo;else if(t)var c=a.roIconMiscOneWetSuitThree;else var c=a.attireWetsuitThree;else if(b>54)if(t)var c=a.roIconMiscOneWetSuitFour;else var c=a.attireWetsuitFour;else if(b>48)if(t)var c=a.roIconMiscOneWetSuitFive;else var c=a.attireWetsuitFive;else if(t)var c=a.roIconMiscOneWetSuitSix;else var c=a.attireWetsuitSix;return c}if(t){var h=getCurrentSeason();if("winter"===h)var i=g(b.winter);else if("spring"===h)var i=g(b.spring);else if("winter"===h)var i=g(b.summer);else if("autumn"===h)var i=g(b.autumn);return i.title="Suggested "+h+" attire",i}e.append('<div class="water-temp spring card " title="Suggested Spring Attire"><canvas id="spring" width="'+c+'" height="'+d+'"></canvas>'),e.append('<div class="water-temp summer card " title="Suggested Summer Attire"><canvas id="summer" width="'+c+'" height="'+d+'"></canvas>'),e.append('<div class="water-temp autumn card " title="Suggested Autumn Attire"><canvas id="autumn" width="'+c+'" height="'+d+'"></canvas>'),e.append('<div class="water-temp winter card " title="Suggested Winter Attire"><canvas id="winter" width="'+c+'" height="'+d+'"></canvas>');var j=0;for(var k in b){j++;var l=g(b[k]);f(l,j)}var h=getCurrentSeason();"winter"===h?$(".winter").addClass("highlight-attire"):"spring"===h?$(".spring").addClass("highlight-attire"):"winter"===h?$(".summer").addClass("highlight-attire"):"autumn"===h&&$(".autumn").addClass("highlight-attire")},self.displayClimateIcon=function(a){var b='<div class="climate card " title="KÃ¶ppen Climate Classification"><p>'+a+"</p></div>";return b},self.displayCost=function(a,b){if(t)var c='<p class="rollover-info cost-rollover cost-hover-default-style " title="Estimated minimum daily budget allowance">$'+a.budget+"</p>";else var d=Math.floor((a.highEnd-a.budget)/2+a.budget),c=b.append('<div class="cost card"><img src="img/cost.svg" class="cost-guide " title="Estimated daily budget allowance: Low, Mid, High"><p>'+a.budget+"</p><p>"+d+"</p><p>"+a.highEnd+"</p></div>");return c},self.displayDistance=function(a,b){function c(a){return a*(Math.PI/180)}var d=currentLat,e=currentLng,f=3959,g=c(a-d),h=c(b-e),i=Math.sin(g/2)*Math.sin(g/2)+Math.cos(c(d))*Math.cos(c(a))*Math.sin(h/2)*Math.sin(h/2),j=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),k=f*j,l=Math.round(k);if(l>200){var m=l/450;if(1>m)var n=1;else var n=Math.round(m);if(n>8&&12>=n)var o=n+2,p=o;else if(n>12)var o=n+4,p=o;else var p=n;var q=p;if(t){var r='<p class="rollover-info distance-rollover distance-hover-default-style " title="Estimated flight duration from your location">'+q+"h</p>";return r}var s='<img src="img/distance_plane.svg" class="icon distance-guide " title="Estimated flight duration from your location"><p class="distance-guide-hours">'+q+"h</p>";return s}var u=l;if(t){var r='<p class="rollover-info distance-rollover distance-hover-default-style " title="Estimated distance in miles from your location">'+u+"mi</p>";return r}var s='<img src="img/distance.svg" class="icon distance-guide " title="Estimated (straight line) distance in miles from your location (actual distance via roads will be greater) "><p class="distance-guide-miles">'+u+"mi</p>";return s},self.displayCurrentWaterTemp=function(a){var b=getCurrentSeason();switch(b){case"winter":var c=a.winter;break;case"spring":var c=a.spring;break;case"summer":var c=a.summer;break;case"autumn":var c=a.autumn}var d='<p class="rollover-info water-temp-rollover water-temp-hover-default-style " title="Average '+b+' water temperature">'+c+"â„‰</p>";return d},self.displayWaveSize=function(a){if(a.aboveMax)var b="+";else var b="";if(t)var c='<p class="rollover-info wave-size-rollover wave-size-hover-default-style " title="Average wave size">'+a.min+"-"+a.max+"'</p>";else var c='<div class=" wave-size card " title="Average wave size"><img src="img/wave_range.svg" class"wave-size-guide"><p>'+a.min+"-"+a.max+b+"ft</p></div>";return c},self.getCurrentSeason=function(){var a=new Date,b=a.getMonth();switch(b){case 11:case 0:case 1:var c="winter";break;case 2:case 3:case 4:var c="spring";break;case 5:case 6:case 7:var c="summer";break;case 8:case 9:case 10:var c="autumn"}return c},self.displayHazardIcons=function(b,c){function d(b,c){switch(b){case"beginners":if(t){var d=a.roIconMiscTwoBeginners;d.title="Hazard: Beginners"}else c.append('<div class="hazard card " title="Hazard: Beginners"><img src="img/hazards_beginners.svg" class="hazard-guide"></div>');break;case"boats":if(t){var d=a.roIconMiscTwoBoats;d.title="Hazard: Boats"}else c.append('<div class="hazard card " title="Hazard: Boats"><img src="img/hazards_boats.svg" class="hazard-guide"></div>');break;case"crocs":if(t){var d=a.roIconMiscTwoCrocs;d.title="Hazard: Crocodiles"}else c.append('<div class="hazard card " title="Hazard: Crocodiles"><img src="img/hazards_crocs.svg" class="hazard-guide"></div>');break;case"crowded":if(t){var d=a.roIconMiscTwoCrowded;d.title="Hazard: Crowded"}else c.append('<div class="hazard card " title="Hazard: Crowded"><img src="img/hazards_crowded.svg" class="hazard-guide"></div>');break;case"dangerous break":if(t){var d=a.roIconMiscTwoDgrBreak;d.title="Hazard: Dangerous Break"}else c.append('<div class="hazard card " title="Hazard: Dangerous Break"><img src="img/hazards_dangerous_break.svg" class="hazard-guide"></div>');break;case"far from shore":if(t){var d=a.roIconMiscTwoFar;d.title="Hazard: Far From Shore"}else c.append('<div class="hazard card " title="Hazard: Far From Shore"><img src="img/hazards_far_from_shore.svg" class="hazard-guide"></div>');break;case"pollution":if(t){var d=a.roIconMiscTwoPollution;d.title="Hazard: Pollution"}else c.append('<div class="hazard card " title="Hazard: Pollution"><img src="img/hazards_pollution.svg" class="hazard-guide"></div>');break;case"rocky bottom":if(t){var d=a.roIconMiscTwoRocky;d.title="Hazard: Rocky Bottom"}else c.append('<div class="hazard card " title="Hazard: Rocky Bottom"><img src="img/hazards_rocky_bottom.svg" class="hazard-guide"></div>');break;case"sea snakes":if(t){var d=a.roIconMiscTwoSnakes;d.title="Hazard: Sea Snakes"}else c.append('<div class="hazard card " title="Hazard: Sea Snakes"><img src="img/hazards_sea_snakes.svg" class="hazard-guide"></div>');break;case"seals":if(t){var d=a.roIconMiscTwoSeals;d.title="Hazard: Seals"}else c.append('<div class="hazard card " title="Hazard: Seals"><img src="img/hazards_seals.svg" class="hazard-guide"></div>');break;case"seaweed":if(t){var d=a.roIconMiscTwoSeaweed;d.title="Hazard: Seaweed"}else c.append('<div class="hazard card " title="Hazard: Seaweed"><img src="img/hazards_seaweed.svg" class="hazard-guide"></div>');break;case"sewage":if(t){var d=a.roIconMiscTwoSewage;d.title="Hazard: Sewage"}else c.append('<div class="hazard card " title="Hazard: Sewage"><img src="img/hazards_sewage.svg" class="hazard-guide"></div>');break;case"shallow":if(t){var d=a.roIconMiscTwoShallow;d.title="Hazard: Shallow Break"}else c.append('<div class="hazard card " title="Hazard: Shallow Break"><img src="img/hazards_shallow.svg" class="hazard-guide"></div>');break;case"sharks":if(t){var d=a.roIconMiscTwoSharks;d.title="Hazard: Sharks"}else c.append('<div class="hazard card " title="Hazard: Sharks"><img src="img/hazards_sharks.svg" class="hazard-guide"></div>');break;case"strong currents":if(t){var d=a.roIconMiscTwoStrCurrent;d.title="Hazard: Strong Currents"}else c.append('<div class="hazard card " title="Hazard: Strong Currents"><img src="img/hazards_strong_currents.svg" class="hazard-guide"></div>');break;case"strong rips":if(t){var d=a.roIconMiscTwoStrRips;d.title="Hazard: Strong Rips"}else c.append('<div class="hazard card " title="Hazard: Strong Rips"><img src="img/hazards_strong_rips.svg" class="hazard-guide"></div>');break;case"theft":if(t){var d=a.roIconMiscTwoTheft;d.title="Hazard: Theft"}else c.append('<div class="hazard card " title="Hazard: Theft"><img src="img/hazards_theft.svg" class="hazard-guide"></div>');break;case"undertow":if(t){var d=a.roIconMiscTwoUndertow;d.title="Hazard: Strong Undertow"}else c.append('<div class="hazard card " title="Hazard: Strong Undertow"><img src="img/hazards_undertow.svg" class="hazard-guide"></div>');break;case"unfriendly":if(t){var d=a.roIconMiscTwoUnfriendly;d.title="Hazard: Unfriendly Locals"}else c.append('<div class="hazard card " title="Hazard: Unfriendly Locals"><img src="img/hazards_unfriendly.svg" class="hazard-guide"></div>');break;case"urchins":if(t){var d=a.roIconMiscTwoUrchins;d.title="Hazard: Urchins"}else c.append('<div class="hazard card " title="Hazard: Urchins"><img src="img/hazards_urchins.svg" class="hazard-guide"></div>')}return d}if(t){var e=0,f=b.length,g=Math.floor(Math.random()*(f-e)+e),h=b[g],i=d(h);return i}for(var j=b.length,k=j;k--;)d(b[k],c)},self.closeSurfGuide=function(){console.log("close surf guide"),console.log("close any open info windows"),infoWindow.close(),self.makeMarkerSmall(),$(".surf-guide-container").remove(),self.manageView(),$("#map").is(":hidden")&&self.resetFrames(),$(".location-grid").show(),$(".location-frame:visible").css("display","inline-block"),document.body.scrollTop=document.documentElement.scrollTop=0},self.getMagicSeaweed=function(b,c,d){function e(b){function d(){function b(){d.drawImage(g,0,0),d.save(),d.translate(150,150),d.rotate(h),d.drawImage(e,-150,-150),d.rotate(-h),d.rotate(i),d.drawImage(f,-150,-150),d.restore()}var c=document.getElementById("compass"),d=c.getContext("2d"),e=a.windPointer,f=a.swellPointer,g=new Image;g.src="img/compass.svg",g.onload=b;var h=o*(Math.PI/180),i=l*(Math.PI/180)}$(".surf-guide-container");if(g===c&&!$(".conditions-error").length){var e=b.swell.minBreakingHeight,f=b.swell.maxBreakingHeight;if(e===f)var i=e;else var i=e+" - "+f;for(var j=b.swell.components.primary.height,k=b.swell.components.primary.period,l=b.swell.components.primary.direction,m=b.swell.components.primary.compassDirection,n=b.wind.speed,o=b.wind.direction,p=b.wind.compassDirection,q=b.condition.temperature,r=b.condition.weather,s="http://cdnimages.magicseaweed.com/30x30/"+r+".png",t="img/wind.svg",u=[],v=b.solidRating,w='<img class="star" src="img/star_filled.svg"/>',x=v;x--;)u.push(w);for(var y=b.fadedRating,z='<img class="star" src="img/star_faded.svg"/>',x=y;x--;)u.push(z);for(var A=5-u.length,B='<img class="star" src="img/star_empty.svg"/>',x=A;x--;)u.push(B);var C=u.join(""),D='<div class="col-xs-12 surf-conditions-container live-surf-conditions"></div>',E='<div class="col-xs-12 col-sm-4 col-md-6 live-surf-conditions live-compass " title="Live wind & swell conditions (swell: blue | wind: white)"><canvas id="compass" width="300" height="300"></canvas></div>';h.after(E),$(".icon-frame").addClass("col-sm-6 sm-icon-frame"),$(".icon-container").addClass("md-icon-container"),h.after(D);var F=$(".surf-conditions-container"),G='<div class="col-xs-12 col-sm-6 surf-conditions-small surf-conditions-waves"></div>',H='<div class="col-xs-6 col-sm-3 surf-conditions-small surf-conditions-swell"></div>',I='<div class="col-xs-6 col-sm-3 surf-conditions-small surf-conditions-wind " title="Wind direction & speed"></div>';F.append(G),F.append(H),F.append(I);var J=$(".title"),K='<p class="live-temp live-surf-conditions " title="Live weather conditions">'+q+' â„‰<img class="live-weather" src="'+s+'" alt="Symbol for current weather"></p>',L='<a href="http://magicseaweed.com" target="_blank"><img src="img/msw_powered_by.png" class="live-surf-conditions msw-banner"></a>';J.after(L),J.after(K);var M=$(".surf-conditions-wind"),N=$(".surf-conditions-swell"),O=$(".surf-conditions-waves"),P="<p>"+n+"mph</p>",Q='<img class="img-responsive" src="'+t+'" alt="Symbol for wind">',R="<p>"+p+" wind</p>";M.append(P),M.append(Q),M.append(R);var S="<p>"+j+"ft</p>",T='<p class=" " title="The main swell generating waves">primary</p>',U='<p class=" " title="Live period between waves & current direction">@ '+k+"s "+m+"</p>";N.append(S),N.append(T),N.append(U);var V='<p class="live-wave-height " title="Live wave height">'+i+"ft</p>",W='<p class="star-rating " title="Magic Seaweed Rating: The more solid stars, the better. Unfavorable wind conditions change a solid star to a faded star">'+C+"</p>";O.append(V),O.append(W),d();var X='<button type="button" class="btn conditions-close-button">âœ–</button>';O.prepend(X);var Y=$(".conditions-close-button"),Z=$(".live-surf-conditions"),_=$(".conditions-button"),aa=$(".icon-frame"),ba=$(".icon-container");Y.on("click",function(a){aa.removeClass("col-sm-6 sm-icon-frame"),ba.removeClass("md-icon-container"),Z.toggle(),Y.toggle(),_.toggle()}),console.log("add live conditions tooltips"),self.addToolTips()}}function f(a){if(console.log("MSW api request unsuccessful"),g===c){var b='<div class="col-xs-12 error-frame"></div>',d='<div class="error-container"></div>',e='<p class="conditions-error">'+c+" conditions unavailable =(</p>",f='<button type="button" class="btn error-close-button">âœ–</button>';h.after(b);var i=$(".error-frame");i.append(d);var j=$(".error-container");j.append(e),j.prepend(f);var k=$(".error-close-button"),l=$(".conditions-close-button"),m=$(".conditions-button");k.on("click",function(a){i.remove(),l.remove(),m.toggle()})}}console.log("get current conditions");var g=$("#guide-break-name").text(),h=$(".guide-header");if("none"===b)$("#canvasLoader").remove(),
f();else{var i=setTimeout(function(){$("#canvasLoader").remove(),f()},8e3),j="http://magicseaweed.com/api/d2983e394d07724e96404fba11c10485/forecast/?spot_id="+b+"&units=us&fields=timestamp,fadedRating,solidRating,swell.minBreakingHeight,swell.maxBreakingHeight,swell.components.primary.*,wind.*,condition.*";$.ajax({url:j,dataType:"jsonp",success:function(a){console.log("MSW api request successful");for(var b=Date.now(),c=b/1e3,d=c-10800,f=c+10800,g=a.length,h=g;h--;){var j=a[h].timestamp;if(c>j&&j>d)var k=a[h];else if(j>c&&f>j)var k=a[h]}e(k),clearTimeout(i),$("#canvasLoader").remove()}})}}}var map,infoWindow;navigator.geolocation.getCurrentPosition(success),ko.applyBindings(new AppViewModel);