function initMap(){var a=[{featureType:"administrative",elementType:"all",stylers:[{color:"#525252"},{visibility:"off"}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"all",stylers:[{visibility:"simplified"},{color:"#525252"}]},{featureType:"landscape",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{visibility:"simplified"},{color:"#525252"}]},{featureType:"poi",elementType:"all",stylers:[{color:"#525252"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"road.local",elementType:"geometry",stylers:[{visibility:"simplified"}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:50},{color:"#e8e7e7"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.line",elementType:"all",stylers:[{visibility:"simplified"},{color:"#e8e7e7"}]},{featureType:"transit.station.airport",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#56c4d1"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]}],b=new google.maps.StyledMapType(a,{name:"Map"});map=new google.maps.Map(document.getElementById("map"),{mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,mapTypeIds:["custom_style",google.maps.MapTypeId.SATELLITE]},disableDefaultUI:!0,zoomControl:!0,rotateControl:!0,streetViewControl:!0,mapTypeControl:!0,scrollwheel:!1,scaleControl:!0}),map.setTilt(45),map.mapTypes.set("custom_style",b),map.setMapTypeId("custom_style");var c="/img/png/png_sprites.png";markerIcon={small:{url:c,size:new google.maps.Size(19,19),origin:new google.maps.Point(6,35),anchor:new google.maps.Point(9.5,9.5)},selected:{url:c,size:new google.maps.Size(41,52),origin:new google.maps.Point(4,120),anchor:new google.maps.Point(20.5,52)},smallFav:{url:c,size:new google.maps.Size(23,21),origin:new google.maps.Point(4,4),anchor:new google.maps.Point(11.5,10.5)},selectedFav:{url:c,size:new google.maps.Size(41,52),origin:new google.maps.Point(4,181),anchor:new google.maps.Point(20.5,52)}},infoWindow=new google.maps.InfoWindow}function success(a){console.log("get user's location"),currentLat=a.coords.latitude,currentLng=a.coords.longitude}function AppViewModel(){this.self=this;var a=$(document);$window=$(window),$body=$("body"),$mapSection=$(".map-section"),$mapContainer=$(".map-container"),$map=$("#map"),$mapSymbol=$(".map-symbol"),$locationGrid=$(".location-grid"),$searchContainer=$(".search-container"),$searchForm=$(".search-form"),$clearSymbol=$(".clear"),$filtersContainer=$(".filters-container"),$favFilterSym=$(".favorite-filter-symbol"),$clearFavsBtn=$(".clear-favorites-button"),$surfInfoContainer=$(".surf-info-container"),$window.load(function(){function a(a){$body.prepend(a).children(":nth-child(1)").hide()}try{var b=window.localStorage,c=b.getItem("svgVersion"),d=1;if(c==d){console.log("use saved inline svg sprites");var e=b.inlineSVGdata;a(e)}else{console.log("add/update inline svg sprites");var f=setTimeout(function(){console.log("inline svg sprites failed")},5e3);$.ajax({url:"img/svg/svg_sprites_v1.svg",dataType:"html",success:function(c){clearTimeout(f),a(c),b.inlineSVGdata=c,b.svgVersion=d}})}}catch(g){console.log("inline svg sprites disabled ("+g+")")}}),a.on("keydown",function(a){8!==a.which||$(a.target).is("input, textarea")||a.preventDefault()});var b=new Firebase("https://dazzling-torch-4012.firebaseio.com"),c=new Firebase("https://dazzling-torch-4012.firebaseio.com/locationData"),d=new Firebase("https://dazzling-torch-4012.firebaseio.com/users"),e=function(a){a?console.log("data could not be saved."+a):console.log("data saved successfully.")},f=function(a){console.log("the read failed: "+a.code)},g=function(a){console.log("get location data unsuccessful"),$searchContainer.hide(),$(".search-section").hide(),$mapSection.hide(),$(".surf-info-section").hide(),$(".list-section").hide();var b='<section class="error-section"><div class="row"><div class="col-xs-12 data-load-error-container"><svg class="no-connection"><use xlink:href="#no_connection"/></svg><p>Dude! Really?! =(</p></div></div></section>',c='<button type="button" class="btn reload-button">Reload</button>';$("header").after(b),$(".data-load-error-container").append(c),$(".reload-button").on("click",function(a){location=location}),f(a)};c.on("value",function(a){function b(){console.log("Google maps api loaded"),console.log("generate map markers"),self.generateMarkers(c),self.addMapListeners()}var c=a.val();if(console.log("get location data successful"),self.parseLocationData(c),"object"==typeof google&&"object"==typeof google.maps)b();else var d=setInterval(function(){console.log("error: Google maps api NOT loaded"),console.log("load Google maps api again"),"object"==typeof google&&"object"==typeof google.maps&&(b(),clearInterval(d))},500)},g),self.locationArray=[],self.locationGrid=ko.observableArray(""),self.searchKeywords=[],self.parseLocationData=function(a){console.log("parse location data"),self.locationArray=[],self.locationGrid.removeAll(),self.searchKeywords=[],a.forEach(function(a){self.locationArray.push(a),self.locationGrid.push(a),self.searchKeywords.push(a.breakName),searchKeywords.indexOf(a.location)<0&&self.searchKeywords.push(a.location)})};var h=[],i=!0;self.getFavorites=function(a){null===a?console.log("cannot find favorites because there are no logged in users"):d.child(a.uid).child("favorites").on("value",function(a){function b(){self.updateFavsOnFrames(),self.updateFavMarkers(d)}function c(){function a(){self.showLocationFrames(d),self.addHoverEffects()}if(i=!1,locationArray.length>0)a();else var b=setInterval(function(){locationArray.length>0&&(clearInterval(b),a())},500)}var d=a.val();if(h=[],null===d){console.log("user has no favorites");var d=[];b(),i&&c()}else d.forEach(function(a){h.push(a)}),console.log("the user's favorite(s) is/are: "+h.join(", ")),b(),i&&c()},f)},self.addFavorite=function(a){h.push(a),d.child(b.getAuth().uid).update({favorites:h},e)},self.removeFavorite=function(a){var c=[];h.forEach(function(b){a!==b&&c.push(b)}),d.child(b.getAuth().uid).update({favorites:c},e)},self.removeAllFavorites=function(){h=[],self.updateFavsOnFrames(),d.child(b.getAuth().uid).update({favorites:h},e)};var j=[];self.generateMarkers=function(a){for(var b=a.length,c=b;c--;){var d=a[c],e={lat:d.lat,lng:d.lng},f=d.breakName,g=d.location;self.addMarker(f,e,g,d)}self.displayMarkers(map),$map.is(":visible")&&self.setMapBounds()},self.addMarker=function(a,b,c,d){var e=new google.maps.Marker({position:b,map:map,icon:markerIcon.small,title:a+" ("+c+")"});self.addMarkerListeners(e,d)},self.addMarkerListeners=function(a,b){google.maps.event.addListener(a,"dblclick",function(b){return function(){map.setCenter(a.getPosition()),map.getZoom()<14&&map.setZoom(14)}}(a)),google.maps.event.addListener(a,"click",function(c){return function(){self.makeMarkerSmall(),self.makeMarkerBig(a),self.getInfoWindow(a),self.animateMarker(a),x?self.renderSurfGuide(b):self.focusOnFrame(a)}}(a,b)),google.maps.event.addListener(a,"mouseover",function(b){return function(){self.removeTitle();var b=$(".location-frame:visible").length;x||(self.pulseFrame(a),1!==b&&window.innerWidth>=768&&self.scrollToFrame(a))}}()),google.maps.event.addListener(a,"mouseout",function(b){return function(){x||self.pulseFrame(a)}}()),j.push(a),n.push(a.title)},self.displayMarkers=function(a){for(var b=j.length,c=b;c--;)j[c].setMap(a)},self.getMarkerName=function(a){var b=a.title.replace(/ *\([^)]*\) */g,"");return b},self.animateMarker=function(a){a.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(function(){a.setAnimation(null)},730)},self.makeMarkerBig=function(a){var b=getMarkerName(a);a.icon.origin===markerIcon.small.origin?(console.log("make "+b+"'s marker big"),a.setIcon(markerIcon.selected)):a.icon.origin===markerIcon.smallFav.origin&&(console.log("make "+b+"'s marker big"),a.setIcon(markerIcon.selectedFav))},self.makeMarkerSmall=function(){j.forEach(function(a){var b=getMarkerName(a);a.icon.origin===markerIcon.selected.origin?(console.log("make "+b+"'s marker small"),a.setIcon(markerIcon.small)):a.icon.origin===markerIcon.selectedFav.origin&&(console.log("make "+b+"'s marker small"),a.setIcon(markerIcon.smallFav))})},self.getGuideMarker=function(){for(var a=$("#guide-break-name").text(),b=j.length,c=b;c--;){var d=j[c],e=getMarkerName(d);if(a===e)return d}},self.activateMarker=function(a){j.forEach(function(b){var c=getMarkerName(b);c===a&&self.makeMarkerBig(b)})},self.resetMarkers=function(){console.log("reset markers");for(var a=j.length,b=a;b--;){var c=j[b];self.filterMarkers(c)}},self.updateFavMarkers=function(a){function b(){console.log("update marker favorites"),j.forEach(function(b){var c=getMarkerName(b);a.indexOf(c)>-1?b.icon.origin===markerIcon.small.origin?b.setIcon(markerIcon.smallFav):b.icon.origin===markerIcon.selected.origin&&b.setIcon(markerIcon.selectedFav):b.icon.origin===markerIcon.smallFav.origin?b.setIcon(markerIcon.small):b.icon.origin===markerIcon.selectedFav.origin&&b.setIcon(markerIcon.selected)})}var d=0;if(c.on("value",function(a){var b=a.val();b.forEach(function(a){d++})}),d===j.length&&j.length>0)b();else var e=setInterval(function(){d===j.length&&j.length>0&&(clearInterval(e),b())},250)},self.checkVisibleMarkers=function(){var a=j.length;numMarkersVisible=0;for(var b=a;b--;){var c=j[b];c.getVisible()&&numMarkersVisible++}numMarkersVisible<1?$(".reset-map-container").length||x||(console.log("no markers visible"),self.repositionMap()):$(".reset-map-container").length&&$(".reset-map-container").remove()},self.filterMarkers=function(a){var b=getMarkerName(a);if($searchContainer.is(":visible")){var c=self.formatText(self.Query()),b=self.formatText(a.title);b.indexOf(c)>-1&&a.setVisible(!0)}else $(".favorite-filter-selected").length?h.indexOf(b)>-1&&a.setVisible(!0):a.setVisible(!0)},self.manageMarkers=function(){console.log("manage markers");for(var a=j.length,b=a;b--;){var c=j[b];map.getBounds().contains(c.getPosition())?self.filterMarkers(c):c.icon.origin===markerIcon.selected.origin||c.icon.origin===markerIcon.selectedFav.origin?c.setVisible(!0):c.setVisible(!1)}self.checkVisibleMarkers()},self.showLocationFrames=function(a){function b(){console.log("show locations"),c.show()}var c=$(".location-frame");if("undefined"!=typeof a)if(a.length===$(".is-a-favorite").length)b();else if(null===a)b();else var d=setInterval(function(){a.length===$(".is-a-favorite").length?(clearInterval(d),b()):null===a&&(clearInterval(d),b())},250);else b()},self.updateFavsOnFrames=function(){console.log("update location frame favorites");var a=$(".location-frame");a.each(function(){var a=$(this),b=a.children(":nth-child(3)"),c=a.children(":nth-child(2)").text();h.indexOf(c)>-1?b.removeClass("not-a-favorite").addClass("is-a-favorite"):b.hasClass("is-a-favorite")&&b.addClass("not-a-favorite").removeClass("is-a-favorite")})},self.clickLocationFrame=function(a){if(k=!1,self.renderSurfGuide(a),$mapContainer.is(":visible")){var b=self.getGuideMarker();self.animateMarker(b)}self.manageView()},self.scrollToFrame=function(a){function b(){p+=200,o>p?(e.scrollLeft(p),animateRight=requestAnimationFrame(b)):d()}function c(){q-=200,q>o?(e.scrollLeft(q),animateLeft=requestAnimationFrame(c)):d()}function d(){e.scrollLeft(o),console.log("move scroll position from "+h+" toward "+o),console.log("stop scrolling"),console.log("scroll position at: "+e.scrollLeft())}var e=$locationGrid,f=$(".location-frame"),g=$(".pulse-location-frame"),h=e.scrollLeft(),i=getMarkerName(a),j=e.width(),k=f.outerWidth(!0),l=(j-k)/2,m=g.siblings(":visible").addBack().index(g),n=k*m,o=n-l;if(console.log("auto scroll to "+i+"'s location frame"),o>h){var p=h;animateRight=requestAnimationFrame(b)}else{var q=h;animateLeft=requestAnimationFrame(c)}},self.pulseFrame=function(a){function b(a){setTimeout(function(){a.removeClass("reverse-pulse")},400)}var c=$(".location-frame"),d=$(".location-frame:visible").length,e=getMarkerName(a);if(1!==d&&window.innerWidth>=768)c.each(function(){var a=$(this),c=a.children(":nth-child(2)").text();c===e&&($(".pulse-location-frame").length?(console.log("make "+e+"'s location frame small"),a.removeClass("pulse-location-frame").addClass("reverse-pulse"),b(a)):(console.log("make "+e+"'s location frame big"),a.removeClass("reverse-pulse").addClass("pulse-location-frame")))});else if(1===d&&$(".pulse-location-frame").length){var f=$(".location-frame:visible"),g=f[0].children[1].textContent;console.log("make "+g+"'s location frame small"),f.removeClass("pulse-location-frame").addClass("reverse-pulse"),b(f)}},self.adjustFrameStyle=function(){var a=$(".location-frame"),b=$(".location-name"),c=$(".break-name"),d=$(".favorite");a.addClass("location-frame-map").removeClass("location-frame-default"),a.each(function(){var a=$(this);a.is(":visible")&&a.css("display","inline-block")}),a.removeClass("col-xs-12 col-sm-6 col-md-4"),c.removeClass("break-name-default").addClass("break-name-map"),b.removeClass("location-name-default").addClass("location-name-map"),d.attr("class","favorite favorite-map")},self.resetFrames=function(){console.log("reset location frames");var a=j.length,b=$(".location-frame");b.hide();for(var c=a;c--;){var d=j[c];self.filterFrames(d)}},self.focusOnFrame=function(a){var b=getMarkerName(a),c=$(".location-frame");c.hide(),c.each(function(){var a=$(this),c=a.children(":nth-child(2)").text();c===b&&(console.log("show only "+b+"'s location frame"),a.show())})},self.filterFrames=function(a){function b(a){var b=$(".location-frame");b.each(function(){var b=$(this),c=b.children(":nth-child(2)").text();c===a&&b.show()})}var c=getMarkerName(a);if($searchContainer.is(":visible")){var d=self.formatText(self.Query()),e=self.formatText(a.title);e.indexOf(d)>-1&&b(c)}else $(".favorite-filter-selected").length?h.indexOf(c)>-1&&b(c):b(c)},self.manageFrames=function(){for(var a=j.length,b=a;b--;)if(j[b].icon.origin===markerIcon.selected.origin||j[b].icon.origin===markerIcon.selectedFav.origin)return;console.log("manage location frames");var c=$(".location-frame");c.hide();for(var b=a;b--;){var d=j[b];map.getBounds().contains(d.getPosition())&&self.filterFrames(d)}},self.addMapListeners=function(){google.maps.event.addListener(map,"idle",function(){!$map.is(":visible")||z||x||(self.manageFrames(),self.manageMarkers())}),google.maps.event.addListener(map,"click",function(){self.makeMarkerSmall(),infoWindow.close(),x||(self.manageMarkers(),self.manageFrames())})},self.addMapZoomListener=function(){var a=setInterval(function(){var b=$(".gm-style").children(":nth-child(8)").children(":nth-child(1)");b.length?(console.log("zoom listener loaded"),clearInterval(a),"undefined"!=typeof zoomListener&&b.off("click",zoomListener),b.on("click",function(){if(!x)for(var a=j.length,b=a;b--;){var c=j[b];(c.icon.origin===markerIcon.selectedFav.origin||c.icon.origin===markerIcon.selected.origin)&&self.centerOnMarker(c)}})):console.log("zoom listener not loaded")},1e3)},self.repositionMap=function(){function a(){console.log("reposition map"),c.remove();j.length;self.resetMarkers(),self.setMapBounds(),c.remove()}var b='<div class="reset-map-container"></div>';$locationGrid.append(b);var c=$(".reset-map-container"),d='<svg class="reset-button" alt="reload location frames and markers button"><use xlink:href="#reset_button"/></svg>';c.append(d),$resetButton=$(".reset-button"),$resetButton.on("click",function(){a()})},self.setMarkerForGuide=function(){var a=self.getGuideMarker();if(self.makeMarkerBig(a),isInfoWindowOpen(infoWindow))self.centerOnMarker(a),map.setZoom(10);else{self.getInfoWindow(a);setTimeout(function(){self.centerOnMarker(a),map.setZoom(10)},150)}},self.centerOnMarker=function(a){var b=self.getMarkerName(a);console.log("resize map"),google.maps.event.trigger(map,"resize"),console.log("center map over "+b),map.setCenter(a.getPosition())},self.setMapBounds=function(){console.log("set map bounds");for(var a=new google.maps.LatLngBounds,b=j.length,c=b;c--;)j[c].visible&&a.extend(j[c].getPosition());map.fitBounds(a),map.getZoom()>12&&map.setZoom(12)},self.adjustMapSize=function(){var a=$locationGrid.outerHeight(),b=$("#myNavbar").outerHeight(),c=$window.height();if($searchContainer.is(":visible"))var d=$searchContainer.outerHeight(),e=c-(a+d+b);else var e=c-(a+b);$mapContainer.css("height",e),0!==j.length&&$map.is(":visible")&&!z&&(google.maps.event.trigger(map,"resize"),self.setMapBounds())},self.getInfoWindow=function(a){var b=getMarkerName(a);console.log("show "+b+"'s info window");var c='<div class="info-window"><p>'+b+"</p><div>";infoWindow.setContent(c),infoWindow.open(map,a);var d=$(".gm-style-iw");$iwFrame=d.parent(),$iwContainer=d.parent().parent(),$iwFrame.children(":nth-child(1)").children(":nth-child(3)").css("display","none"),$iwFrame.children(":nth-child(1)").children(":nth-child(1)").css("display","none"),$iwFrame.children(":nth-child(1)").children(":nth-child(4)").css("display","none"),$iwFrame.children(":nth-child(1)").children(":nth-child(2)").css("display","none"),$iwFrame.children(":nth-child(3)").css("display","none"),$iwContainer.css("pointer-events","none"),$iwContainer.on("mousemove",function(a){$(this).next().trigger(a)}),$iwContainer.css({left:"11px",top:"42px"})},self.isInfoWindowOpen=function(a){var b=a.getMap();return null!==b&&"undefined"!=typeof b},self.toggleHoverClasses=function(){var a=$(".skill-level-hover"),b=$(".break-type-hover"),c=$(".wave-direction-hover"),d=$(".best-season-hover"),e=$(".misc-info-one-hover"),f=$(".misc-info-two-hover"),g=$(".distance-hover"),h=$(".water-temp-hover"),i=$(".wave-size-hover"),j=$(".cost-hover");k?(console.log("adjust hover icons and info to map view style"),a.removeClass("skill-level-hover-default").addClass("skill-level-hover-map"),b.removeClass("break-type-hover-default").addClass("break-type-hover-map"),c.removeClass("wave-direction-hover-default").addClass("wave-direction-hover-map"),d.removeClass("best-season-hover-default").addClass("best-season-hover-map"),e.removeClass("misc-info-one-hover-default").addClass("misc-info-one-hover-map"),f.removeClass("misc-info-two-hover-default").addClass("misc-info-two-hover-map"),g.removeClass("distance-hover-default").addClass("distance-hover-map"),h.removeClass("water-temp-hover-default").addClass("water-temp-hover-map"),i.removeClass("wave-size-hover-default").addClass("wave-size-hover-map"),j.removeClass("cost-hover-default").addClass("cost-hover-map")):(console.log("revert hover icons and info back to default style"),a.removeClass("skill-level-hover-map").addClass("skill-level-hover-default"),b.removeClass("break-type-hover-map").addClass("break-type-hover-default"),c.removeClass("wave-direction-hover-map").addClass("wave-direction-hover-default"),d.removeClass("best-season-hover-map").addClass("best-season-hover-default"),e.removeClass("misc-info-one-hover-map").addClass("misc-info-one-hover-default"),f.removeClass("misc-info-two-hover-map").addClass("misc-info-two-hover-default"),g.removeClass("distance-hover-map").addClass("distance-hover-default"),h.removeClass("water-temp-hover-map").addClass("water-temp-hover-default"),i.removeClass("wave-size-hover-map").addClass("wave-size-hover-default"),j.removeClass("cost-hover-map").addClass("cost-hover-default"))};var k;self.addHoverEffects=function(){console.log("enable hover effect"),$(".location-frame").each(function(){var a=$(this),b=$(this).children(":nth-child(1)").children(":nth-child(1)"),c=$(this).children(":nth-child(2)"),d=$(this).children(":nth-child(3)").children(":nth-child(1)"),e=$(this).children(":nth-child(4)");a.on("mouseenter",function(f){function g(f){b.css({"-webkit-filter":"blur(4px) brightness(80%)",filter:"blur(4px) brightness(80%)"}),e.hide(),c.hide(),d.hide();var g=displaySkillIcon(f.skillLevel);a.append(g);var h=displayBreakIcon(f.breakDetails);a.append(h);var i=displayDirectionIcon(f.waveDirection);a.append(i);var j=displayBestSeasonIcon(f.optimalTime);a.append(j);var k=displayBigWaveIcon(f);a.append(k);var l=displayWellKnownIcon(f);a.append(l);var m=displayCost(f.cost);if(a.append(m),"undefined"!=typeof currentLat){var n=displayDistance(f.lat,f.lng);a.append(n)}var o=displayCurrentWaterTemp(f.avgWaterTemp);a.append(o);var p=displayWaveSize(f.avgSize);a.append(p)}k=!0;var h=f.currentTarget.children[1].textContent;console.log("hover over "+h),v&&activateMarker(h),self.locationArray.forEach(function(a){h===a.breakName&&g(a)}),u||w||self.toggleHoverClasses(),console.log("add hover tooltips"),self.addToolTips()}),a.on("mouseleave",function(){k=!1;var a=$(".rollover-info");a.removeClass("tooltip-loaded"),u||w||self.toggleHoverClasses(),b.css({"-webkit-filter":"blur(0px) brightness(100%)",filter:"blur(0px) brightness(100%)"}),e.show(),c.show(),d.show(),x||self.isInfoWindowOpen(infoWindow)||w||self.makeMarkerSmall(),a.remove()})})},self.showUser=function(){var a=b.getAuth();d.child(a.uid).child("name").on("value",function(a){var b=a.val();console.log(b+" is currently logged in")},f)};var l;self.checkAuthentication=function(a){try{window.localStorage&&(a?(console.log("user "+a.uid+" is logged in with "+a.provider),l=!1,self.getFavorites(a)):(console.log("user is logged out"),l=!0),setInterval(self.showUser,6e4))}catch(b){if(console.log("Firebase log in disabled because local storage unavailable ("+b+")"),self.showLocationFrames(),locationArray.length>0)self.addHoverEffects();else var c=setInterval(function(){locationArray.length>0&&(clearInterval(c),self.addHoverEffects())},500)}},b.onAuth(self.checkAuthentication),l&&b.authAnonymously(function(a,c){a?console.log("login Failed!",a):b.child("users").child(c.uid).set({favorites:[],name:prompt("Please enter your name")})}),self.addToolTips=function(){function a(a,c,d){var e='<p class="tooltip-info">'+a+"</p>",f=20,g=c.pageX,h=c.pageY+f;$body.append(e);var i=$(".tooltip-info");i.offset({top:h,left:g});var j=window.innerWidth,k=j-20,l=i.offset().left,m=i.outerWidth(),n=l+m;if(n>=k){i.outerWidth(220);var l=i.offset().left,m=i.outerWidth(),n=l+m}if(n>=j){var o=-20,p=n-j,q=g-p+o;i.offset({top:h,left:q})}b=setTimeout(function(){i.fadeOut(500,function(){console.log("hide tooltip"),i.remove()})},2e3),d.on("mousemove",function(){if(d.off("mousemove"),clearTimeout(b),d.hasClass("hover-tooltip-only"))var a=0;else var a=500;i.fadeOut(a,function(){console.log("hide tooltip"),i.remove()})})}var b,c,d,e=$("[title]");e.each(function(){var e=$(this);if(!e.hasClass("tooltip-loaded")){var f=e.attr("title");e.addClass("tooltip-loaded"),e.on("click mouseover mouseleave",function(g){var h=g;switch($(".tooltip-info").length&&(console.log("hide tooltip"),clearInterval(b),$(".tooltip-info").remove()),clearTimeout(c),e.off("mousemove"),h.type){case"mouseover":if(e.removeAttr("title"),e.on("mousemove",function(a){d=a}),e.hasClass("hover-tooltip-only"))var i=3e3;else var i=2e3;c=setTimeout(function(){console.log("show tooltip"),e.off("mousemove"),a(f,d,e)},i);break;case"mouseleave":e.attr("title",f);break;case"click":e.hasClass("hover-tooltip-only")||(console.log("show tooltip"),e.removeAttr("title"),a(f,h,e))}})}})},self.removeTitle=function(){$("[title]").each(function(){var a=$(this);m.indexOf(a.attr("title"))>-1?a.removeAttr("title"):n.indexOf(a.attr("title"))>-1&&(console.log("disable marker tooltip"),a.removeAttr("title"))})};var m=["Report errors in the road map or imagery to Google","Zoom in","Zoom out","Rotate map 90 degrees","Show satellite imagery","Change map style"],n=[];self.removeGoogleElemTitles=function(){var a=m.length,b=0,c=setInterval(function(){$("[title]").each(function(){var d=$(this);m.indexOf(d.attr("title"))>-1&&(b++,b===a&&(clearInterval(c),console.log("disable Google tooltips"),self.removeTitle()))})},500)};var o=$("#navbar-main"),p=o.offset().top;if($window.scroll(function(){$window.scrollTop()>p?(o.addClass("navbar-fixed-top"),$body.css("padding-top","50px")):(o.removeClass("navbar-fixed-top"),$body.css("padding-top","0px"))}),self.loadProgressIndicator=function(){var a=new CanvasLoader("progressBarContainer");return a.setColor("#35ABBB"),a.setShape("spiral"),a.setDiameter(72),a.setDensity(33),a.setRange(1),a.setFPS(23),a.show(),a},"ontouchstart"in document.documentElement){console.log("device supports touch events");for(var q=document.styleSheets.length-1;q>=0;q--){var r=document.styleSheets[q];if(r.cssRules)for(var s=r.cssRules.length-1;s>=0;s--){var t=r.cssRules[s];t.selectorText&&(t.selectorText=t.selectorText.replace(":hover",":active"))}}}self.enableHorizontalScrolling=function(){$locationGrid.off(),$locationGrid.mousewheel(function(a,b){this.scrollLeft-=1*b,a.preventDefault()})},self.manageLayout=function(){console.log("manage layout");var a=$(".location-frame"),b=$("#container"),c=$(".favorite"),d=$(".break-name"),e=$(".location-name");u||w||x?($mapContainer.removeClass("map-container-map").addClass("map-container-default"),$mapContainer.css("height","245px"),$(".map-selected").length&&$mapContainer.show(),$searchForm.removeClass("search-form-map").addClass("search-form-default"),$clearSymbol.removeClass("clear-map").addClass("clear-default"),$clearFavsBtn.removeClass("clear-favorites-button-map").addClass("clear-favorites-button-default"),$locationGrid.removeClass("location-grid-map"),a.removeClass("location-frame-map").addClass("location-frame-default"),b.removeClass("container-fluid").addClass("container"),$locationGrid.removeClass("row-fluid").addClass("row"),a.addClass("col-xs-12 col-sm-6 col-md-4"),d.removeClass("break-name-map").addClass("break-name-default"),e.removeClass("location-name-map").addClass("location-name-default"),c.attr("class","favorite favorite-default"),$locationGrid.off(),0===j.length||!$map.is(":visible")||x||z?x&&$map.is(":visible")&&self.setMarkerForGuide():(console.log("map is visible"),google.maps.event.trigger(map,"resize"),self.setMapBounds())):(console.log("update map view layout"),$mapContainer.removeClass("map-container-default").addClass("map-container-map"),$searchForm.addClass("search-form-map").removeClass("search-form-default"),$clearSymbol.addClass("clear-map").removeClass("clear-default"),$clearFavsBtn.removeClass("clear-favorites-button-default").addClass("clear-favorites-button-map"),$locationGrid.addClass("location-grid-map"),b.removeClass("container").addClass("container-fluid"),$locationGrid.removeClass("row").addClass("row-fluid"),self.adjustFrameStyle(),self.adjustMapSize(),self.enableHorizontalScrolling())};var u,v,w,x;self.manageView=function(){var a=window.innerWidth;$(".surf-guide-container").length&&768>a?(v=!1,w=!1,u=!0,x=!0,console.log("view is surf guide/mobile")):$(".surf-guide-container").length&&a>=768?(v=!1,w=!1,u=!1,x=!0,console.log("view is surf guide")):768>a?(v=!1,w=!1,x=!1,u=!0,console.log("view is mobile")):(u=!1,x=!1,$(".map-selected").length?(w=!1,v=!0,console.log("view is map")):(v=!1,w=!0,console.log("view is grid"))),self.manageLayout()},self.manageView();var y,z;$window.resize(function(){self.manageView(),console.log("resize window"),$map.is(":visible")&&!x&&(z=!0,console.log("disable frame and marker managers"),clearTimeout(y),y=setTimeout(function(){$map.is(":visible")&&!x&&(google.maps.event.trigger(map,"resize"),self.setMapBounds()),z=!1,console.log("enable frame and marker managers")},100))}),self.formatText=function(a){var b=a.toLowerCase().replace(/ /g,"").replace(/'/g,"").replace(/,/g,"");return b},self.Query=ko.observable(""),self.searchLocations=function(){var a=self.formatText(self.Query()),b=$(".location-frame");b.hide(),b.each(function(){var b=$(this),c=self.formatText(b.text());c.indexOf(a)>-1&&b.show()}),j.forEach(function(b){self.formatText(b.title).indexOf(a)>-1?b.setVisible(!0):b.setVisible(!1)}),$map.is(":visible")&&self.setMapBounds(),$mapContainer.is(":visible")&&self.manageLayout()};var A=$(".search-symbol");if(self.searchKeywords.length>1)self.loadAutoComplete();else var B=setInterval(function(){self.searchKeywords.length>1&&(clearInterval(B),self.loadAutoComplete())},500);self.loadAutoComplete=function(){var a=!1;$searchForm.autocomplete({source:self.searchKeywords,autoFocus:!0,minLength:2,delay:0,select:function(b,c){a=!0,console.log("select event"),self.Query(c.item.value),self.searchLocations(),$(this).blur()}}),$searchForm.on("keydown",function(b){13===b.keyCode&&a&&(console.log("enter was pressed, so let us move on"),$(this).blur())})},self.toggleSearch=function(){$searchContainer.slideToggle(500),setTimeout(function(){console.log("toggle search"),$(".favorite-filter-selected").length||self.resetPage(),$clearSymbol.is(":visible")&&$clearSymbol.toggle(),$searchContainer.is(":visible")&&!$(".search-selected").length?($searchForm.focus(),A.removeClass("search-default"),A.addClass("search-selected")):(A.removeClass("search-selected"),A.addClass("search-default"))},600)},A.on("click",function(){$(".favorite-filter-selected").length&&($filtersContainer.slideUp(500),console.log("hide filters container and favorites"),$favFilterSym.removeClass("favorite-filter-selected"),$favFilterSym.addClass("favorite-filter-default")),$window.scrollTop()<56||$window.scrollTop()>=56&&$searchContainer.is(":hidden")?(document.body.scrollTop=document.documentElement.scrollTop=0,self.toggleSearch()):$searchForm.focus()}),$searchForm.on("click",function(){self.resetPage()}).on("focus",function(){$($searchForm).val()||$clearSymbol.toggle()}).on("blur",function(){$($searchForm).val()||$clearSymbol.toggle()}),$clearSymbol.on("click",function(){$clearSymbol.toggle(),self.resetPage(),$searchForm.focus()}),self.filterFavorites=function(){if($map.is(":hidden")){var a=$(".location-frame");a.hide(),a.each(function(){var a=$(this),b=a.children(":nth-child(2)").text();h.indexOf(b)>-1&&a.show()})}infoWindow.close(),self.makeMarkerSmall(),j.forEach(function(a){var b=getMarkerName(a);h.indexOf(b)>-1?a.setVisible(!0):a.setVisible(!1)}),console.log("update map with favorites"),$map.is(":visible")&&self.setMapBounds()},$favFilterSym.on("click",function(){if($(".favorite-filter-selected").length)console.log("show all locations"),$(".map-container-map").length?$filtersContainer.fadeOut(500):$filtersContainer.slideUp(500),$favFilterSym.removeClass("favorite-filter-selected").addClass("favorite-filter-default"),self.resetPage();else{if($(".favorite-filter-selected").length||!(h.length>0))return void console.log("user has no favorites");if(console.log("show favorites only"),$searchContainer.is(":visible")&&self.toggleSearch(),x&&self.closeSurfGuide(),$favFilterSym.removeClass("favorite-filter-default").addClass("favorite-filter-selected"),$map.is(":visible")&&$searchContainer.is(":visible")){setTimeout(function(){self.filterFavorites(),self.manageLayout()},600)}else self.filterFavorites(),self.manageLayout();$map.is(":visible")?$filtersContainer.fadeIn(500):$filtersContainer.slideDown(500)}$(".map-container-map").length||(document.body.scrollTop=document.documentElement.scrollTop=0)}),$clearFavsBtn.on("click",function(){$(".map-container-map").length?$filtersContainer.fadeOut(500):$filtersContainer.slideUp(500),$favFilterSym.removeClass("favorite-filter-selected"),$favFilterSym.addClass("favorite-filter-default"),self.removeAllFavorites(),self.resetPage()}),$mapSymbol.on("click",function(a){var b=$window.scrollTop(),c=$mapSection.height(),d=$(".location-frame"),e=$(".location-frame:visible").length;v?($mapSymbol.toggleClass("map-default map-selected"),$map.hide(),self.manageView(),$mapContainer.show(),self.resetFrames(),self.resetMarkers(),$mapContainer.slideToggle(200,function(){console.log("close map"),console.log("close any open info windows"),infoWindow.close(),self.makeMarkerSmall()})):w?(document.body.scrollTop=document.documentElement.scrollTop=0,$mapSymbol.toggleClass("map-default map-selected"),$map.is(":hidden")&&$map.show(),self.manageView(),
console.log("open map"),self.removeGoogleElemTitles(),self.addMapZoomListener(),$mapContainer.fadeIn(1e3),console.log("resize map"),google.maps.event.trigger(map,"resize"),self.setMapBounds()):x&&!u?(document.body.scrollTop=document.documentElement.scrollTop=0,$mapSymbol.toggleClass("map-default map-selected"),$map.is(":hidden")&&$map.show(),$mapContainer.slideToggle(200,function(){$map.is(":visible")?(console.log("open map"),self.removeGoogleElemTitles(),self.addMapZoomListener(),self.setMarkerForGuide()):console.log("close map")})):u&&c>b||b>=c&&$mapContainer.is(":hidden")?(document.body.scrollTop=document.documentElement.scrollTop=0,$mapSymbol.toggleClass("map-default map-selected"),$map.is(":hidden")&&$map.show(),1==e&&d.length>1&&d.show(),$mapContainer.slideToggle(200,function(){$map.is(":visible")?(console.log("open map"),self.removeGoogleElemTitles(),self.addMapZoomListener(),x?self.setMarkerForGuide():(console.log("resize map"),google.maps.event.trigger(map,"resize"),self.setMapBounds())):(self.resetFrames(),self.resetMarkers(),console.log("close map"),x||(console.log("close any open info windows"),infoWindow.close(),self.makeMarkerSmall()))})):(console.log("scroll to map"),document.body.scrollTop=document.documentElement.scrollTop=0)}),self.resetPage=function(){console.log("reset locations & map, clear search, and close surf guide"),x&&self.closeSurfGuide(),$searchForm.val(""),self.Query(""),infoWindow.close(),self.makeMarkerSmall();var a=$(".location-frame");a.show(),$locationGrid.is(":hidden")&&$locationGrid.show(),self.manageView(),j.forEach(function(a){a.setVisible(!0)}),$map.is(":hidden")||self.setMapBounds()};self.renderSurfGuide=function(a){function b(a){e.prepend('<button type="button" class="btn guide-close-button">✖</button>');var b=$(".guide-close-button");g.append('<button type="button" class="btn conditions-button">Current Conditions</button>'),$conditionsBtn=$(".conditions-button"),$conditionsBtn.on("click",function(b){if($(".live-surf-conditions").is(":hidden"))i.addClass("col-sm-6 sm-icon-frame"),j.addClass("md-icon-container"),$(".live-surf-conditions").toggle(),$conditionsBtn.toggle(),$closeConditionsButton.toggle();else{$conditionsBtn.toggle(),$("#progressBarContainer").length||g.append('<div id="progressBarContainer"></div>'),$progressIndicator=$("#progressBarContainer");self.loadProgressIndicator();d(a.spotID,a.breakName)}}),b.on("click",function(a){$(".favorite-filter-selected").length&&($filtersContainer.toggle(),self.filterFavorites()),self.closeSurfGuide()})}function c(a){$(".favorite-wrapper-guide").on("click",function(){var b=$(this);$(".is-a-favorite-guide").length?(b.removeClass("is-a-favorite-guide").addClass("not-a-favorite-guide"),console.log("unfavorite "+a),removeFavorite(a)):(b.removeClass("not-a-favorite-guide").addClass("is-a-favorite-guide"),console.log("favorite "+a),addFavorite(a))})}function d(a,b){function c(a){function c(){function a(){c.drawImage(d,0,1177,g,h,0,0,i,j),c.save(),c.translate(150,150),c.rotate(e),c.drawImage(d,0,561,g,h,-150,-150,i,j),c.rotate(-e),c.rotate(f),c.drawImage(d,4,869,g,h,-150,-150,i,j),c.restore()}var b=document.getElementById("compass"),c=b.getContext("2d"),d=new Image;d.src="img/png/png_sprites.png",d.onload=a;var e=p*(Math.PI/180),f=m*(Math.PI/180),g=308,h=308,i=300,j=300}if(e===b&&!$(".conditions-error").length){var d=a.swell.minBreakingHeight,f=a.swell.maxBreakingHeight;if(d===f)var h=d;else var h=d+" - "+f;var k=a.swell.components.primary.height,l=a.swell.components.primary.period,m=a.swell.components.primary.direction,n=a.swell.components.primary.compassDirection,o=a.wind.speed,p=a.wind.direction,q=a.wind.compassDirection,r=a.condition.temperature,s=a.condition.weather,t="http://cdnimages.magicseaweed.com/30x30/"+s+".png";rating=[];for(var u=a.solidRating,v='<svg class="rating"><use xlink:href="#star_filled"/></svg>',w=u;w--;)rating.push(v);for(var x=a.fadedRating,y='<svg class="rating"><use xlink:href="#star_faded"/></svg>',w=x;w--;)rating.push(y);for(var z=5-rating.length,A='<svg class="rating"><use xlink:href="#star_empty"/></svg>',w=z;w--;)rating.push(A);var B=rating.join(""),C='<div class="col-xs-12 surf-conditions-container live-surf-conditions"></div>',D='<div class="col-xs-12 col-sm-4 col-md-6 live-surf-conditions live-compass" title="Live wind & swell conditions (swell: blue | wind: white)"><canvas id="compass" width="300" height="300"></canvas></div>';g.after(D),i.addClass("col-sm-6 sm-icon-frame"),j.addClass("md-icon-container"),g.after(C);var E=$(".surf-conditions-container"),F='<div class="col-xs-12 col-sm-6 surf-conditions-small surf-conditions-waves"></div>',G='<div class="col-xs-6 col-sm-3 surf-conditions-small surf-conditions-swell"></div>',H='<div class="col-xs-6 col-sm-3 surf-conditions-small surf-conditions-wind " title="Wind direction & speed"></div>';E.append(F),E.append(G),E.append(H);var I=$(".title"),J='<p class="live-temp live-surf-conditions " title="Live weather conditions">'+r+' ℉<img class="live-weather" src="'+t+'" alt="Symbol for current weather"></p>',K='<a href="http://magicseaweed.com" target="_blank"><div class="icon icon-msw_powered_by live-surf-conditions msw-banner"></div></a>';I.after(K),I.after(J);var L=$(".surf-conditions-wind"),M=$(".surf-conditions-swell"),N=$(".surf-conditions-waves"),O="<p>"+o+"mph</p>",P='<svg  alt="Symbol for wind"><use xlink:href="#wind"/></svg>',Q="<p>"+q+" wind</p>";L.append(O),L.append(P),L.append(Q);var R="<p>"+k+"ft</p>",S='<p class=" " title="The main swell generating waves">primary</p>',T='<p class=" " title="Live period between waves & current direction">@ '+l+"s "+n+"</p>";M.append(R),M.append(S),M.append(T);var U='<p class="live-wave-height " title="Live wave height">'+h+"ft</p>",V='<p class="star-rating " title="Magic Seaweed Rating: The more solid stars, the better. Unfavorable wind conditions change a solid star to a faded star">'+B+"</p>";N.append(U),N.append(V),c(),N.prepend('<button type="button" class="btn conditions-close-button">✖</button>'),$closeConditionsButton=$(".conditions-close-button");var W=$(".live-surf-conditions");$closeConditionsButton.on("click",function(a){i.removeClass("col-sm-6 sm-icon-frame"),j.removeClass("md-icon-container"),W.toggle(),$closeConditionsButton.toggle(),$conditionsBtn.toggle()}),console.log("add live conditions tooltips"),self.addToolTips()}}function d(){if(console.log("MSW api request unsuccessful"),e===b){var a='<div class="col-xs-12 error-frame"></div>',c='<div class="error-container"></div>',d='<p class="conditions-error">'+b+" conditions unavailable =(</p>",f='<button type="button" class="btn error-close-button">✖</button>';g.after(a);var h=$(".error-frame");h.append(c);var i=$(".error-container");i.append(d),i.prepend(f);var j=$(".error-close-button");j.on("click",function(a){h.remove(),$closeConditionsButton.remove(),$conditionsBtn.toggle()})}}console.log("get current conditions");var e=$("#guide-break-name").text();if("none"===a)$progressIndicator.remove(),d();else{var f=setTimeout(function(){$progressIndicator.remove(),d()},8e3),h="http://magicseaweed.com/api/d2983e394d07724e96404fba11c10485/forecast/?spot_id="+a+"&units=us&fields=timestamp,fadedRating,solidRating,swell.minBreakingHeight,swell.maxBreakingHeight,swell.components.primary.*,wind.*,condition.*";$.ajax({url:h,dataType:"jsonp",success:function(a){console.log("MSW api request successful");for(var b=Date.now(),d=b/1e3,e=d-10800,g=d+10800,h=a.length,i=h;i--;){var j=a[i].timestamp;if(d>j&&j>e)var k=a[i];else if(j>d&&g>j)var k=a[i]}c(k),clearTimeout(f),$progressIndicator.remove()}})}}$(".favorite-filter-selected").length&&$filtersContainer.toggle(),document.body.scrollTop=document.documentElement.scrollTop=0,$locationGrid.hide(),$surfInfoContainer.children(":nth-child(1)").remove(),$surfInfoContainer.append('<div class="row surf-guide-container"></div>');var e=$(".surf-guide-container"),f=displayTitle(a.breakName,a.location);e.append(f);var g=e.children(":nth-child(1)"),h=displayFavoriteIcon(a.breakName);g.children(":nth-child(1)").prepend(h),c(a.breakName),e.append('<div class="col-xs-12 icon-frame"></div>');var i=$(".icon-frame");i.append('<div class="xs-icon-container sm-icon-container icon-container"></div>');var j=$(".icon-container");displayBigWaveIcon(a,j),displayWellKnownIcon(a,j);var k=displaySkillIcon(a.skillLevel);j.append(k);var l=displayDirectionIcon(a.waveDirection);j.append(l);var m=displayBreakIcon(a.breakDetails);j.append(m);var n=displayWaveSize(a.avgSize);j.append(n);var o=100,p=100;displayCompassIcon(a.optimalSwell,a.optimalWind,j,o,p);var q=displayTideIcon(a.optimalTide);j.append(q);var r=displayBestSeasonIcon(a.optimalTime);j.append(r),displaySuggestedAttireIcons(a.avgWaterTemp,j);var s=displayClimateIcon(a.climate);j.append(s);var t=displayCost(a.cost,j);if(j.append(t),"undefined"!=typeof currentLat){var u=displayDistance(a.lat,a.lng);j.append(u)}displayHazardIcons(a.hazards,j),$(".card").addClass("col-xs-4 col-sm-3"),b(a),console.log("add surf guide tooltips"),self.addToolTips()},self.displayTitle=function(a,b){var c='<div class="col-xs-12 guide-header"><p class="title"><span id="guide-break-name">'+a+"</span>, "+b+"</p></div>";return c},self.displayFavoriteIcon=function(a){if(h.indexOf(a)>-1)var b=!0;if(b)var c='<span class="favorite-wrapper-guide is-a-favorite-guide"><svg class="favorite-guide"><use xlink:href="#star"/></svg></span>';else var c='<span class="favorite-wrapper-guide not-a-favorite-guide"><svg class="favorite-guide"><use xlink:href="#star"/></svg></span>';return c},self.setUpIcons=function(a,b,c,d,e,f){if(e)var g='<div class="'+a+'" title="'+b+'"><svg class="'+f+'"><use xlink:href="'+e+'"/></svg><svg class="'+c+'"><use xlink:href="'+d+'"/></svg></div>';else var g='<div class="'+a+'" title="'+b+'"><svg class="'+c+'"><use xlink:href="'+d+'"/></svg></div>';return g},self.displayBigWaveIcon=function(a,b){if(k)var c="hover-icon-frame rollover-info misc-info-one-hover-default misc-info-one-hover hover-tooltip-only",d="hover-icon";else var c="big-wave card",d="big-wave-guide";var e="Known for big wave surfing",f="#big_wave",g=self.setUpIcons(c,e,d,f);if(a.bigWave&&!k)return void b.append(g);if(!a.bigWave&&k)var g=self.displaySuggestedAttireIcons(a.avgWaterTemp);else if(!a.bigWave&&!k)return;return g},self.displayWellKnownIcon=function(a,b){if(k)c="misc-info-two-hover hover-icon-frame rollover-info misc-info-two-hover-default well-known-hover hover-tooltip-only",d="hover-icon";else var c="well-known card",d="well-known-guide";var e="Well known around the world",f="#well_known",g=self.setUpIcons(c,e,d,f);if(a.wellKnown&&!k)return void b.append(g);if(!a.wellKnown&&k)var g=self.displayHazardIcons(a.hazards,b);else if(!a.wellKnown&&!k)return;return g},self.displaySkillIcon=function(a){for(var b=0,c=0,d=0,e=a.length,f=e;f--;)switch(a[f]){case"beginner":b++;break;case"intermediate":c++;break;case"advanced":d++}if(k)var g="hover-icon-frame rollover-info skill-level-hover-default skill-level-hover hover-tooltip-only",h="hover-icon",i="hover-icon skill-level-bg-hover";else var g="skill-level card",h="skill-level-guide",i="skill-level-bg-guide";var j="#skill_level_all";if(b===c&&b===d)var l="Difficulty: All levels",m="#skill_level_all",n=self.setUpIcons(g,l,h,m,j,i);else if(b>=c&&b>d){if(b===c){var l="Difficulty: Beginner to Intermediate",m="#skill_level_beginner_intermediate",n=self.setUpIcons(g,l,h,m,j,i);return n}var l="Difficulty: Beginner",m="#skill_level_beginner",n=self.setUpIcons(g,l,h,m,j,i)}else if(c>b&&c>=d)if(c===d)var l="Difficulty: Intermediate to Advanced",m="#skill_level_intermediate_advanced",n=self.setUpIcons(g,l,h,m,j,i);else var l="Difficulty: Intermediate",m="#skill_level_intermediate",n=self.setUpIcons(g,l,h,m,j,i);else var l="Difficulty: Advanced",m="#skill_level_advanced",n=self.setUpIcons(g,l,h,m,j,i);return n},self.displayDirectionIcon=function(a){if(k)var b="hover-icon-frame rollover-info wave-direction-hover-default wave-direction-hover hover-tooltip-only",c="hover-icon";else var b="direction card",c="wave-direction-guide";switch(a){case"left":var d="Wave breaks left",e="#direction_left",f=self.setUpIcons(b,d,c,e);break;case"right":var d="Wave breaks right",e="#direction_right",f=self.setUpIcons(b,d,c,e);break;case"left & right":var d="Wave breaks left & right",e="#direction_both",f=self.setUpIcons(b,d,c,e)}return f},self.displayBreakIcon=function(a){if(k)var b="hover-icon-frame rollover-info break-type-hover-default break-type-hover hover-tooltip-only",c="hover-icon";else var b="break card",c="break-type-guide";switch(a){case"reef":var d="Reef break",e="#break_reef",f=self.setUpIcons(b,d,c,e);break;case"beach":var d="Beach break",e="#break_beach",f=self.setUpIcons(b,d,c,e);break;case"point":var d="Point break",e="#break_point",f=self.setUpIcons(b,d,c,e);break;case"river mouth":var d="Breaks at a river mouth",e="#break_river_mouth",f=self.setUpIcons(b,d,c,e)}return f},self.displayCompassIcon=function(a,b,c,d,e){function f(a){var b=new Image;if(b.src="img/png/png_sprites.png",g){g=!1,drawBackground=!0,c.append('<div class="small-compass-guide card " title="Best Swell & Best Wind"><canvas id="compass-small" width="'+d+'" height="'+e+'"></canvas></div>');var f=345}else if(h){h=!1;var f=453}var i=document.getElementById("compass-small"),j=i.getContext("2d");drawBackground&&(j.drawImage(b,0,237,108,108,0,0,100,100),j.save());var k=d/2,l=e/2;j.translate(k,l);for(var m=a.length,n=m;n--;){switch(a[n]){case"N":var o=0;break;case"NNE":var o=22.5;break;case"NE":var o=45;break;case"ENE":var o=67.5;break;case"E":var o=90;break;case"ESE":var o=112.5;break;case"SE":var o=135;break;case"SSE":var o=157.5;break;case"S":var o=180;break;case"SSW":var o=202.5;break;case"SW":var o=225;break;case"WSW":var o=247.5;break;case"W":var o=270;break;case"WNW":var o=292.5;break;case"NW":var o=315;break;case"NNW":var o=337.5}var p=o*(Math.PI/180);j.rotate(p),j.drawImage(b,0,f,108,108,-k,-l,100,100),j.rotate(-p)}drawBackground&&(drawBackground=!1,j.restore())}if(a){var g=!0;f(a)}var h=!0;f(b)},self.displayTideIcon=function(a){for(var b=0,c=0,d=0,e=a.length,f=e;f--;)switch(a[f]){case"low":b++;break;case"mid":c++;break;case"high":d++}if(b===c&&b===d)var g='<div class="tide card " title="Best Tide: All"><svg class="tide-guide"><use xlink:href="#tide_all"/></svg></div>';else if(b>=c&&b>=d)if(b===c)var g='<div class="tide card " title="Best Tide: Low & Mid"><svg class="tide-guide"><use xlink:href="#tide_low_mid"/></svg></div>';else if(b===d)var g='<div class="tide card " title="Best Tide: Low & High"><svg class="tide-guide"><use xlink:href="#tide_low_high"/></svg></div>';else var g='<div class="tide card " title="Best Tide: Low"><svg class="tide-guide"><use xlink:href="#tide_low"/></svg></div>';else if(c>b&&c>=d)if(c===d)var g='<div class="tide card " title="Best Tide: Mid & High"><svg class="tide-guide"><use xlink:href="#tide_high_mid"/></svg></div>';else var g='<div class="tide card " title="Best Tide: Mid"><svg class="tide-guide"><use xlink:href="#tide_mid"/></svg></div>';else var g='<div class="tide card " title="Best Tide: High"><svg class="tide-guide"><use xlink:href="#tide_high"/></svg></div>';return g},self.displayBestSeasonIcon=function(a){for(var b=0,c=0,d=0,e=0,f=a.length,g=f;g--;)switch(a[g]){case" Dec":case" Jan":case" Feb":e++;break;case" Mar":case" Apr":case" May":b++;break;case" Jun":case" Jul":case" Aug":c++;break;case" Sep":case" Oct":case" Nov":d++}if(k)var h="hover-icon-frame rollover-info best-season-hover-default best-season-hover hover-tooltip-only",i="hover-icon";else var h="time card",i="best-season-guide";if(e===b&&e===c&&e===d)var j="Best Season: All",l="#season_all",m=self.setUpIcons(h,j,i,l);else if(e>=b&&e>=c&&e>=d)if(e===b)var j="Best Season: Winter & Spring",l="#season_winter_spring",m=self.setUpIcons(h,j,i,l);else if(e===c)var j="Best Season: Winter & Summer",l="#season_winter_summer",m=self.setUpIcons(h,j,i,l);else if(e===d)var j="Best Season: Winter & Autumn",l="#season_winter_autumn",m=self.setUpIcons(h,j,i,l);else var j="Best Season: Winter",l="#season_winter",m=self.setUpIcons(h,j,i,l);else if(b>=c&&b>=d&&b>e)if(b===c)var j="Best Season: Spring & Summer",l="#season_spring_summer",m=self.setUpIcons(h,j,i,l);else if(b===d)var j="Best Season: Spring & Autumn",l="#season_spring_autumn",m=self.setUpIcons(h,j,i,l);else var j="Best Season: Spring",l="#season_spring",m=self.setUpIcons(h,j,i,l);else if(c>=d&&c>e&&c>b)if(c===d)var j="Best Season: Summer & Autumn",l="#season_summer_autumn",m=self.setUpIcons(h,j,i,l);else var j="Best Season: Summer",l="#season_ummer",m=self.setUpIcons(h,j,i,l);else var j="Best Season: Autumn",l="#season_autumn",m=self.setUpIcons(h,j,i,l);return m},self.displaySuggestedAttireIcons=function(a,b){function c(a,c){1===c?b.append('<div class="water-temp spring card " title="Suggested Spring Attire"><svg class="suggested-attire-season-guide suggested-attire-guide"><use xlink:href="#water_temp_spring"/></svg>'+a+"</div>"):2===c?b.append('<div class="water-temp summer card " title="Suggested Summer Attire"><svg class="suggested-attire-season-guide suggested-attire-guide"><use xlink:href="#water_temp_summer"/></svg>'+a+"</div>"):3===c?b.append('<div class="water-temp autumn card " title="Suggested Autumn Attire"><svg class="suggested-attire-season-guide suggested-attire-guide"><use xlink:href="#water_temp_autumn"/></svg>'+a+"</div>"):b.append('<div class="water-temp winter card " title="Suggested Winter Attire"><svg class="suggested-attire-season-guide suggested-attire-guide"><use xlink:href="#water_temp_winter"/></svg>'+a+"</div>")}function d(a){var b="hover-icon-frame rollover-info misc-info-one-hover-default misc-info-one-hover hover-tooltip-only",c="hover-icon";if(a>59)if(a>72)if(k)var d="#ro_water_attire_boardies",f="It's currently warm enough for boardies =)",g=e(b,c,d,f);else var g='<svg class="suggested-attire-boardies-guide suggested-attire-guide"><use xlink:href="#water_attire_boardies"/></svg>';else if(a>66)if(k)var d="#ro_water_attire_2mm_wetsuit",f="A 2mm wetsuit is recommended for this time of year",g=e(b,c,d,f);else var g='<svg class="suggested-attire-wetsuit-guide suggested-attire-guide"><use xlink:href="#water_attire_2mm_wetsuit"/></svg>';else if(k)var d="#ro_water_attire_3mm_wetsuit",f="A 3mm wetsuit is recommended for this time of year",g=e(b,c,d,f);else var g='<svg class="suggested-attire-wetsuit-guide suggested-attire-guide"><use xlink:href="#water_attire_3mm_wetsuit"/></svg>';else if(a>54)if(k)var d="#ro_water_attire_4mm_wetsuit",f="A 4mm wetsuit and boots are recommended for this time of year",g=e(b,c,d,f);else var g='<svg class="suggested-attire-wetsuit-guide suggested-attire-guide"><use xlink:href="#water_attire_4mm_wetsuit"/></svg>';else if(a>48)if(k)var d="#ro_water_attire_5mm_wetsuit",f="A 5mm wetsuit, gloves, and boots are recommended for this time of year",g=e(b,c,d,f);else var g='<svg class="suggested-attire-wetsuit-guide suggested-attire-guide"><use xlink:href="#water_attire_5mm_wetsuit"/></svg>';else if(k)var d="#ro_water_attire_6mm_wetsuit",f="A 6mm wetsuit, gloves, boots, and a hood are recommended for this time of year",g=e(b,c,d,f);else var g='<svg class="suggested-attire-wetsuit-guide suggested-attire-guide"><use xlink:href="#water_attire_6mm_wetsuit"/></svg>';return g}function e(a,b,c,d){var e='<div id="" class="'+a+'" title="'+d+'"><svg class="'+b+'"><use xlink:href="'+c+'"/></svg></div>';return e}if(k){var f=getCurrentSeason();if("winter"===f)var g=d(a.winter);else if("spring"===f)var g=d(a.spring);else if("winter"===f)var g=d(a.summer);else if("autumn"===f)var g=d(a.autumn);return g}var h=0;for(var i in a){h++;var j=d(a[i]);c(j,h)}var f=getCurrentSeason();"winter"===f?$(".winter").addClass("highlight-attire"):"spring"===f?$(".spring").addClass("highlight-attire"):"winter"===f?$(".summer").addClass("highlight-attire"):"autumn"===f&&$(".autumn").addClass("highlight-attire")},self.displayClimateIcon=function(a){var b='<div class="climate card " title="Köppen Climate Classification"><p>'+a+"</p></div>";return b},self.displayCost=function(a,b){if(k)var c='<p class="rollover-info cost-hover-default cost-hover" title="Estimated minimum daily budget allowance">$'+a.budget+"</p>";else var d=Math.floor((a.highEnd-a.budget)/2+a.budget),c=b.append('<div class="cost card "title="Estimated daily budget allowance: Low, Mid, High"><svg class="cost-guide"><use xlink:href="#cost"/></svg><p>'+a.budget+"</p><p>"+d+"</p><p>"+a.highEnd+"</p></div>");return c},self.displayDistance=function(a,b){function c(a){return a*(Math.PI/180)}var d=currentLat,e=currentLng,f=3959,g=c(a-d),h=c(b-e),i=Math.sin(g/2)*Math.sin(g/2)+Math.cos(c(d))*Math.cos(c(a))*Math.sin(h/2)*Math.sin(h/2),j=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),l=f*j,m=Math.round(l);if(m>200){var n=m/450;if(1>n)var o=1;else var o=Math.round(n);if(o>8&&12>=o)var p=o+2,q=p;else if(o>12)var p=o+4,q=p;else var q=o;var r=q;if(k){var s='<p class="rollover-info distance-hover-default distance-hover" title="Estimated flight duration from your location">'+r+"h</p>";return s}var t='<div class="distance card" title="Estimated flight duration from your location"><svg class="distance-guide-plane"><use xlink:href="#distance_plane"/></svg><p class="distance-guide-hours">'+r+"h</p></div>";return t}var u=m;if(k){var s='<p class="rollover-info distance-hover-default distance-hover" title="Estimated distance in miles from your location">'+u+"mi</p>";return s}var t='<div class="distance card" title="Estimated (straight line) distance in miles from your location (actual distance via roads will be greater)"><svg class="distance-guide-drive"><use xlink:href="#distance"/></svg><p class="distance-guide-miles">'+u+"mi</p></div>";return t},self.displayCurrentWaterTemp=function(a){var b=getCurrentSeason();switch(b){case"winter":var c=a.winter;break;case"spring":var c=a.spring;break;case"summer":var c=a.summer;break;case"autumn":var c=a.autumn}var d='<p class="rollover-info water-temp-hover-default water-temp-hover" title="Average '+b+' water temperature">'+c+"℉</p>";return d},self.displayWaveSize=function(a){if(a.aboveMax)var b="+";else var b="";if(k)var c='<p class="rollover-info wave-size-hover-default wave-size-hover" title="Average wave size">'+a.min+"-"+a.max+"'</p>";else var c='<div class="wave-size card" title="Average wave size"><svg class="wave-size-guide"><use xlink:href="#wave_range"/></svg><p>'+a.min+"-"+a.max+b+"ft</p></div>";return c},self.getCurrentSeason=function(){var a=new Date,b=a.getMonth();switch(b){case 11:case 0:case 1:var c="winter";break;case 2:case 3:case 4:var c="spring";break;case 5:case 6:case 7:var c="summer";break;case 8:case 9:case 10:var c="autumn"}return c},self.displayHazardIcons=function(a,b){function c(a,b){if(k)var c="misc-info-two-hover hover-icon-frame rollover-info misc-info-two-hover-default hover-tooltip-only",d="hover-icon misc-info-two-hover-svg";else var c="hazard card",d="hazard-guide";switch(a){case"beginners":var e="Hazard: Beginners",f="#hazards_beginners",g=self.setUpIcons(c,e,d,f);break;case"boats":var e="Hazard: Boats",f="#hazards_boats",g=self.setUpIcons(c,e,d,f);break;case"crocs":var e="Hazard: Crocodiles",f="#hazards_crocs",g=self.setUpIcons(c,e,d,f);break;case"crowded":var e="Hazard: Crowded",f="#hazards_crowded",g=self.setUpIcons(c,e,d,f);break;case"dangerous break":var e="Hazard: Dangerous break",f="#hazards_dangerous_break",g=self.setUpIcons(c,e,d,f);break;case"far from shore":var e="Hazard: Far from shore",f="#hazards_far_from_shore",g=self.setUpIcons(c,e,d,f);break;case"pollution":var e="Hazard: Pollution",f="#hazards_pollution",g=self.setUpIcons(c,e,d,f);break;case"rocky bottom":var e="Hazard: Rocky bottom",f="#hazards_rocky_bottom",g=self.setUpIcons(c,e,d,f);break;case"sea snakes":var e="Hazard: Sea snakes",f="#hazards_sea_snakes",g=self.setUpIcons(c,e,d,f);break;case"seals":var e="Hazard: Seals",f="#hazards_seals",g=self.setUpIcons(c,e,d,f);break;case"seaweed":var e="Hazard: Seaweed",f="#hazards_seaweed",g=self.setUpIcons(c,e,d,f);break;case"sewage":var e="Hazard: Sewage",f="#hazards_sewage",g=self.setUpIcons(c,e,d,f);break;case"shallow":var e="Hazard: Shallow break",f="#hazards_shallow",g=self.setUpIcons(c,e,d,f);break;case"sharks":var e="Hazard: Sharks",f="#hazards_sharks",g=self.setUpIcons(c,e,d,f);break;case"strong currents":var e="Hazard: Strong currents",f="#hazards_strong_currents",g=self.setUpIcons(c,e,d,f);break;case"strong rips":var e="Hazard: Strong rips",f="#hazards_strong_rips",g=self.setUpIcons(c,e,d,f);break;case"theft":var e="Hazard: Theft",f="#hazards_theft",g=self.setUpIcons(c,e,d,f);break;case"undertow":var e="Hazard: Strong undertow",f="#hazards_undertow",g=self.setUpIcons(c,e,d,f);break;case"unfriendly":var e="Hazard: Unfriendly",f="#hazards_unfriendly",g=self.setUpIcons(c,e,d,f);break;case"urchins":var e="Hazard: Urchins",f="#hazards_urchins",g=self.setUpIcons(c,e,d,f)}return k?g:void b.append(g)}if(k){var d=0,e=a.length,f=Math.floor(Math.random()*(e-d)+d),g=a[f],h=c(g);return h}for(var i=a.length,j=i;j--;)c(a[j],b)},self.closeSurfGuide=function(){console.log("close surf guide"),console.log("close any open info windows"),infoWindow.close(),self.makeMarkerSmall(),$surfInfoContainer.children(":nth-child(1)").remove(),self.manageView(),$map.is(":hidden")&&self.resetFrames(),$locationGrid.show(),$(".location-frame:visible").css("display","inline-block"),document.body.scrollTop=document.documentElement.scrollTop=0}}var map,infoWindow;navigator.geolocation.getCurrentPosition(success),ko.applyBindings(new AppViewModel);