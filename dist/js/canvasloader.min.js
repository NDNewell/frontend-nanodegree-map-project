!function(a){"use strict";var b,c=function(a,b){"undefined"==typeof b&&(b={}),this.init(a,b)},d=c.prototype,e=["canvas","vml"],f=["oval","spiral","square","rect","roundRect"],g=/^\#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,h=-1!==navigator.appVersion.indexOf("MSIE")&&8===parseFloat(navigator.appVersion.split("MSIE")[1])?!0:!1,i=!!document.createElement("canvas").getContext,j=40,k=!0,l=function(a,b,c){var d,e=document.createElement(a);for(d in c)e[d]=c[d];return"undefined"!=typeof b&&b.appendChild(e),e},m=function(a,b){for(var c in b)a.style[c]=b[c];return a},n=function(a,b){for(var c in b)a.setAttribute(c,b[c]);return a},o=function(a,b,c,d){a.save(),a.translate(b,c),a.rotate(d),a.translate(-b,-c),a.beginPath()};d.init=function(a,d){"boolean"==typeof d.safeVML&&(k=d.safeVML);try{void 0!==document.getElementById(a)?this.mum=document.getElementById(a):this.mum=document.body}catch(f){this.mum=document.body}if(d.id="undefined"!=typeof d.id?d.id:"canvasLoader",this.cont=l("div",this.mum,{id:d.id}),i)b=e[0],this.can=l("canvas",this.cont),this.con=this.can.getContext("2d"),this.cCan=m(l("canvas",this.cont),{display:"none"}),this.cCon=this.cCan.getContext("2d");else{if(b=e[1],"undefined"==typeof c.vmlSheet){document.getElementsByTagName("head")[0].appendChild(l("style")),c.vmlSheet=document.styleSheets[document.styleSheets.length-1];for(var g,h=["group","oval","roundrect","fill"],g=0;g<h.length;++g)c.vmlSheet.addRule(h[g],"behavior:url(#default#VML); position:absolute;")}this.vml=l("group",this.cont)}this.setColor(this.color),this.draw(),m(this.cont,{display:"none"})},d.cont={},d.can={},d.con={},d.cCan={},d.cCon={},d.timer={},d.activeId=0,d.diameter=40,d.setDiameter=function(a){this.diameter=Math.round(Math.abs(a)),this.redraw()},d.getDiameter=function(){return this.diameter},d.cRGB={},d.color="#000000",d.setColor=function(a){this.color=g.test(a)?a:"#000000",this.cRGB=this.getRGB(this.color),this.redraw()},d.getColor=function(){return this.color},d.shape=f[0],d.setShape=function(a){var b;for(b in f)if(a===f[b]){this.shape=a,this.redraw();break}},d.getShape=function(){return this.shape},d.density=40,d.setDensity=function(a){k&&b===e[1]?this.density=Math.round(Math.abs(a))<=j?Math.round(Math.abs(a)):j:this.density=Math.round(Math.abs(a)),this.density>360&&(this.density=360),this.activeId=0,this.redraw()},d.getDensity=function(){return this.density},d.range=1.3,d.setRange=function(a){this.range=Math.abs(a),this.redraw()},d.getRange=function(){return this.range},d.speed=2,d.setSpeed=function(a){this.speed=Math.round(Math.abs(a))},d.getSpeed=function(){return this.speed},d.fps=24,d.setFPS=function(a){this.fps=Math.round(Math.abs(a)),this.reset()},d.getFPS=function(){return this.fps},d.getRGB=function(a){return a="#"===a.charAt(0)?a.substring(1,7):a,{r:parseInt(a.substring(0,2),16),g:parseInt(a.substring(2,4),16),b:parseInt(a.substring(4,6),16)}},d.draw=function(){var a,c,d,g,i,j,k,p,q,r,s,t,u,v=0,w=this.density,x=Math.round(w*this.range),y=0,z=1e3,A=0,B=this.cCon,C=this.diameter,D=.47;if(b===e[0])for(B.clearRect(0,0,z,z),n(this.can,{width:C,height:C}),n(this.cCan,{width:C,height:C});w>v;){switch(q=x>=v?1-(1-y)/x*v:q=y,j=270-360/w*v,k=j/180*Math.PI,B.fillStyle="rgba("+this.cRGB.r+","+this.cRGB.g+","+this.cRGB.b+","+q.toString()+")",this.shape){case f[0]:case f[1]:a=.07*C,g=C*D+Math.cos(k)*(C*D-a)-C*D,i=C*D+Math.sin(k)*(C*D-a)-C*D,B.beginPath(),this.shape===f[1]?B.arc(.5*C+g,.5*C+i,a*q,0,2*Math.PI,!1):B.arc(.5*C+g,.5*C+i,a,0,2*Math.PI,!1);break;case f[2]:a=.12*C,g=Math.cos(k)*(C*D-a)+.5*C,i=Math.sin(k)*(C*D-a)+.5*C,o(B,g,i,k),B.fillRect(g,i-.5*a,a,a);break;case f[3]:case f[4]:c=.3*C,d=.27*c,g=Math.cos(k)*(d+.13*(C-d))+.5*C,i=Math.sin(k)*(d+.13*(C-d))+.5*C,o(B,g,i,k),this.shape===f[3]?B.fillRect(g,i-.5*d,c,d):(p=.55*d,B.moveTo(g+p,i-.5*d),B.lineTo(g+c-p,i-.5*d),B.quadraticCurveTo(g+c,i-.5*d,g+c,i-.5*d+p),B.lineTo(g+c,i-.5*d+d-p),B.quadraticCurveTo(g+c,i-.5*d+d,g+c-p,i-.5*d+d),B.lineTo(g+p,i-.5*d+d),B.quadraticCurveTo(g,i-.5*d+d,g,i-.5*d+d-p),B.lineTo(g,i-.5*d+p),B.quadraticCurveTo(g,i-.5*d,g+p,i-.5*d))}B.closePath(),B.fill(),B.restore(),++v}else{switch(m(this.cont,{width:C,height:C}),m(this.vml,{width:C,height:C}),this.shape){case f[0]:case f[1]:t="oval",a=.14*z;break;case f[2]:t="roundrect",a=.12*z;break;case f[3]:case f[4]:t="roundrect",a=.3*z}for(c=d=a,g=.5*z-d,i=.5*-d;w>v;){switch(q=x>=v?1-(1-y)/x*v:q=y,j=270-360/w*v,this.shape){case f[1]:c=d=a*q,g=.5*z-.5*a-a*q*.5,i=.5*(a-a*q);break;case f[0]:case f[2]:h&&(i=0,this.shape===f[2]&&(g=.5*z-.5*d));break;case f[3]:case f[4]:c=.95*a,d=.28*c,h?(g=0,i=.5*z-.5*d):(g=.5*z-c,i=.5*-d),A=this.shape===f[4]?.6:0}s=n(m(l("group",this.vml),{width:z,height:z,rotation:j}),{coordsize:z+","+z,coordorigin:.5*-z+","+.5*-z}),r=m(l(t,s,{stroked:!1,arcSize:A}),{width:c,height:d,top:i,left:g}),u=l("fill",r,{color:this.color,opacity:q}),++v}}this.tick(!0)},d.clean=function(){if(b===e[0])this.con.clearRect(0,0,1e3,1e3);else{var a=this.vml;if(a.hasChildNodes())for(;a.childNodes.length>=1;)a.removeChild(a.firstChild)}},d.redraw=function(){this.clean(),this.draw()},d.reset=function(){"number"==typeof this.timer&&(this.hide(),this.show())},d.tick=function(a){var c=this.con,d=this.diameter;a||(this.activeId+=360/this.density*this.speed),b===e[0]?(c.clearRect(0,0,d,d),o(c,.5*d,.5*d,this.activeId/180*Math.PI),c.drawImage(this.cCan,0,0,d,d),c.restore()):(this.activeId>=360&&(this.activeId-=360),m(this.vml,{rotation:this.activeId}))},d.show=function(){if("number"!=typeof this.timer){var a=this;this.timer=self.setInterval(function(){a.tick()},Math.round(1e3/this.fps)),m(this.cont,{display:"block"})}},d.hide=function(){"number"==typeof this.timer&&(clearInterval(this.timer),delete this.timer,m(this.cont,{display:"none"}))},d.kill=function(){var a=this.cont;"number"==typeof this.timer&&this.hide(),b===e[0]?(a.removeChild(this.can),a.removeChild(this.cCan)):a.removeChild(this.vml);var c;for(c in this)delete this[c]},a.CanvasLoader=c}(window);