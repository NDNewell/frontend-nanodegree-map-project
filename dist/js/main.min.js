function initMap(){var a=[{featureType:"administrative",elementType:"all",stylers:[{color:"#525252"},{visibility:"off"}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"all",stylers:[{visibility:"simplified"},{color:"#525252"}]},{featureType:"landscape",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{visibility:"simplified"},{color:"#525252"}]},{featureType:"poi",elementType:"all",stylers:[{color:"#525252"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"road.local",elementType:"geometry",stylers:[{visibility:"simplified"}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:50},{color:"#e8e7e7"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.line",elementType:"all",stylers:[{visibility:"simplified"},{color:"#e8e7e7"}]},{featureType:"transit.station.airport",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#56c4d1"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]}],b=new google.maps.StyledMapType(a,{name:"Map"});map=new google.maps.Map(document.getElementById("map"),{mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,mapTypeIds:["custom_style",google.maps.MapTypeId.SATELLITE]},disableDefaultUI:!0,zoomControl:!0,rotateControl:!0,streetViewControl:!0,mapTypeControl:!0,scrollwheel:!1,scaleControl:!0}),map.setTilt(45),map.mapTypes.set("custom_style",b),map.setMapTypeId("custom_style"),markerIcon={small:{url:spriteSheet,size:new google.maps.Size(19,19),origin:new google.maps.Point(6,35),anchor:new google.maps.Point(9.5,9.5)},selected:{url:spriteSheet,size:new google.maps.Size(41,52),origin:new google.maps.Point(4,120),anchor:new google.maps.Point(20.5,52)},smallFav:{url:spriteSheet,size:new google.maps.Size(23,21),origin:new google.maps.Point(4,4),anchor:new google.maps.Point(11.5,10.5)},selectedFav:{url:spriteSheet,size:new google.maps.Size(41,52),origin:new google.maps.Point(4,181),anchor:new google.maps.Point(20.5,52)}},infoWindow=new google.maps.InfoWindow}function success(a){console.log("get user's location"),currentLat=a.coords.latitude,currentLng=a.coords.longitude}function AppViewModel(){this.self=this;var a=$(document),b=$(window),c=$("body"),d=$(".map-section"),e=$(".map-container"),f=$("#map"),g=$(".search-symbol"),h=$(".map-symbol"),i=$(".favorite-filter-symbol"),j=$(".location-grid"),k=$(".search-container"),l=$(".search-form"),m=$(".clear"),n=$(".filters-container"),o=$(".clear-favorites-button"),p=$(".surf-info-container"),q={apiKey:"AIzaSyCfguLjpbIGbhNbGs0ZlA-w_wERpasWWRw",authDomain:"dazzling-torch-4012.firebaseapp.com",databaseURL:"https://dazzling-torch-4012.firebaseio.com",storageBucket:"dazzling-torch-4012.appspot.com"};firebase.initializeApp(q);var r=firebase.database(),s=function(a){a?console.log("data could not be saved."+a):console.log("data saved successfully.")},t=function(a){console.log("the read failed: "+a.code)},u=function(a){console.log("get location data unsuccessful"),k.hide(),$(".search-section").hide(),d.hide(),$(".surf-info-section").hide(),$(".list-section").hide();var b='<section class="error-section"><div class="row"><div class="col-xs-12 data-load-error-container"><svg class="no-connection"><use xlink:href="#no_connection"/></svg><p>Dude! Really?! =(</p></div></div></section>',c='<button type="button" class="btn reload-button">Reload</button>';$("header").after(b),$(".data-load-error-container").append(c),$(".reload-button").on("click",function(a){location=location}),t(a)};r.ref("locationData").on("value",function(a){function b(){console.log("Google maps api loaded"),console.log("generate map markers"),self.generateMarkers(c),self.addMapListeners()}var c=a.val();if(console.log("get location data successful"),self.parseLocationData(c),"object"==typeof google&&"object"==typeof google.maps)b();else var d=setInterval(function(){"object"==typeof google&&"object"==typeof google.maps&&(b(),clearInterval(d))},500)},u),self.locationArray=[],self.onLocationsArrayLoad=function(a){if(locationArray.length>0)a();else var b=setInterval(function(){locationArray.length>0&&(clearInterval(b),a())},250)},self.locationGrid=ko.observableArray(""),self.searchKeywords=[],self.parseLocationData=function(a){console.log("parse location data"),self.locationArray=[],self.locationGrid.removeAll(),self.searchKeywords=[],a.forEach(function(a){self.locationArray.push(a),self.locationGrid.push(a),self.searchKeywords.push(a.breakName),searchKeywords.indexOf(a.location)<0&&self.searchKeywords.push(a.location)})};var v=[],w=!0;self.getFavorites=function(a){null===a?console.log("cannot find favorites because there are no logged in users"):r.ref("users").child(a.uid).child("favorites").on("value",function(a){function b(){self.updateFavsOnFrames(),self.updateFavMarkers(d)}function c(){function a(){self.showLocationFrames(d)}w&&(w=!1,self.onLocationsArrayLoad(a))}var d=a.val();v=[],null===d?(console.log("user has no favorites"),d=[],b(),c()):(d.forEach(function(a){v.push(a)}),b(),c())},t)},self.addFavorite=function(a){v.push(a),A?r.ref("users").child(firebase.auth().currentUser.uid).update({favorites:v},s):(self.updateFavsOnFrames(),self.updateFavMarkers(v))},self.removeFavorite=function(a){var b=[];v.forEach(function(c){a!==c&&b.push(c)}),A?r.ref("users").child(firebase.auth().currentUser.uid).update({favorites:b},s):(v=b,self.updateFavsOnFrames(),self.updateFavMarkers(v))},self.removeAllFavorites=function(){v=[],self.updateFavsOnFrames(),A?r.ref("users").child(firebase.auth().currentUser.uid).update({favorites:v},s):self.updateFavMarkers(v)},self.checkLocalStorage=function(){try{return window.localStorage.test="test",window.localStorage.removeItem("test"),!0}catch(a){return console.log("local storage disabled ("+a+")"),!1}};var x=self.checkLocalStorage();b.load(function(){function a(){var a=setTimeout(function(){console.log("get external svg sprite sheet failed")},5e3);$.ajax({url:"img/svg/svg_sprites_v1.svg",dataType:"html",success:function(c){clearTimeout(a),console.log("get external svg sprite sheet from server"),b(c),x&&d(c)}})}function b(a){c.prepend(a).children(":nth-child(1)").hide()}function d(a){console.log("save external svg sprite sheet to local storage"),e.inlineSVGdata=a,e.svgVersion=g}if(x){var e=window.localStorage,f=e.getItem("svgVersion"),g=1;if(f==g){console.log("get external svg sprite sheet from local storage");var h=e.inlineSVGdata;b(h)}else(f!==g||null===f)&&a()}else a()}),a.on("keydown",function(a){8!==a.which||$(a.target).is("input, textarea")||a.preventDefault()});var y=[];self.generateMarkers=function(a){for(var b=a.length,c=b;c--;){var d=a[c],e={lat:d.lat,lng:d.lng},g=d.breakName,h=d.location;self.addMarker(g,e,h,d)}self.displayMarkers(map),f.is(":visible")&&self.setMapBounds()},self.addMarker=function(a,b,c,d){var e=new google.maps.Marker({position:b,map:map,icon:markerIcon.small,title:a+" ("+c+")"});self.addMarkerListeners(e,d)},self.addMarkerListeners=function(a,b){google.maps.event.addListener(a,"dblclick",function(b){return function(){map.setCenter(a.getPosition()),map.getZoom()<14&&map.setZoom(14)}}(a)),google.maps.event.addListener(a,"click",function(c){return function(){self.makeMarkerSmall(),self.makeMarkerBig(a),self.getInfoWindow(a),self.animateMarker(a),N?self.renderSurfGuide(b):self.focusOnFrame(a)}}(a,b)),google.maps.event.addListener(a,"mouseover",function(b){return function(){self.removeTitle();var b=$(".location-frame:visible").length;N||K||(self.pulseFrame(a),1!==b&&self.scrollToFrame(a))}}()),google.maps.event.addListener(a,"mouseout",function(b){return function(){N||K||self.pulseFrame(a)}}()),y.push(a),C.push(a.title)},self.displayMarkers=function(a){for(var b=y.length,c=b;c--;)y[c].setMap(a)},self.getMarkerName=function(a){var b=a.title.replace(/ *\([^)]*\) */g,"");return b},self.animateMarker=function(a){a.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(function(){a.setAnimation(null)},730)},self.makeMarkerBig=function(a){var b=getMarkerName(a),c=a.icon.origin;c===markerIcon.small.origin?(console.log("make "+b+"'s marker big"),a.setIcon(markerIcon.selected)):c===markerIcon.smallFav.origin&&(console.log("make "+b+"'s marker big"),a.setIcon(markerIcon.selectedFav))},self.makeMarkerSmall=function(){y.forEach(function(a){var b=getMarkerName(a),c=a.icon.origin;c===markerIcon.selected.origin?(console.log("make "+b+"'s marker small"),a.setIcon(markerIcon.small)):c===markerIcon.selectedFav.origin&&(console.log("make "+b+"'s marker small"),a.setIcon(markerIcon.smallFav))})},self.getGuideMarker=function(){for(var a=$("#guide-break-name").text(),b=y.length,c=b;c--;){var d=y[c],e=getMarkerName(d);if(a===e)return d}},self.activateMarker=function(a){y.forEach(function(b){var c=getMarkerName(b);c===a&&self.makeMarkerBig(b)})},self.resetMarkers=function(){console.log("reset markers");for(var a=y.length,b=a;b--;){var c=y[b];self.filterMarkers(c)}},self.updateFavMarkers=function(a){function b(){console.log("update marker favorites"),y.forEach(function(b){var c=getMarkerName(b),d=b.icon.origin;a.indexOf(c)>-1?d===markerIcon.small.origin?b.setIcon(markerIcon.smallFav):d===markerIcon.selected.origin&&b.setIcon(markerIcon.selectedFav):d===markerIcon.smallFav.origin?b.setIcon(markerIcon.small):d===markerIcon.selectedFav.origin&&b.setIcon(markerIcon.selected)})}var c=0;if(r.ref("locationData").on("value",function(a){var b=a.val();b.forEach(function(a){c++})}),c===y.length&&y.length>0)b();else var d=setInterval(function(){c===y.length&&y.length>0&&(clearInterval(d),b())},250)},self.checkVisibleMarkers=function(){var a=y.length;numMarkersVisible=0;for(var b=a;b--;){var c=y[b];c.getVisible()&&numMarkersVisible++}numMarkersVisible<1?$(".reset-map-container").length||N||(console.log("no markers visible"),self.repositionMap()):$(".reset-map-container").length&&$(".reset-map-container").remove()},self.filterMarkers=function(a){var b=getMarkerName(a);if(k.is(":visible")){var c=self.formatText(self.Query());b=self.formatText(a.title),b.indexOf(c)>-1&&a.setVisible(!0)}else $(".favorite-filter-selected").length?v.indexOf(b)>-1&&a.setVisible(!0):a.setVisible(!0)},self.manageMarkers=function(){console.log("manage markers");for(var a=y.length,b=a;b--;){var c=y[b],d=c.icon.origin;map.getBounds().contains(c.getPosition())?self.filterMarkers(c):d===markerIcon.selected.origin||d===markerIcon.selectedFav.origin?c.setVisible(!0):c.setVisible(!1)}self.checkVisibleMarkers()},self.showLocationFrames=function(a){function b(){console.log("show locations"),c.show(),self.addHoverEffects()}F.is(":visible")&&F.remove();var c=$(".location-frame");if("undefined"!=typeof a)if(null===a)b();else if(a.length===$(".is-a-favorite").length)b();else var d=setInterval(function(){a.length===$(".is-a-favorite").length&&(clearInterval(d),b())},250);else b()},self.updateFavsOnFrames=function(){console.log("the user's favorite(s) is/are: "+v.join(", ")),console.log("update location frame favorites");var a=$(".location-frame");a.each(function(){var a=$(this),b=a.children(":nth-child(3)"),c=a.children(":nth-child(2)").text();v.indexOf(c)>-1?b.removeClass("not-a-favorite").addClass("is-a-favorite"):b.hasClass("is-a-favorite")&&b.addClass("not-a-favorite").removeClass("is-a-favorite")})},self.clickLocationFrame=function(a){if(z=!1,self.renderSurfGuide(a),k.is(":visible")&&(k.hide(),g.removeClass("search-selected").addClass("search-default")),$(".favorite-filter-selected").length&&n.toggle(),j.hide(),e.is(":visible")){var b=self.getGuideMarker();self.animateMarker(b)}self.manageView()},self.scrollToFrame=function(a){function b(){r+=q,p>r?(e.scrollLeft(r),animateRight=requestAnimationFrame(b)):d()}function c(){s-=q,s>p?(e.scrollLeft(s),animateLeft=requestAnimationFrame(c)):d()}function d(){e.scrollLeft(p),console.log("stop auto scroll"),console.log("scroll position at: "+e.scrollLeft())}var e=j,f=$(".location-frame"),g=$(".pulse-frame"),h=e.scrollLeft(),i=getMarkerName(a),k=e.width(),l=f.outerWidth(!0),m=(k-l)/2,n=g.siblings(":visible").addBack().index(g),o=l*n,p=o-m;console.log("auto scroll to "+i+"'s location frame"),console.log("move scroll position from "+h+" to "+p);var q=200;if(p>h){var r=h;animateRight=requestAnimationFrame(b),b()}else{var s=h;animateLeft=requestAnimationFrame(c),c()}},self.pulseFrame=function(a){function b(a){console.log("make "+g+"'s location frame big"),a.removeClass("pulse-frame-reverse").addClass("pulse-frame")}function c(a){console.log("make "+g+"'s location frame small"),a.removeClass("pulse-frame").addClass("pulse-frame-reverse"),d(a)}function d(a){setTimeout(function(){a.removeClass("pulse-frame-reverse")},400)}var e=$(".location-frame"),f=$(".location-frame:visible").length,g=getMarkerName(a);if(f>1)e.each(function(){var a=$(this),d=a.children(":nth-child(2)").text();d===g&&($(".pulse-frame").length?c(a):b(a))});else if(1===f&&$(".pulse-frame").length){var h=$(".location-frame:visible"),i=h[0].children[1].textContent;console.log("make "+i+"'s location frame small"),h.removeClass("pulse-frame").addClass("pulse-frame-reverse"),d(h)}},self.adjustFrameStyle=function(){var a=$(".location-frame"),b=$(".location-name"),c=$(".break-name"),d=$(".favorite");a.addClass("location-frame-map").removeClass("location-frame-default"),a.each(function(){var a=$(this);a.is(":visible")&&a.css("display","inline-block")}),a.removeClass("col-xs-12 col-sm-6 col-md-4"),c.removeClass("break-name-default").addClass("break-name-map"),b.removeClass("location-name-default").addClass("location-name-map"),d.attr("class","favorite favorite-map")},self.resetFrames=function(){console.log("reset location frames");var a=y.length,b=$(".location-frame");b.hide();for(var c=a;c--;){var d=y[c];self.filterFrames(d)}},self.focusOnFrame=function(a){var b=getMarkerName(a),c=$(".location-frame");c.hide(),c.each(function(){var a=$(this),c=a.children(":nth-child(2)").text();c===b&&(console.log("show only "+b+"'s location frame"),a.show())})},self.filterFrames=function(a){function b(a){var b=$(".location-frame");b.each(function(){var b=$(this),c=b.children(":nth-child(2)").text();c===a&&b.show()})}var c=getMarkerName(a);if(k.is(":visible")){var d=self.formatText(self.Query()),e=self.formatText(a.title);e.indexOf(d)>-1&&b(c)}else $(".favorite-filter-selected").length?v.indexOf(c)>-1&&b(c):b(c)},self.manageFrames=function(){for(var a=y.length,b=markerIcon.selected.origin,c=markerIcon.selectedFav.origin,d=a;d--;){var e=y[d].icon.origin;if(e===b||e===c)return}console.log("manage location frames");var f=$(".location-frame");f.hide();for(var g=a;g--;){var h=y[g];map.getBounds().contains(h.getPosition())&&self.filterFrames(h)}},self.addMapListeners=function(){google.maps.event.addListener(map,"idle",function(){!f.is(":visible")||P||N||(self.manageFrames(),self.manageMarkers())}),google.maps.event.addListener(map,"click",function(){self.makeMarkerSmall(),infoWindow.close(),N||(self.manageMarkers(),self.manageFrames())})},self.addMapZoomListener=function(){var a=setInterval(function(){var b=$(".gm-style").children(":nth-child(8)").children(":nth-child(1)");b.length?(console.log("zoom listener loaded"),clearInterval(a),"undefined"!=typeof zoomListener&&b.off("click",zoomListener),b.on("click",function(){if(!N)for(var a=y.length,b=markerIcon.selectedFav.origin,c=markerIcon.selected.origin,d=a;d--;){var e=y[d],f=e.icon.origin;(f===b||f===c)&&self.centerOnMarker(e)}})):console.log("zoom listener not loaded")},1e3)},self.repositionMap=function(){function a(){console.log("reposition map"),c.remove();y.length;self.resetMarkers(),self.setMapBounds()}var b='<div class="reset-map-container"></div>';j.append(b);var c=$(".reset-map-container"),d='<svg class="reset-button" alt="reload location frames and markers button"><use xlink:href="#reset_button"/></svg>';c.append(d),$resetButton=$(".reset-button"),$resetButton.on("click",function(){a()})},self.setMarkerForGuide=function(){var a=self.getGuideMarker();if(self.makeMarkerBig(a),isInfoWindowOpen(infoWindow))self.centerOnMarker(a),map.setZoom(10);else{self.getInfoWindow(a);setTimeout(function(){self.centerOnMarker(a),map.setZoom(10)},150)}},self.centerOnMarker=function(a){var b=self.getMarkerName(a);console.log("resize map"),google.maps.event.trigger(map,"resize"),console.log("center map over "+b),map.setCenter(a.getPosition())},self.setMapBounds=function(){console.log("set map bounds");for(var a=new google.maps.LatLngBounds,b=y.length,c=b;c--;)y[c].visible&&a.extend(y[c].getPosition());map.fitBounds(a),map.getZoom()>12&&map.setZoom(12)},self.adjustMapSize=function(){var a=j.outerHeight(),c=$("#myNavbar").outerHeight(),d=b.height(),g=d-(a+c);e.css("height",g),0!==y.length&&f.is(":visible")&&!P&&(google.maps.event.trigger(map,"resize"),self.setMapBounds())},self.getInfoWindow=function(a){var b=getMarkerName(a);console.log("show "+b+"'s info window");var c='<div class="info-window"><p>'+b+"</p><div>";infoWindow.setContent(c),infoWindow.open(map,a);var d=$(".gm-style-iw");$iwFrame=d.parent(),$iwContainer=d.parent().parent(),$iwFrame.children(":nth-child(1)").children(":nth-child(3)").css("display","none"),$iwFrame.children(":nth-child(1)").children(":nth-child(1)").css("display","none"),$iwFrame.children(":nth-child(1)").children(":nth-child(4)").css("display","none"),$iwFrame.children(":nth-child(1)").children(":nth-child(2)").css("display","none"),$iwFrame.children(":nth-child(3)").css("display","none"),$iwContainer.css("pointer-events","none"),$iwContainer.on("mousemove",function(a){$(this).next().trigger(a)}),$iwContainer.css({left:"11px",top:"42px"})},self.isInfoWindowOpen=function(a){var b=a.getMap();return null!==b&&"undefined"!=typeof b},self.toggleHoverClasses=function(){var a=$(".skill-level-hover"),b=$(".break-type-hover"),c=$(".wave-direction-hover"),d=$(".best-season-hover"),e=$(".misc-info-one-hover"),f=$(".misc-info-two-hover"),g=$(".distance-hover"),h=$(".water-temp-hover"),i=$(".wave-size-hover"),j=$(".cost-hover");z?(a.removeClass("skill-level-hover-default").addClass("skill-level-hover-map"),b.removeClass("break-type-hover-default").addClass("break-type-hover-map"),c.removeClass("wave-direction-hover-default").addClass("wave-direction-hover-map"),d.removeClass("best-season-hover-default").addClass("best-season-hover-map"),e.removeClass("misc-info-one-hover-default").addClass("misc-info-one-hover-map"),f.removeClass("misc-info-two-hover-default").addClass("misc-info-two-hover-map"),g.removeClass("distance-hover-default").addClass("distance-hover-map"),h.removeClass("water-temp-hover-default").addClass("water-temp-hover-map"),i.removeClass("wave-size-hover-default").addClass("wave-size-hover-map"),j.removeClass("cost-hover-default").addClass("cost-hover-map")):(console.log("revert hover icons and info back to default style"),a.removeClass("skill-level-hover-map").addClass("skill-level-hover-default"),b.removeClass("break-type-hover-map").addClass("break-type-hover-default"),c.removeClass("wave-direction-hover-map").addClass("wave-direction-hover-default"),d.removeClass("best-season-hover-map").addClass("best-season-hover-default"),e.removeClass("misc-info-one-hover-map").addClass("misc-info-one-hover-default"),f.removeClass("misc-info-two-hover-map").addClass("misc-info-two-hover-default"),g.removeClass("distance-hover-map").addClass("distance-hover-default"),h.removeClass("water-temp-hover-map").addClass("water-temp-hover-default"),i.removeClass("wave-size-hover-map").addClass("wave-size-hover-default"),j.removeClass("cost-hover-map").addClass("cost-hover-default"))};var z;self.addHoverEffects=function(){console.log("enable hover effect"),$(".location-frame").each(function(){var a=$(this),b=$(this).children(":nth-child(1)").children(":nth-child(1)"),c=$(this).children(":nth-child(2)"),d=$(this).children(":nth-child(3)").children(":nth-child(1)"),e=$(this).children(":nth-child(4)");a.on("mouseenter",function(f){function g(f){b.css({"-webkit-filter":"blur(4px) brightness(80%)",filter:"blur(4px) brightness(80%)"}),e.hide(),c.hide(),d.hide();var g=displaySkillIcon(f.skillLevel);a.append(g);var h=displayBreakIcon(f.breakDetails);a.append(h);var i=displayDirectionIcon(f.waveDirection);a.append(i);var j=displayBestSeasonIcon(f.optimalTime);a.append(j);var k=displayBigWaveIcon(f);a.append(k);var l=displayWellKnownIcon(f);a.append(l);var m=displayCost(f.cost);if(a.append(m),"undefined"!=typeof currentLat){var n=displayDistance(f.lat,f.lng);a.append(n)}var o=displayCurrentWaterTemp(f.avgWaterTemp);a.append(o);var p=displayWaveSize(f.avgSize);a.append(p)}z=!0;var h=f.currentTarget.children[1].textContent;console.log("hover over "+h),L&&activateMarker(h),self.locationArray.forEach(function(a){h===a.breakName&&g(a)}),K||M||self.toggleHoverClasses(),console.log("add hover tooltips"),self.addToolTips()}),a.on("mouseleave",function(){z=!1;var a=$(".rollover-info");a.removeClass("tooltip-loaded"),L&&self.toggleHoverClasses(),b.css({"-webkit-filter":"blur(0px) brightness(100%)",filter:"blur(0px) brightness(100%)"}),e.show(),c.show(),d.show(),N||self.isInfoWindowOpen(infoWindow)||M||self.makeMarkerSmall(),a.remove()})})},self.showUser=function(){var a=allData.getAuth();console.log(a.uid+" is currently logged in")};var A=!1;self.userLogin=function(){firebase.auth().signInAnonymously()["catch"](function(a){if(a)console.log("login Failed!",a);else{r.ref("users").child(user.uid).set({favorites:[]}),A=!0;setInterval(self.showUser,6e4)}})},firebase.auth().onAuthStateChanged(function(a){if(x)if(a){console.log("user "+a.uid+" is logged in"),self.getFavorites(a);setInterval(self.showUser,6e4);A=!0}else console.log("user is logged out"),self.userLogin();else console.log("Firebase log in disabled because local storage unavailable"),self.onLocationsArrayLoad(self.showLocationFrames)}),self.addToolTips=function(){function a(a,d,e){var f='<p class="tooltip-info">'+a+"</p>",g=20,h=d.pageX,i=d.pageY+g;c.append(f);var j=$(".tooltip-info");j.offset({top:i,left:h});var k=window.innerWidth,l=k-20,m=j.offset().left,n=j.outerWidth(),o=m+n;if(o>=l&&(j.outerWidth(220),m=j.offset().left,n=j.outerWidth(),o=m+n),o>=k){var p=-20,q=o-k,r=h-q+p;j.offset({top:i,left:r})}b=setTimeout(function(){j.fadeOut(500,function(){console.log("hide tooltip"),j.remove()})},2e3),e.on("mousemove",function(){e.off("mousemove"),clearTimeout(b);var a;a=e.hasClass("hover-tooltip-only")?0:500,j.fadeOut(a,function(){console.log("hide tooltip"),j.remove()})})}var b,d,e,f=$("[title]");f.each(function(){var c=$(this);if(!c.hasClass("tooltip-loaded")){var f=c.attr("title");c.addClass("tooltip-loaded"),c.on("click mouseover mouseleave",function(g){switch($(".tooltip-info").length&&(console.log("hide tooltip"),clearInterval(b),$(".tooltip-info").remove()),clearTimeout(d),c.off("mousemove"),g.type){case"mouseover":c.removeAttr("title"),c.on("mousemove",function(a){e=a});var h;h=c.hasClass("hover-tooltip-only")?3e3:2e3,d=setTimeout(function(){console.log("show tooltip"),c.off("mousemove"),a(f,e,c)},h);break;case"mouseleave":c.attr("title",f);break;case"click":c.hasClass("hover-tooltip-only")||(console.log("show tooltip"),c.removeAttr("title"),a(f,g,c))}})}})};var B=["Report errors in the road map or imagery to Google","Zoom in","Zoom out","Rotate map 90 degrees","Show satellite imagery","Change map style"],C=[];self.removeTitle=function(){$("[title]").each(function(){var a=$(this);B.indexOf(a.attr("title"))>-1?a.removeAttr("title"):C.indexOf(a.attr("title"))>-1&&(console.log("disable native marker tooltip"),a.removeAttr("title"))})},self.removeGoogleElemTitles=function(){var a=B.length,b=0,c=setInterval(function(){$("[title]").each(function(){var d=$(this);B.indexOf(d.attr("title"))>-1&&(b++,b===a&&(clearInterval(c),console.log("disable Google tooltips"),self.removeTitle()))})},500)};var D=$("#navbar-main"),E=D.offset().top;b.scroll(function(){b.scrollTop()>E?(D.addClass("navbar-fixed-top"),c.css("padding-top","50px")):(D.removeClass("navbar-fixed-top"),c.css("padding-top","0px"))}),self.canvasLoader=function(a,b,c,d,e,f){var g=new CanvasLoader(a);return g.setColor("#35ABBB"),g.setShape(b),g.setDiameter(c),g.setDensity(d),g.setRange(e),g.setFPS(f),g.show(),g},$("header").append('<div id="pageLoader"></div>');var F=$("#pageLoader");self.canvasLoader("pageLoader","square",117,72,1.1,60);if("ontouchstart"in document.documentElement){console.log("device supports touch events");for(var G=document.styleSheets.length-1;G>=0;G--){var H=document.styleSheets[G];if(H.cssRules)for(var I=H.cssRules.length-1;I>=0;I--){var J=H.cssRules[I];J.selectorText&&(J.selectorText=J.selectorText.replace(":hover",":active"))}}}self.enableHorizontalScrolling=function(){j.off(),j.mousewheel(function(a,b){this.scrollLeft-=1*b,a.preventDefault()})},self.manageLayout=function(){console.log("manage layout");var a=$(".location-frame"),b=$("#container"),c=$(".favorite"),d=$(".break-name"),g=$(".location-name");K||M||N?(e.removeClass("map-container-map").addClass("map-container-default"),e.css("height","245px"),$(".map-selected").length&&e.show(),k.removeClass("search-container-map").addClass("search-container-default"),l.removeClass("search-form-map").addClass("search-form-default"),m.removeClass("clear-map").addClass("clear-default"),o.removeClass("clear-favorites-button-map").addClass("clear-favorites-button-default"),j.removeClass("location-grid-map"),a.removeClass("location-frame-map").addClass("location-frame-default"),b.removeClass("container-fluid").addClass("container"),j.removeClass("row-fluid").addClass("row"),a.addClass("col-xs-12 col-sm-6 col-md-4"),d.removeClass("break-name-map").addClass("break-name-default"),g.removeClass("location-name-map").addClass("location-name-default"),c.attr("class","favorite favorite-default"),j.off(),0===y.length||!f.is(":visible")||N||P?N&&f.is(":visible")&&self.setMarkerForGuide():(console.log("map is visible"),google.maps.event.trigger(map,"resize"),self.setMapBounds())):(console.log("update map view layout"),e.removeClass("map-container-default").addClass("map-container-map"),k.addClass("search-container-map").removeClass("search-container-default"),l.addClass("search-form-map").removeClass("search-form-default"),m.addClass("clear-map").removeClass("clear-default"),o.removeClass("clear-favorites-button-default").addClass("clear-favorites-button-map"),j.addClass("location-grid-map"),b.removeClass("container").addClass("container-fluid"),j.removeClass("row").addClass("row-fluid"),self.onLocationsArrayLoad(self.adjustFrameStyle),self.adjustMapSize(),self.enableHorizontalScrolling())};var K,L,M,N;self.manageView=function(){var a=window.innerWidth;$(".surf-guide-container").length&&768>a?(L=!1,M=!1,K=!0,N=!0,console.log("view is surf guide/mobile")):$(".surf-guide-container").length&&a>=768?(L=!1,M=!1,K=!1,N=!0,console.log("view is surf guide")):768>a?(L=!1,M=!1,N=!1,K=!0,console.log("view is mobile")):(K=!1,N=!1,$(".map-selected").length?(M=!1,L=!0,console.log("view is map")):(L=!1,M=!0,console.log("view is grid"))),self.manageLayout()},self.manageView();var O,P;if(b.resize(function(){self.manageView(),console.log("resize window"),f.is(":visible")&&!N&&(P=!0,console.log("disable frame and marker managers"),clearTimeout(O),O=setTimeout(function(){f.is(":visible")&&!N&&(google.maps.event.trigger(map,"resize"),self.setMapBounds()),P=!1,console.log("enable frame and marker managers")},100))}),self.formatText=function(a){var b=a.toLowerCase().replace(/ /g,"").replace(/'/g,"").replace(/,/g,"");return b},self.Query=ko.observable(""),self.searchLocations=function(){var a=self.formatText(self.Query()),b=$(".location-frame");b.hide(),b.each(function(){var b=$(this),c=self.formatText(b.text());c.indexOf(a)>-1&&b.show()}),y.forEach(function(b){self.formatText(b.title).indexOf(a)>-1?b.setVisible(!0):b.setVisible(!1)}),f.is(":visible")&&self.setMapBounds(),e.is(":visible")&&self.manageLayout()},self.loadAutoComplete=function(){var a=!0;l.autocomplete({source:self.searchKeywords,autoFocus:!0,minLength:2,delay:0,select:function(b,c){console.log("select suggested location"),a=!1,self.Query(c.item.value),self.searchLocations(),$(this).blur(),a=!0}}),l.on("keydown",function(b){13===b.keyCode&&a&&$(this).blur()})},self.searchKeywords.length>1)self.loadAutoComplete();else var Q=setInterval(function(){self.searchKeywords.length>1&&(clearInterval(Q),self.loadAutoComplete())},500);self.toggleSearch=function(){console.log("toggle search"),self.resetPage(),L?k.is(":hidden")?k.fadeIn(200):(k.fadeOut(200),m.hide()):N?k.show():k.is(":hidden")?k.slideDown(200):(k.slideUp(200),m.hide()),$(".search-default").length?(setTimeout(function(){l.focus()},300),g.removeClass("search-default").addClass("search-selected")):g.removeClass("search-selected").addClass("search-default")},g.on("click",function(){$(".favorite-filter-selected").length&&(n.slideUp(200),console.log("hide filters container and favorites"),i.removeClass("favorite-filter-selected").addClass("favorite-filter-default")),b.scrollTop()<56||b.scrollTop()>=56&&k.is(":hidden")?(document.body.scrollTop=document.documentElement.scrollTop=0,self.toggleSearch()):l.focus()}),l.on("keydown",function(){m.show()}).on("blur",function(){l.val()||m.hide()}),m.on("click",function(){self.resetPage(),m.hide(),l.focus()}),self.filterFavorites=function(){if(f.is(":hidden")){var a=$(".location-frame");a.hide(),a.each(function(){var a=$(this),b=a.children(":nth-child(2)").text();v.indexOf(b)>-1&&a.show()})}infoWindow.close(),self.makeMarkerSmall(),y.forEach(function(a){var b=getMarkerName(a);v.indexOf(b)>-1?a.setVisible(!0):a.setVisible(!1)}),console.log("update map with favorites"),f.is(":visible")&&self.setMapBounds()},i.on("click",function(){if($(".favorite-filter-selected").length)console.log("show all locations"),$(".map-container-map").length?n.fadeOut(200):n.slideUp(200),i.removeClass("favorite-filter-selected").addClass("favorite-filter-default"),self.resetPage();else{if($(".favorite-filter-selected").length||!(v.length>0))return void console.log("user has no favorites");if(console.log("show favorites only"),k.is(":visible")&&self.toggleSearch(),N&&self.closeSurfGuide(),i.removeClass("favorite-filter-default").addClass("favorite-filter-selected"),f.is(":visible")&&k.is(":visible")){setTimeout(function(){self.filterFavorites(),self.manageLayout()},300)}else self.filterFavorites(),self.manageLayout();f.is(":visible")?n.fadeIn(200):n.slideDown(200)}$(".map-container-map").length||(document.body.scrollTop=document.documentElement.scrollTop=0)}),o.on("click",function(){$(".map-container-map").length?n.fadeOut(200):n.slideUp(200),i.removeClass("favorite-filter-selected").addClass("favorite-filter-default"),self.removeAllFavorites(),self.resetPage()}),h.on("click",function(a){F.is(":visible")&&F.remove();var c=b.scrollTop(),g=d.height();$(".location-frame"),$(".location-frame:visible").length;L?(h.toggleClass("map-default map-selected"),f.hide(),self.manageView(),e.show(),self.resetFrames(),self.resetMarkers(),e.slideToggle(200,function(){console.log("close map"),console.log("close any open info windows"),infoWindow.close(),self.makeMarkerSmall()})):M?(document.body.scrollTop=document.documentElement.scrollTop=0,h.toggleClass("map-default map-selected"),f.is(":hidden")&&f.show(),self.manageView(),console.log("open map"),self.removeGoogleElemTitles(),self.addMapZoomListener(),e.fadeIn(1e3),console.log("resize map"),google.maps.event.trigger(map,"resize"),self.setMapBounds()):N&&!K?(document.body.scrollTop=document.documentElement.scrollTop=0,h.toggleClass("map-default map-selected"),f.is(":hidden")&&f.show(),e.slideToggle(200,function(){f.is(":visible")?(console.log("open map"),self.removeGoogleElemTitles(),self.addMapZoomListener(),self.setMarkerForGuide()):console.log("close map")})):K&&g>c||c>=g&&e.is(":hidden")?(document.body.scrollTop=document.documentElement.scrollTop=0,
h.toggleClass("map-default map-selected"),f.is(":hidden")&&f.show(),e.slideToggle(200,function(){f.is(":visible")?(console.log("open map"),self.removeGoogleElemTitles(),self.addMapZoomListener(),N?self.setMarkerForGuide():(console.log("resize map"),google.maps.event.trigger(map,"resize"),self.setMapBounds())):(self.resetFrames(),self.resetMarkers(),console.log("close map"),N||(console.log("close any open info windows"),infoWindow.close(),self.makeMarkerSmall()))})):(console.log("scroll to map"),document.body.scrollTop=document.documentElement.scrollTop=0)}),self.resetPage=function(){console.log("reset locations & map, clear search, and close surf guide"),N&&self.closeSurfGuide(),l.val(""),self.Query(""),infoWindow.close(),self.makeMarkerSmall();var a=$(".location-frame");a.show(),j.is(":hidden")&&j.show(),self.manageView(),y.forEach(function(a){a.setVisible(!0)}),f.is(":hidden")||self.setMapBounds()};self.renderSurfGuide=function(a){function b(a){e.prepend('<button type="button" class="btn guide-close-button">✖</button>');var b=$(".guide-close-button");g.append('<button type="button" class="btn conditions-button">Current Conditions</button>'),$conditionsBtn=$(".conditions-button"),$conditionsBtn.on("click",function(b){if($(".live-surf-conditions").is(":hidden"))i.addClass("col-sm-6 sm-icon-frame"),j.addClass("md-icon-container"),$(".live-surf-conditions").show(),$conditionsBtn.toggle(),$closeConditionsButton.toggle();else{$conditionsBtn.toggle(),$("#conditionsLoader").length||g.append('<div id="conditionsLoader"></div>'),$conditionsLoader=$("#conditionsLoader");self.canvasLoader("conditionsLoader","spiral",72,33,1,23);d(a.spotID,a.breakName)}}),b.on("click",function(a){$(".favorite-filter-selected").length&&(n.toggle(),self.filterFavorites()),self.closeSurfGuide()})}function c(a){$(".favorite-wrapper-guide").on("click",function(){var b=$(this);$(".is-a-favorite-guide").length?(b.removeClass("is-a-favorite-guide").addClass("not-a-favorite-guide"),console.log("unfavorite "+a),removeFavorite(a)):(b.removeClass("not-a-favorite-guide").addClass("is-a-favorite-guide"),console.log("favorite "+a),addFavorite(a))})}function d(a,b){function c(a){function c(){function a(){c.drawImage(d,0,1177,g,h,0,0,i,j),c.save(),c.translate(150,150),c.rotate(e),c.drawImage(d,0,561,g,h,-150,-150,i,j),c.rotate(-e),c.rotate(f),c.drawImage(d,0,869,g,h,-150,-150,i,j),c.restore()}var b=document.getElementById("compass"),c=b.getContext("2d"),d=new Image;d.src=spriteSheet,d.onload=a;var e=p*(Math.PI/180),f=m*(Math.PI/180),g=308,h=308,i=300,j=300}if(f===b&&!$(".conditions-error").length){var d,e=a.swell.minBreakingHeight,h=a.swell.maxBreakingHeight;d=e===h?e:e+" - "+h;var k=a.swell.components.primary.height,l=a.swell.components.primary.period,m=a.swell.components.primary.direction,n=a.swell.components.primary.compassDirection,o=a.wind.speed,p=a.wind.direction,q=a.wind.compassDirection,r=a.condition.temperature,s=a.condition.weather,t="http://cdnimages.magicseaweed.com/30x30/"+s+".png";rating=[];for(var u=a.solidRating,v='<svg class="rating" alt="solid star icon to indicate favorable surf conditions"><use xlink:href="#star_filled"/></svg>',w=u;w--;)rating.push(v);for(var x=a.fadedRating,y='<svg class="rating" alt="faded star icon to indicate reduced favorable surf conditions due to wind"><use xlink:href="#star_faded"/></svg>',z=x;z--;)rating.push(y);for(var A=5-rating.length,B='<svg class="rating" alt="solid star icon to indicate unfavorable surf conditions"><use xlink:href="#star_empty"/></svg>',C=A;C--;)rating.push(B);var D=rating.join(""),E='<div class="col-xs-12 surf-conditions-container live-surf-conditions"></div>',F='<div class="col-xs-12 col-sm-4 col-md-6 live-surf-conditions live-compass" title="Live wind & swell conditions (swell: blue | wind: white)"><canvas id="compass" alt="live compass to show the current wind and swell conditions" width="300" height="300"></canvas></div>';g.after(F),i.addClass("col-sm-6 sm-icon-frame"),j.addClass("md-icon-container"),g.after(E);var G=$(".surf-conditions-container"),H='<div class="col-xs-12 col-sm-6 surf-conditions-small surf-conditions-waves"></div>',I='<div class="col-xs-6 col-sm-3 surf-conditions-small surf-conditions-swell"></div>',J='<div class="col-xs-6 col-sm-3 surf-conditions-small surf-conditions-wind " title="Wind direction & speed"></div>';G.append(H),G.append(I),G.append(J);var K=$(".title"),L='<p class="live-temp live-surf-conditions " title="Live weather conditions">'+r+' ℉<img class="live-weather" src="'+t+'" alt="Symbol for current weather"></p>',M='<a href="http://magicseaweed.com" target="_blank"><div class="icon icon-msw_powered_by live-surf-conditions msw-banner" alt="banner for magic seaweed"></div></a>';K.after(M),K.after(L);var N=$(".surf-conditions-wind"),O=$(".surf-conditions-swell"),P=$(".surf-conditions-waves"),Q="<p>"+o+"mph</p>",R='<svg  alt="icon for wind"><use xlink:href="#wind"/></svg>',S="<p>"+q+" wind</p>";N.append(Q),N.append(R),N.append(S);var T="<p>"+k+"ft</p>",U='<p class=" " title="The main swell generating waves">primary</p>',V='<p class=" " title="Live period between waves & current direction">@ '+l+"s "+n+"</p>";O.append(T),O.append(U),O.append(V);var W='<p class="live-wave-height " title="Live wave height">'+d+"ft</p>",X='<p class="star-rating " title="Magic Seaweed Rating: The more solid stars, the better. Unfavorable wind conditions change a solid star to a faded star">'+D+"</p>";P.append(W),P.append(X),c(),P.prepend('<button type="button" class="btn conditions-close-button">✖</button>'),$closeConditionsButton=$(".conditions-close-button");var Y=$(".live-surf-conditions");$closeConditionsButton.on("click",function(a){i.removeClass("col-sm-6 sm-icon-frame"),j.removeClass("md-icon-container"),Y.hide(),$closeConditionsButton.hide(),$conditionsBtn.show()}),console.log("add live conditions tooltips"),self.addToolTips()}}function d(){if(console.log("MSW api request unsuccessful"),f===b){var a='<div class="col-xs-12 error-frame"></div>',c='<div class="error-container"></div>',d='<p class="conditions-error">'+b+" conditions unavailable =(</p>",e='<button type="button" class="btn error-close-button">✖</button>';g.after(a);var h=$(".error-frame");h.append(c);var i=$(".error-container");i.append(d),i.prepend(e);var j=$(".error-close-button");j.on("click",function(a){h.remove(),$closeConditionsButton.remove(),$conditionsBtn.toggle()})}}console.log("get current conditions");var e,f=$("#guide-break-name").text();if("none"===a)$conditionsLoader.remove(),d();else{var h=setTimeout(function(){$conditionsLoader.remove(),d()},8e3),k="https://magicseaweed.p.mashape.com/forecast?spot_id="+a+"&units=us&fields=timestamp,fadedRating,solidRating,swell.minBreakingHeight,swell.maxBreakingHeight,swell.components.primary.*,wind.*,condition.*";$.ajax({url:k,datatype:"json",beforeSend:function(a){a.setRequestHeader("X-Mashape-Authorization","IeqgqRG3eLmshPsieyHH4w1HOoYIp1aet5Cjsn7yz0d8OqDJPR")},success:function(a){console.log("MSW api request successful");for(var b=Date.now(),d=b/1e3,f=d-10800,g=d+10800,i=a.length,j=i;j--;){var k=a[j].timestamp;d>k&&k>f?e=a[j]:k>d&&g>k&&(e=a[j])}c(e),clearTimeout(h),$conditionsLoader.remove()}})}}document.body.scrollTop=document.documentElement.scrollTop=0,p.children(":nth-child(1)").remove(),p.append('<div class="row surf-guide-container"></div>');var e=$(".surf-guide-container"),f=displayTitle(a.breakName,a.location);e.append(f);var g=e.children(":nth-child(1)"),h=displayFavoriteIcon(a.breakName);g.children(":nth-child(1)").prepend(h),c(a.breakName),e.append('<div class="col-xs-12 icon-frame"></div>');var i=$(".icon-frame");i.append('<div class="xs-icon-container sm-icon-container icon-container"></div>');var j=$(".icon-container");displayBigWaveIcon(a,j),displayWellKnownIcon(a,j);var k=displaySkillIcon(a.skillLevel);j.append(k);var l=displayDirectionIcon(a.waveDirection);j.append(l);var m=displayBreakIcon(a.breakDetails);j.append(m);var o=displayWaveSize(a.avgSize);j.append(o);var q=100,r=100;displayCompassIcon(a.optimalSwell,a.optimalWind,j,q,r);var s=displayTideIcon(a.optimalTide);j.append(s);var t=displayBestSeasonIcon(a.optimalTime);j.append(t),displaySuggestedAttireIcons(a.avgWaterTemp,j);var u=displayClimateIcon(a.climate);j.append(u);var v=displayCost(a.cost,j);if(j.append(v),"undefined"!=typeof currentLat){var w=displayDistance(a.lat,a.lng);j.append(w)}displayHazardIcons(a.hazards,j),$(".card").addClass("col-xs-4 col-sm-3"),b(a),console.log("add surf guide tooltips"),self.addToolTips()},self.displayTitle=function(a,b){var c='<div class="col-xs-12 guide-header"><p class="title"><span id="guide-break-name">'+a+"</span>, "+b+"</p></div>";return c},self.displayFavoriteIcon=function(a){var b;v.indexOf(a)>-1&&(b=!0);var c;return c=b?'<span class="favorite-wrapper-guide is-a-favorite-guide"><svg class="favorite-guide" alt="filled star icon to indicate that the location is a favorite"><use xlink:href="#star" /></svg></span>':'<span class="favorite-wrapper-guide not-a-favorite-guide"><svg class="favorite-guide" alt="empty star icon to indicate that the location is not a favorite"><use xlink:href="#star"/></svg></span>'},self.setUpIcons=function(a,b,c,d,e,f,g){var h;return h=f?'<div class="'+a+'" title="'+b+'"><svg class="'+g+'"><use xlink:href="'+f+'"/></svg><svg class="'+c+'" alt="'+d+'"><use xlink:href="'+e+'"/></svg></div>':'<div class="'+a+'" title="'+b+'"><svg class="'+c+'" alt="'+d+'"><use xlink:href="'+e+'"/></svg></div>'},self.displayBigWaveIcon=function(a,b){var c,d;z?(c="hover-icon-frame rollover-info misc-info-one-hover-default misc-info-one-hover hover-tooltip-only",d="hover-icon"):(c="big-wave card",d="big-wave-guide");var e="Known for big wave surfing",f="#big_wave",g="icon that indicates the location is known for big wave surfing",h=self.setUpIcons(c,e,d,g,f);if(a.bigWave&&!z)return void b.append(h);if(!a.bigWave&&z)h=self.displaySuggestedAttireIcons(a.avgWaterTemp);else if(!a.bigWave&&!z)return;return h},self.displayWellKnownIcon=function(a,b){var c,d;z?(c="misc-info-two-hover hover-icon-frame rollover-info misc-info-two-hover-default well-known-hover hover-tooltip-only",d="hover-icon"):(c="well-known card",d="well-known-guide");var e="Well known around the world",f="#well_known",g="icon that indicates the location is well known",h=self.setUpIcons(c,e,d,g,f);if(a.wellKnown&&!z)return void b.append(h);if(!a.wellKnown&&z)h=self.displayHazardIcons(a.hazards,b);else if(!a.wellKnown&&!z)return;return h},self.displaySkillIcon=function(a){var b,c,d,e,f,g,h;z?(f="hover-icon-frame rollover-info skill-level-hover-default skill-level-hover hover-tooltip-only",g="hover-icon",h="hover-icon skill-level-bg-hover"):(f="skill-level card",g="skill-level-guide",h="skill-level-bg-guide");var i="#skill_level_all";return a.indexOf("beginner")>-1&&a.indexOf("intermediate")>-1&&a.indexOf("advanced")>-1?(d="Difficulty: All levels",b="#skill_level_all",c="icon that indicates a difficulty level for all skill levels",e=self.setUpIcons(f,d,g,c,b,i,h)):a.indexOf("beginner")>-1&&a.indexOf("intermediate")>-1&&a.indexOf("advanced")<0?(d="Difficulty: Beginner to Intermediate",b="#skill_level_beginner_intermediate",c="icon that indicates a difficulty for beginner to intermediate skill levels",e=self.setUpIcons(f,d,g,c,b,i,h)):a.indexOf("beginner")>-1&&a.indexOf("intermediate")<0&&a.indexOf("advanced")<0?(d="Difficulty: Beginner",b="#skill_level_beginner",c="icon that indicates a difficulty for beginner skill levels",e=self.setUpIcons(f,d,g,c,b,i,h)):a.indexOf("beginner")<0&&a.indexOf("intermediate")>-1&&a.indexOf("advanced")>-1?(d="Difficulty: Intermediate to Advanced",b="#skill_level_intermediate_advanced",c="icon that indicates a difficulty for intermediate to advanced skill levels",e=self.setUpIcons(f,d,g,c,b,i,h)):a.indexOf("beginner")<0&&a.indexOf("intermediate")>-1&&a.indexOf("advanced")<0?(d="Difficulty: Intermediate",b="#skill_level_intermediate",c="icon that indicates a difficulty for intermediate skill levels",e=self.setUpIcons(f,d,g,c,b,i,h)):a.indexOf("beginner")<0&&a.indexOf("intermediate")<0&&a.indexOf("advanced")>-1&&(d="Difficulty: Advanced",b="#skill_level_advanced",c="icon that indicates a difficulty for advanced skill levels",e=self.setUpIcons(f,d,g,c,b,i,h)),e},self.displayDirectionIcon=function(a){var b,c,d,e,f,g;switch(z?(f="hover-icon-frame rollover-info wave-direction-hover-default wave-direction-hover hover-tooltip-only",g="hover-icon"):(f="direction card",g="wave-direction-guide"),a){case"left":d="Wave breaks left",b="#direction_left",c="icon indicating that the wave breaks left",e=self.setUpIcons(f,d,g,c,b);break;case"right":d="Wave breaks right",b="#direction_right",c="icon indicating that the wave breaks right",e=self.setUpIcons(f,d,g,c,b);break;case"left & right":d="Wave breaks left & right",b="#direction_both",c="icon indicating that the wave breaks both left and right",e=self.setUpIcons(f,d,g,c,b)}return e},self.displayBreakIcon=function(a){var b,c,d,e,f,g;switch(z?(f="hover-icon-frame rollover-info break-type-hover-default break-type-hover hover-tooltip-only",g="hover-icon"):(f="break card",g="break-type-guide"),a){case"reef":d="Reef break",b="#break_reef",c="icon indicating that the wave breaks over a reef",e=self.setUpIcons(f,d,g,c,b);break;case"beach":d="Beach break",b="#break_beach",c="icon indicating that the wave is a beach break",e=self.setUpIcons(f,d,g,c,b);break;case"point":d="Point break",b="#break_point",c="icon indicating that the wave breaks over a point",e=self.setUpIcons(f,d,g,c,b);break;case"river mouth":d="Breaks at a river mouth",b="#break_river_mouth",c="icon indicating that the wave breaks at a river mouth",e=self.setUpIcons(f,d,g,c,b)}return e},self.displayCompassIcon=function(a,b,c,d,e){c.append('<div class="small-compass-guide card " title="Best Swell & Best Wind"><canvas id="compass-small" width="'+d+'" height="'+e+'" alt="icon that shows the optimal wind and swell directions"></canvas></div>');var f=new Image;f.src=spriteSheet;var g=document.getElementById("compass-small"),h=g.getContext("2d");h.drawImage(f,0,237,108,108,0,0,100,100),h.save();var i={swell:a,wind:b};for(var j in i){var k;k="swell"===j?345:453;var l=d/2,m=e/2;h.translate(l,m);for(var n,o=i[j].length,p=o;p--;){switch(i[j][p]){case"N":n=0;break;case"NNE":n=22.5;break;case"NE":n=45;break;case"ENE":n=67.5;break;case"E":n=90;break;case"ESE":n=112.5;break;case"SE":n=135;break;case"SSE":n=157.5;break;case"S":n=180;break;case"SSW":n=202.5;break;case"SW":n=225;break;case"WSW":n=247.5;break;case"W":n=270;break;case"WNW":n=292.5;break;case"NW":n=315;break;case"NNW":n=337.5}var q=n*(Math.PI/180);h.rotate(q),h.drawImage(f,0,k,108,108,-l,-m,100,100),h.rotate(-q)}h.restore()}},self.displayTideIcon=function(a){var b,c,d,e,f="tide card",g="tide-guide";return a.indexOf("low")>-1&&a.indexOf("mid")>-1&&a.indexOf("high")>-1?(b="Best Tide: All",c="#tide_all",d="icon indicating that all tides are favorable",e=self.setUpIcons(f,b,g,d,c)):a.indexOf("low")>-1&&a.indexOf("mid")>-1&&a.indexOf("high")<0?(b="Best Tide: Low & Mid",c="#tide_low_mid",d="icon indicating that the best tide is low to mid",e=self.setUpIcons(f,b,g,d,c)):a.indexOf("low")>-1&&a.indexOf("mid")<0&&a.indexOf("high")>-1?(b="Best Tide: Low & High",c="#tide_low_high",d="icon indicating that the best tide is low and hide",e=self.setUpIcons(f,b,g,d,c)):a.indexOf("low")>-1&&a.indexOf("mid")<0&&a.indexOf("high")<0?(b="Best Tide: Low",c="#tide_low",d="icon indicating that the best tide is low",e=self.setUpIcons(f,b,g,d,c)):a.indexOf("low")<0&&a.indexOf("mid")>-1&&a.indexOf("high")>-1?(b="Best Tide: High & Mid",c="#tide_high_mid",d="icon indicating that the best tide is high to mid",e=self.setUpIcons(f,b,g,d,c)):a.indexOf("low")<0&&a.indexOf("mid")>-1&&a.indexOf("high")<0?(b="Best Tide: Mid",c="#tide_mid",d="icon indicating that the best tide is mid",e=self.setUpIcons(f,b,g,d,c)):a.indexOf("low")<0&&a.indexOf("mid")<0&&a.indexOf("high")>-1&&(b="Best Tide: High",c="#tide_high",d="icon indicating the best tide is high",e=self.setUpIcons(f,b,g,d,c)),e},self.displayBestSeasonIcon=function(a){for(var b=0,c=0,d=0,e=0,f=a.length,g=f;g--;)switch(a[g]){case" Dec":case" Jan":case" Feb":e++;break;case" Mar":case" Apr":case" May":b++;break;case" Jun":case" Jul":case" Aug":c++;break;case" Sep":case" Oct":case" Nov":d++}var h,i,j,k,l,m;return z?(h="hover-icon-frame rollover-info best-season-hover-default best-season-hover hover-tooltip-only",i="hover-icon"):(h="time card",i="best-season-guide"),e===b&&e===c&&e===d?(j="Best Season: All",k="#season_all",l="icon indicating that the waves are good year round",m=self.setUpIcons(h,j,i,l,k)):e>=b&&e>=c&&e>=d?e===b?(j="Best Season: Winter & Spring",k="#season_winter_spring",l="icon indicating that the best seasons are winter and spring",m=self.setUpIcons(h,j,i,l,k)):e===c?(j="Best Season: Winter & Summer",k="#season_winter_summer",l="icon indicating that the best seasons are winter and summer",m=self.setUpIcons(h,j,i,l,k)):e===d?(j="Best Season: Winter & Autumn",k="#season_winter_autumn",l="icon indicating that the best seasons are winter and autumn",m=self.setUpIcons(h,j,i,l,k)):(j="Best Season: Winter",k="#season_winter",l="icon indicating that the best season is winter",m=self.setUpIcons(h,j,i,l,k)):b>=c&&b>=d&&b>e?b===c?(j="Best Season: Spring & Summer",k="#season_spring_summer",l="icon indicating that the best seasons are spring and summer",m=self.setUpIcons(h,j,i,l,k)):b===d?(j="Best Season: Spring & Autumn",k="#season_spring_autumn",l="icon indicating that the best seasons are spring and autumn",m=self.setUpIcons(h,j,i,l,k)):(j="Best Season: Spring",k="#season_spring",l="icon indicating that the best season is spring",m=self.setUpIcons(h,j,i,l,k)):c>=d&&c>e&&c>b?c===d?(j="Best Season: Summer & Autumn",k="#season_summer_autumn",l="icon indicating that the best seasons are summer and autumn",m=self.setUpIcons(h,j,i,l,k)):(j="Best Season: Summer",k="#season_ummer",l="icon indicating that the best season is summer",m=self.setUpIcons(h,j,i,l,k)):(j="Best Season: Autumn",k="#season_autumn",l="icon indicating that the best season is autumn",m=self.setUpIcons(h,j,i,l,k)),m},self.displaySuggestedAttireIcons=function(a,b){function c(a,c){var d,e,f,g,h,i="suggested-attire-season-guide suggested-attire-guide";"spring"===c?(d="water-temp spring card",e="Suggested spring attire",f="#water_temp_spring",g="icon for spring",h=self.setUpIcons(d,e,i,g,f),b.append(h),$(".spring").append(a)):"summer"===c?(d="water-temp summer card",e="Suggested summer attire",f="#water_temp_summer",g="icon for summer",h=self.setUpIcons(d,e,i,g,f),b.append(h),$(".summer").append(a)):"autumn"===c?(d="water-temp autumn card",e="Suggested autumn attire",f="#water_temp_autumn",g="icon for autumn",h=self.setUpIcons(d,e,i,g,f),b.append(h),$(".autumn").append(a)):(d="water-temp winter card",e="Suggested winter attire",f="#water_temp_winter",g="icon for winter",h=self.setUpIcons(d,e,i,g,f),b.append(h),$(".winter").append(a))}function d(a){var b,c,d,e,f="hover-icon-frame rollover-info misc-info-one-hover-default misc-info-one-hover hover-tooltip-only",g="hover-icon";return a>59?a>72?z?(b="#ro_water_attire_boardies",c="It's currently warm enough for boardies =)",d="icon indicating that it's currently warm enough for boardies",e=self.setUpIcons(f,c,g,d,b)):e='<svg class="suggested-attire-boardies-guide suggested-attire-guide" alt="icon indicating that board shorts are recommended for this season"><use xlink:href="#water_attire_boardies"/></svg>':a>66?z?(b="#ro_water_attire_2mm_wetsuit",c="A 2mm wetsuit is recommended for this time of year",d="icon indicating that a 2mm wetsuit is recommended for this time of year",e=self.setUpIcons(f,c,g,d,b)):e='<svg class="suggested-attire-wetsuit-guide suggested-attire-guide" alt="icon indicating that a 2mm wetsuit is recommended for this season"><use xlink:href="#water_attire_2mm_wetsuit"/></svg>':z?(b="#ro_water_attire_3mm_wetsuit",c="A 3mm wetsuit is recommended for this time of year",d="icon indicating that a 3mm wetsuit is recommended for this time of year",e=self.setUpIcons(f,c,g,d,b)):e='<svg class="suggested-attire-wetsuit-guide suggested-attire-guide" alt="icon indicating that a 3mm wetsuit is recommended for this season"><use xlink:href="#water_attire_3mm_wetsuit"/></svg>':a>54?z?(b="#ro_water_attire_4mm_wetsuit",c="A 4mm wetsuit and boots are recommended for this time of year",d="icon indicating that a 4mm wetsuit and boots are recommended for this time of year",e=self.setUpIcons(f,c,g,d,b)):e='<svg class="suggested-attire-wetsuit-guide suggested-attire-guide" alt="icon indicating that a 4mm wetsuit and boots are recommended for this season"><use xlink:href="#water_attire_4mm_wetsuit"/></svg>':a>48?z?(b="#ro_water_attire_5mm_wetsuit",c="A 5mm wetsuit, gloves, and boots are recommended for this time of year",d="icon indicating that a 5mm wetsuit, gloves, and boots are recommended for this time of year",e=self.setUpIcons(f,c,g,d,b)):e='<svg class="suggested-attire-wetsuit-guide suggested-attire-guide" alt="icon indicating that a 5mm wetsuit, gloves, and boots are recommended for this season"><use xlink:href="#water_attire_5mm_wetsuit"/></svg>':z?(b="#ro_water_attire_6mm_wetsuit",c="A 6mm wetsuit, gloves, boots, and a hood are recommended for this time of year",d="icon indicating that a 6mm wetsuit, gloves, boots, and a hood are recommended for this time of year",e=self.setUpIcons(f,c,g,d,b)):e='<svg class="suggested-attire-wetsuit-guide suggested-attire-guide" alt="icon indicating that a 6mm wetsuit, gloves, boots, and a hood are recommended for this season"><use xlink:href="#water_attire_6mm_wetsuit"/></svg>',e}var e;if(z){e=getCurrentSeason();var f;switch(e){case"winter":f=d(a.winter);break;case"spring":f=d(a.spring);break;case"summer":f=d(a.summer);break;case"autumn":f=d(a.autumn)}return f}var g;for(var h in a){var i=a[h];g=d(i),c(g,h)}switch(c(g,h),e=getCurrentSeason()){case"winter":$(".winter").addClass("highlight-attire");break;case"spring":$(".spring").addClass("highlight-attire");break;case"summer":$(".summer").addClass("highlight-attire");break;case"autumn":$(".autumn").addClass("highlight-attire")}},self.displayClimateIcon=function(a){var b='<div class="climate card " title="Köppen Climate Classification" alt="icon indicating the Köppen Climate Classification for this location"><p>'+a+"</p></div>";return b},self.displayCost=function(a,b){var c;if(z)c='<p class="rollover-info cost-hover-default cost-hover" alt="info indicating the average daily budget cost" title="Estimated minimum daily budget allowance">$'+a.budget+"</p>";else{var d=Math.floor((a.highEnd-a.budget)/2+a.budget);c=b.append('<div class="cost card "title="Estimated daily budget allowances: Low, Mid, High"><svg class="cost-guide" alt="icon indicating the estimated daily budget allowances"><use xlink:href="#cost"/></svg><p>'+a.budget+"</p><p>"+d+"</p><p>"+a.highEnd+"</p></div>")}return c},self.displayDistance=function(a,b){function c(a){return a*(Math.PI/180)}var d,e,f,g,h,i=currentLat,j=currentLng,k=3959,l=c(a-i),m=c(b-j),n=Math.sin(l/2)*Math.sin(l/2)+Math.cos(c(i))*Math.cos(c(a))*Math.sin(m/2)*Math.sin(m/2),o=2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)),p=k*o,q=Math.round(p);if(q>200){var r=q/450;d=1>r?1:Math.round(r),d>8&&12>=d?(e=d+2,f=e):d>12?(e=d+4,f=e):lightTime=d;var s=f;return z?g='<p class="rollover-info distance-hover-default distance-hover" alt="info indicating the estimated flying time to the location" title="Estimated flight duration from your location">'+s+"h</p>":h='<div class="distance card" title="Estimated flight duration from your location"><svg class="distance-guide-plane" alt="icon indicating the estimated flying time to the location"><use xlink:href="#distance_plane"/></svg><p class="distance-guide-hours">'+s+"h</p></div>"}var t=q;return z?g='<p class="rollover-info distance-hover-default distance-hover" alt="info indicating the estimated driving time to the location" title="Estimated distance in miles from your location">'+t+"mi</p>":h='<div class="distance card" title="Estimated (straight line) distance in miles from your location (actual distance via roads will be greater)"><svg class="distance-guide-drive" alt="icon indicating the estimated driving time to the location"><use xlink:href="#distance"/></svg><p class="distance-guide-miles">'+t+"mi</p></div>"},self.displayCurrentWaterTemp=function(a){var b,c=getCurrentSeason();switch(c){case"winter":b=a.winter;break;case"spring":b=a.spring;break;case"summer":b=a.summer;break;case"autumn":b=a.autumn}var d='<p class="rollover-info water-temp-hover-default water-temp-hover" alt="info indicating the average water temperature for this time of year" title="Average '+c+' water temperature">'+b+"℉</p>";return d},self.displayWaveSize=function(a){var b,c;return b=a.aboveMax?"+":"",c=z?'<p class="rollover-info wave-size-hover-default wave-size-hover" alt="info indicating the average wave size for this location" title="Average wave size">'+a.min+"-"+a.max+"'</p>":'<div class="wave-size card" title="Average wave size"><svg class="wave-size-guide" alt="icon indicating the average wave height"><use xlink:href="#wave_range"/></svg><p>'+a.min+"-"+a.max+b+"ft</p></div>"},self.getCurrentSeason=function(){var a,b=new Date,c=b.getMonth();switch(c){case 11:case 0:case 1:a="winter";break;case 2:case 3:case 4:a="spring";break;case 5:case 6:case 7:a="summer";break;case 8:case 9:case 10:a="autumn"}return a},self.displayHazardIcons=function(a,b){function c(a,b){var c,d,e,f,g,h;switch(z?(c="misc-info-two-hover hover-icon-frame rollover-info misc-info-two-hover-default hover-tooltip-only",d="hover-icon misc-info-two-hover-svg"):(c="hazard card",d="hazard-guide"),a){case"beginners":e="Hazard: Beginners",f="#hazards_beginners",g="icon indicating that beginners are a hazard",h=self.setUpIcons(c,e,d,g,f);break;case"boats":e="Hazard: Boats",f="#hazards_boats",g="icon indicating that boats are a hazard",h=self.setUpIcons(c,e,d,g,f);break;case"crocs":e="Hazard: Crocodiles",f="#hazards_crocs",g="icon indicating that crocodiles are a hazard",h=self.setUpIcons(c,e,d,g,f);break;case"crowded":e="Hazard: Crowded",f="#hazards_crowded",g="icon indicating that crowds are a hazard",h=self.setUpIcons(c,e,d,g,f);break;case"dangerous break":e="Hazard: Dangerous break",f="#hazards_dangerous_break",g="icon indicating that this is a dangerous break",h=self.setUpIcons(c,e,d,g,f);break;case"far from shore":e="Hazard: Far from shore",f="#hazards_far_from_shore",g="icon indicating that the waves are far from shore",h=self.setUpIcons(c,e,d,g,f);break;case"pollution":e="Hazard: Pollution",f="#hazards_pollution",g="icon indicating that pollution is a hazard",h=self.setUpIcons(c,e,d,g,f);break;case"rocky bottom":e="Hazard: Rocky bottom",f="#hazards_rocky_bottom",g="icon indicating that this break has a rocky bottom",h=self.setUpIcons(c,e,d,g,f);break;case"sea snakes":e="Hazard: Sea snakes",f="#hazards_sea_snakes",g="icon indicating that sea snakes are a hazard",h=self.setUpIcons(c,e,d,g,f);break;case"seals":e="Hazard: Seals",f="#hazards_seals",g="icon indicating that seals are a hazard",h=self.setUpIcons(c,e,d,g,f);break;case"seaweed":e="Hazard: Seaweed",f="#hazards_seaweed",g="icon indicating that seaweed is a hazard",h=self.setUpIcons(c,e,d,g,f);break;case"sewage":e="Hazard: Sewage",f="#hazards_sewage",g="icon indicating that sewage is a hazard",h=self.setUpIcons(c,e,d,g,f);break;case"shallow":e="Hazard: Shallow break",f="#hazards_shallow",g="icon indicating that the wave breaks over a shallow bottom",h=self.setUpIcons(c,e,d,g,f);break;case"sharks":e="Hazard: Sharks",f="#hazards_sharks",g="icon indicating that sharks are a hazard",h=self.setUpIcons(c,e,d,g,f);break;case"strong currents":e="Hazard: Strong currents",f="#hazards_strong_currents",g="icon indicating that the wave has strong currents",h=self.setUpIcons(c,e,d,g,f);break;case"strong rips":e="Hazard: Strong rips",f="#hazards_strong_rips",g="icon indicating that the wave has strong rips",h=self.setUpIcons(c,e,d,g,f);break;case"theft":e="Hazard: Theft",f="#hazards_theft",g="icon indicating that theft is a hazard",h=self.setUpIcons(c,e,d,g,f);break;case"undertow":e="Hazard: Strong undertow",f="#hazards_undertow",g="icon indicating that the break has a strong undertow",h=self.setUpIcons(c,e,d,g,f);break;case"unfriendly":e="Hazard: Localism",f="#hazards_unfriendly",g="icon indicating that there is localism at this break",h=self.setUpIcons(c,e,d,g,f);break;case"urchins":e="Hazard: Urchins",f="#hazards_urchins",g="icon indicating that sea urchins are a hazard",h=self.setUpIcons(c,e,d,g,f)}return z?h:void b.append(h)}var d=a.length;if(z){var e=Math.floor(Math.random()*d),f=a[e],g=c(f);return g}for(var h=d;h--;)c(a[h],b)},self.closeSurfGuide=function(){console.log("close surf guide"),console.log("close any open info windows"),infoWindow.close(),self.makeMarkerSmall(),p.children(":nth-child(1)").remove(),self.manageView(),f.is(":hidden")&&self.resetFrames(),j.show(),$(".location-frame:visible").css("display","inline-block"),document.body.scrollTop=document.documentElement.scrollTop=0}}!function(a){"use strict";var b,c=function(a,b){"undefined"==typeof b&&(b={}),this.init(a,b)},d=c.prototype,e=["canvas","vml"],f=["oval","spiral","square","rect","roundRect"],g=/^\#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,h=-1!==navigator.appVersion.indexOf("MSIE")&&8===parseFloat(navigator.appVersion.split("MSIE")[1])?!0:!1,i=!!document.createElement("canvas").getContext,j=40,k=!0,l=function(a,b,c){var d,e=document.createElement(a);for(d in c)e[d]=c[d];return"undefined"!=typeof b&&b.appendChild(e),e},m=function(a,b){for(var c in b)a.style[c]=b[c];return a},n=function(a,b){for(var c in b)a.setAttribute(c,b[c]);return a},o=function(a,b,c,d){a.save(),a.translate(b,c),a.rotate(d),a.translate(-b,-c),a.beginPath()};d.init=function(a,d){"boolean"==typeof d.safeVML&&(k=d.safeVML);try{void 0!==document.getElementById(a)?this.mum=document.getElementById(a):this.mum=document.body}catch(f){this.mum=document.body}if(d.id="undefined"!=typeof d.id?d.id:"canvasLoader",this.cont=l("div",this.mum,{id:d.id}),i)b=e[0],this.can=l("canvas",this.cont),this.con=this.can.getContext("2d"),this.cCan=m(l("canvas",this.cont),{display:"none"}),this.cCon=this.cCan.getContext("2d");else{if(b=e[1],"undefined"==typeof c.vmlSheet){document.getElementsByTagName("head")[0].appendChild(l("style")),c.vmlSheet=document.styleSheets[document.styleSheets.length-1];for(var g,h=["group","oval","roundrect","fill"],g=0;g<h.length;++g)c.vmlSheet.addRule(h[g],"behavior:url(#default#VML); position:absolute;")}this.vml=l("group",this.cont)}this.setColor(this.color),this.draw(),m(this.cont,{display:"none"})},d.cont={},d.can={},d.con={},d.cCan={},d.cCon={},d.timer={},d.activeId=0,d.diameter=40,d.setDiameter=function(a){this.diameter=Math.round(Math.abs(a)),this.redraw()},d.getDiameter=function(){return this.diameter},d.cRGB={},d.color="#000000",d.setColor=function(a){this.color=g.test(a)?a:"#000000",this.cRGB=this.getRGB(this.color),this.redraw()},d.getColor=function(){return this.color},d.shape=f[0],d.setShape=function(a){var b;for(b in f)if(a===f[b]){this.shape=a,this.redraw();break}},d.getShape=function(){return this.shape},d.density=40,d.setDensity=function(a){k&&b===e[1]?this.density=Math.round(Math.abs(a))<=j?Math.round(Math.abs(a)):j:this.density=Math.round(Math.abs(a)),this.density>360&&(this.density=360),this.activeId=0,this.redraw()},d.getDensity=function(){return this.density},d.range=1.3,d.setRange=function(a){this.range=Math.abs(a),this.redraw()},d.getRange=function(){return this.range},d.speed=2,d.setSpeed=function(a){this.speed=Math.round(Math.abs(a))},d.getSpeed=function(){return this.speed},d.fps=24,d.setFPS=function(a){this.fps=Math.round(Math.abs(a)),this.reset()},d.getFPS=function(){return this.fps},d.getRGB=function(a){return a="#"===a.charAt(0)?a.substring(1,7):a,{r:parseInt(a.substring(0,2),16),g:parseInt(a.substring(2,4),16),b:parseInt(a.substring(4,6),16)}},d.draw=function(){
var a,c,d,g,i,j,k,p,q,r,s,t,u,v=0,w=this.density,x=Math.round(w*this.range),y=0,z=1e3,A=0,B=this.cCon,C=this.diameter,D=.47;if(b===e[0])for(B.clearRect(0,0,z,z),n(this.can,{width:C,height:C}),n(this.cCan,{width:C,height:C});w>v;){switch(q=x>=v?1-(1-y)/x*v:q=y,j=270-360/w*v,k=j/180*Math.PI,B.fillStyle="rgba("+this.cRGB.r+","+this.cRGB.g+","+this.cRGB.b+","+q.toString()+")",this.shape){case f[0]:case f[1]:a=.07*C,g=C*D+Math.cos(k)*(C*D-a)-C*D,i=C*D+Math.sin(k)*(C*D-a)-C*D,B.beginPath(),this.shape===f[1]?B.arc(.5*C+g,.5*C+i,a*q,0,2*Math.PI,!1):B.arc(.5*C+g,.5*C+i,a,0,2*Math.PI,!1);break;case f[2]:a=.12*C,g=Math.cos(k)*(C*D-a)+.5*C,i=Math.sin(k)*(C*D-a)+.5*C,o(B,g,i,k),B.fillRect(g,i-.5*a,a,a);break;case f[3]:case f[4]:c=.3*C,d=.27*c,g=Math.cos(k)*(d+.13*(C-d))+.5*C,i=Math.sin(k)*(d+.13*(C-d))+.5*C,o(B,g,i,k),this.shape===f[3]?B.fillRect(g,i-.5*d,c,d):(p=.55*d,B.moveTo(g+p,i-.5*d),B.lineTo(g+c-p,i-.5*d),B.quadraticCurveTo(g+c,i-.5*d,g+c,i-.5*d+p),B.lineTo(g+c,i-.5*d+d-p),B.quadraticCurveTo(g+c,i-.5*d+d,g+c-p,i-.5*d+d),B.lineTo(g+p,i-.5*d+d),B.quadraticCurveTo(g,i-.5*d+d,g,i-.5*d+d-p),B.lineTo(g,i-.5*d+p),B.quadraticCurveTo(g,i-.5*d,g+p,i-.5*d))}B.closePath(),B.fill(),B.restore(),++v}else{switch(m(this.cont,{width:C,height:C}),m(this.vml,{width:C,height:C}),this.shape){case f[0]:case f[1]:t="oval",a=.14*z;break;case f[2]:t="roundrect",a=.12*z;break;case f[3]:case f[4]:t="roundrect",a=.3*z}for(c=d=a,g=.5*z-d,i=.5*-d;w>v;){switch(q=x>=v?1-(1-y)/x*v:q=y,j=270-360/w*v,this.shape){case f[1]:c=d=a*q,g=.5*z-.5*a-a*q*.5,i=.5*(a-a*q);break;case f[0]:case f[2]:h&&(i=0,this.shape===f[2]&&(g=.5*z-.5*d));break;case f[3]:case f[4]:c=.95*a,d=.28*c,h?(g=0,i=.5*z-.5*d):(g=.5*z-c,i=.5*-d),A=this.shape===f[4]?.6:0}s=n(m(l("group",this.vml),{width:z,height:z,rotation:j}),{coordsize:z+","+z,coordorigin:.5*-z+","+.5*-z}),r=m(l(t,s,{stroked:!1,arcSize:A}),{width:c,height:d,top:i,left:g}),u=l("fill",r,{color:this.color,opacity:q}),++v}}this.tick(!0)},d.clean=function(){if(b===e[0])this.con.clearRect(0,0,1e3,1e3);else{var a=this.vml;if(a.hasChildNodes())for(;a.childNodes.length>=1;)a.removeChild(a.firstChild)}},d.redraw=function(){this.clean(),this.draw()},d.reset=function(){"number"==typeof this.timer&&(this.hide(),this.show())},d.tick=function(a){var c=this.con,d=this.diameter;a||(this.activeId+=360/this.density*this.speed),b===e[0]?(c.clearRect(0,0,d,d),o(c,.5*d,.5*d,this.activeId/180*Math.PI),c.drawImage(this.cCan,0,0,d,d),c.restore()):(this.activeId>=360&&(this.activeId-=360),m(this.vml,{rotation:this.activeId}))},d.show=function(){if("number"!=typeof this.timer){var a=this;this.timer=self.setInterval(function(){a.tick()},Math.round(1e3/this.fps)),m(this.cont,{display:"block"})}},d.hide=function(){"number"==typeof this.timer&&(clearInterval(this.timer),delete this.timer,m(this.cont,{display:"none"}))},d.kill=function(){var a=this.cont;"number"==typeof this.timer&&this.hide(),b===e[0]?(a.removeChild(this.can),a.removeChild(this.cCan)):a.removeChild(this.vml);var c;for(c in this)delete this[c]},a.CanvasLoader=c}(window),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});var map,infoWindow,spriteSheet="/img/png/png_sprites.png";navigator.geolocation.getCurrentPosition(success),ko.applyBindings(new AppViewModel);